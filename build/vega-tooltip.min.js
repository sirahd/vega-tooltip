!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vegaTooltip=e()}}(function(){var e;return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var s="function"==typeof require&&require;if(!u&&s)return s(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){},{}],2:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(){}function n(e,n){var r=new t;if(e instanceof t)e.each(function(e,t){r.set(t,e)});else if(Array.isArray(e)){var i,a=-1,o=e.length;if(null==n)for(;++a<o;)r.set(a,e[a]);else for(;++a<o;)r.set(n(i=e[a],a,e),i)}else if(e)for(var u in e)r.set(u,e[u]);return r}function r(){return{}}function i(e,t,n){e[t]=n}function a(){return n()}function o(e,t,n){e.set(t,n)}function u(){}function s(e,t){var n=new u;if(e instanceof u)e.each(function(e){n.add(e)});else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}t.prototype=n.prototype={constructor:t,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var c=function(){function e(t,r,i,a){if(r>=l.length)return null!=s?s(t):null!=u?t.sort(u):t;for(var o,c,f,d=-1,p=t.length,m=l[r++],h=n(),g=i();++d<p;)(f=h.get(o=m(c=t[d])+""))?f.push(c):h.set(o,[c]);return h.each(function(t,n){a(g,n,e(t,r,i,a))}),g}function t(e,n){if(++n>l.length)return e;var r,i=f[n-1];return null!=s&&n>=l.length?r=e.entries():(r=[],e.each(function(e,i){r.push({key:i,values:t(e,n)})})),null!=i?r.sort(function(e,t){return i(e.key,t.key)}):r}var u,s,c,l=[],f=[];return c={object:function(t){return e(t,0,r,i)},map:function(t){return e(t,0,a,o)},entries:function(n){return t(e(n,0,a,o),0)},key:function(e){return l.push(e),c},sortKeys:function(e){return f[l.length-1]=e,c},sortValues:function(e){return u=e,c},rollup:function(e){return s=e,c}}},l=n.prototype;u.prototype=s.prototype={constructor:u,has:l.has,add:function(e){return e+="",this["$"+e]=e,this},remove:l.remove,clear:l.clear,values:l.keys,size:l.size,empty:l.empty,each:l.each};var f=function(e){var t=[];for(var n in e)t.push(n);return t},d=function(e){var t=[];for(var n in e)t.push(e[n]);return t},p=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t};e.nest=c,e.set=s,e.map=n,e.keys=f,e.values=d,e.entries=p,Object.defineProperty(e,"__esModule",{value:!0})})},{}],3:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3=t.d3||{})}(this,function(e){"use strict";function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Z&&t.documentElement.namespaceURI===Z?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function r(){return new i}function i(){this._="@"+(++ne).toString(36)}function a(e,t,n){return e=o(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function o(t,n,r){return function(i){var a=e.event;e.event=i;try{t.call(this,this.__data__,n,r)}finally{e.event=a}}}function u(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function s(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function c(e,t,n){var r=ue.hasOwnProperty(e.type)?a:o;return function(i,a,o){var u,s=this.__on,c=r(t,a,o);if(s)for(var l=0,f=s.length;l<f;++l)if((u=s[l]).type===e.type&&u.name===e.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=c,u.capture=n),void(u.value=t);this.addEventListener(e.type,c,n),u={type:e.type,name:e.name,value:t,listener:c,capture:n},s?s.push(u):this.__on=[u]}}function l(t,n,r,i){var a=e.event;t.sourceEvent=e.event,e.event=t;try{return n.apply(r,i)}finally{e.event=a}}function f(){}function d(){return[]}function p(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function m(e,t,n,r,i,a){for(var o,u=0,s=t.length,c=a.length;u<c;++u)(o=t[u])?(o.__data__=a[u],r[u]=o):n[u]=new p(e,a[u]);for(;u<s;++u)(o=t[u])&&(i[u]=o)}function h(e,t,n,r,i,a,o){var u,s,c,l={},f=t.length,d=a.length,m=new Array(f);for(u=0;u<f;++u)(s=t[u])&&(m[u]=c=_e+o.call(s,s.__data__,u,t),c in l?i[u]=s:l[c]=s);for(u=0;u<d;++u)c=_e+o.call(e,a[u],u,a),(s=l[c])?(r[u]=s,s.__data__=a[u],l[c]=null):n[u]=new p(e,a[u]);for(u=0;u<f;++u)(s=t[u])&&l[m[u]]===s&&(i[u]=s)}function g(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){return function(){this.removeAttribute(e)}}function y(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function _(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function S(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function x(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function M(e){return function(){this.style.removeProperty(e)}}function E(e,t,n){return function(){this.style.setProperty(e,t,n)}}function w(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function O(e){return function(){delete this[e]}}function N(e,t){return function(){this[e]=t}}function T(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function A(e){return e.trim().split(/^|\s+/)}function D(e){return e.classList||new k(e)}function k(e){this._node=e,this._names=A(e.getAttribute("class")||"")}function C(e,t){for(var n=D(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function P(e,t){for(var n=D(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function R(e){return function(){C(this,e)}}function L(e){return function(){P(this,e)}}function I(e,t){return function(){(t.apply(this,arguments)?C:P)(this,e)}}function U(){this.textContent=""}function j(e){return function(){this.textContent=e}}function F(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function H(){this.innerHTML=""}function z(e){return function(){this.innerHTML=e}}function Y(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function q(){this.nextSibling&&this.parentNode.appendChild(this)}function X(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function W(){return null}function B(){var e=this.parentNode;e&&e.removeChild(this)}function $(e,t,n){var r=Pe(e),i=r.CustomEvent;i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function G(e,t){return function(){return $(this,e,t)}}function V(e,t){return function(){return $(this,e,t.apply(this,arguments))}}function J(e,t){this._groups=e,this._parents=t}function Q(){return new J([[document.documentElement]],Be)}var Z="http://www.w3.org/1999/xhtml",K={svg:"http://www.w3.org/2000/svg",xhtml:Z,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ee=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),K.hasOwnProperty(t)?{space:K[t],local:e}:e},te=function(e){var r=ee(e);return(r.local?n:t)(r)},ne=0;i.prototype=r.prototype={constructor:i,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var re=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var ie=document.documentElement;if(!ie.matches){var ae=ie.webkitMatchesSelector||ie.msMatchesSelector||ie.mozMatchesSelector||ie.oMatchesSelector;re=function(e){return function(){return ae.call(this,e)}}}}var oe=re,ue={};if(e.event=null,"undefined"!=typeof document){"onmouseenter"in document.documentElement||(ue={mouseenter:"mouseover",mouseleave:"mouseout"})}var se=function(e,t,n){var r,i,a=u(e+""),o=a.length;{if(!(arguments.length<2)){for(l=t?c:s,null==n&&(n=!1),r=0;r<o;++r)this.each(l(a[r],t,n));return this}var l=this.node().__on;if(l)for(var f,d=0,p=l.length;d<p;++d)for(r=0,f=l[d];r<o;++r)if((i=a[r]).type===f.type&&i.name===f.name)return f.value}},ce=function(){for(var t,n=e.event;t=n.sourceEvent;)n=t;return n},le=function(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]},fe=function(e){var t=ce();return t.changedTouches&&(t=t.changedTouches[0]),le(e,t)},de=function(e){return null==e?f:function(){return this.querySelector(e)}},pe=function(e){"function"!=typeof e&&(e=de(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,u=t[i],s=u.length,c=r[i]=new Array(s),l=0;l<s;++l)(a=u[l])&&(o=e.call(a,a.__data__,l,u))&&("__data__"in a&&(o.__data__=a.__data__),c[l]=o);return new J(r,this._parents)},me=function(e){return null==e?d:function(){return this.querySelectorAll(e)}},he=function(e){"function"!=typeof e&&(e=me(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,u=t[a],s=u.length,c=0;c<s;++c)(o=u[c])&&(r.push(e.call(o,o.__data__,c,u)),i.push(o));return new J(r,i)},ge=function(e){"function"!=typeof e&&(e=oe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],u=o.length,s=r[i]=[],c=0;c<u;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&s.push(a);return new J(r,this._parents)},ve=function(e){return new Array(e.length)},ye=function(){return new J(this._enter||this._groups.map(ve),this._parents)};p.prototype={constructor:p,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var be=function(e){return function(){return e}},_e="$",Se=function(e,t){if(!e)return p=new Array(this.size()),c=-1,this.each(function(e){p[++c]=e}),p;var n=t?h:m,r=this._parents,i=this._groups;"function"!=typeof e&&(e=be(e));for(var a=i.length,o=new Array(a),u=new Array(a),s=new Array(a),c=0;c<a;++c){var l=r[c],f=i[c],d=f.length,p=e.call(l,l&&l.__data__,c,r),g=p.length,v=u[c]=new Array(g),y=o[c]=new Array(g);n(l,f,v,y,s[c]=new Array(d),p,t);for(var b,_,S=0,x=0;S<g;++S)if(b=v[S]){for(S>=x&&(x=S+1);!(_=y[x])&&++x<g;);b._next=_||null}}return o=new J(o,r),o._enter=u,o._exit=s,o},xe=function(){return new J(this._exit||this._groups.map(ve),this._parents)},Me=function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),u=0;u<a;++u)for(var s,c=t[u],l=n[u],f=c.length,d=o[u]=new Array(f),p=0;p<f;++p)(s=c[p]||l[p])&&(d[p]=s);for(;u<r;++u)o[u]=t[u];return new J(o,this._parents)},Ee=function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},we=function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=g);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,u=n[a],s=u.length,c=i[a]=new Array(s),l=0;l<s;++l)(o=u[l])&&(c[l]=o);c.sort(t)}return new J(i,this._parents).order()},Oe=function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},Ne=function(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},Te=function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},Ae=function(){var e=0;return this.each(function(){++e}),e},De=function(){return!this.node()},ke=function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,u=a.length;o<u;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},Ce=function(e,t){var n=ee(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?y:v:"function"==typeof t?n.local?x:S:n.local?_:b)(n,t))},Pe=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView},Re=function(e,t,n){var r;return arguments.length>1?this.each((null==t?M:"function"==typeof t?w:E)(e,t,null==n?"":n)):Pe(r=this.node()).getComputedStyle(r,null).getPropertyValue(e)},Le=function(e,t){return arguments.length>1?this.each((null==t?O:"function"==typeof t?T:N)(e,t)):this.node()[e]};k.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Ie=function(e,t){var n=A(e+"");if(arguments.length<2){for(var r=D(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?I:t?R:L)(n,t))},Ue=function(e){return arguments.length?this.each(null==e?U:("function"==typeof e?F:j)(e)):this.node().textContent},je=function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?Y:z)(e)):this.node().innerHTML},Fe=function(){return this.each(q)},He=function(){return this.each(X)},ze=function(e){var t="function"==typeof e?e:te(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},Ye=function(e,t){var n="function"==typeof e?e:te(e),r=null==t?W:"function"==typeof t?t:de(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},qe=function(){return this.each(B)},Xe=function(e){return arguments.length?this.property("__data__",e):this.node().__data__},We=function(e,t){return this.each(("function"==typeof t?V:G)(e,t))},Be=[null];J.prototype=Q.prototype={constructor:J,select:pe,selectAll:he,filter:ge,data:Se,enter:ye,exit:xe,merge:Me,order:Ee,sort:we,call:Oe,nodes:Ne,node:Te,size:Ae,empty:De,each:ke,attr:Ce,style:Re,property:Le,classed:Ie,text:Ue,html:je,raise:Fe,lower:He,append:ze,insert:Ye,remove:qe,datum:Xe,on:se,dispatch:We};var $e=function(e){return"string"==typeof e?new J([[document.querySelector(e)]],[document.documentElement]):new J([[e]],Be)},Ge=function(e){return"string"==typeof e?new J([document.querySelectorAll(e)],[document.documentElement]):new J([null==e?[]:e],Be)},Ve=function(e,t,n){arguments.length<3&&(n=t,t=ce().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return le(e,r);return null},Je=function(e,t){null==t&&(t=ce().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=le(e,t[n]);return i};e.creator=te,e.local=r,e.matcher=oe,e.mouse=fe,e.namespace=ee,e.namespaces=K,e.select=$e,e.selectAll=Ge,e.selection=Q,e.selector=de,e.selectorAll=me,e.touch=Ve,e.touches=Je,e.window=Pe,e.customEvent=l,Object.defineProperty(e,"__esModule",{value:!0})})},{}],4:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.d3_dsv={})}(this,function(e){"use strict";function t(e){return new a(e)}function n(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function r(e,t){var r=n(e);return function(n,i){return t(r(n),i,e)}}function i(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var r in e)r in t||n.push(t[r]=r)}),n}function a(e){function t(t){return t.map(a).join(e)}function a(e){return o.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var o=new RegExp('["'+e+"\n]"),u=e.charCodeAt(0);this.parse=function(e,t){var i,a,o=this.parseRows(e,function(e,o){if(i)return i(e,o-1);a=e,i=t?r(e,t):n(e)});return o.columns=a,o},this.parseRows=function(e,t){function n(){if(l>=c)return o;if(i)return i=!1,a;var t,n=l;if(34===e.charCodeAt(n)){for(var r=n;r++<c;)if(34===e.charCodeAt(r)){if(34!==e.charCodeAt(r+1))break;++r}return l=r+2,t=e.charCodeAt(r+1),13===t?(i=!0,10===e.charCodeAt(r+2)&&++l):10===t&&(i=!0),e.slice(n+1,r).replace(/""/g,'"')}for(;l<c;){var s=1;if(10===(t=e.charCodeAt(l++)))i=!0;else if(13===t)i=!0,10===e.charCodeAt(l)&&(++l,++s);else if(t!==u)continue;return e.slice(n,l-s)}return e.slice(n)}for(var r,i,a={},o={},s=[],c=e.length,l=0,f=0;(r=n())!==o;){for(var d=[];r!==a&&r!==o;)d.push(r),r=n();t&&null==(d=t(d,f++))||s.push(d)}return s},this.format=function(t,n){return null==n&&(n=i(t)),[n.map(a).join(e)].concat(t.map(function(t){return n.map(function(e){return a(t[e])}).join(e)})).join("\n")},this.formatRows=function(e){return e.map(t).join("\n")}}t.prototype=a.prototype;var o=t(","),u=t("\t");e.version="0.1.14",e.dsv=t,e.csv=o,e.tsv=u})},{}],5:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e("d3-format",["exports"],i):i(t.d3_format={})}(this,function(e){"use strict";function t(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function n(e){return e=t(Math.abs(e)),e?e[1]:NaN}function r(e,t){return function(n,r){for(var i=n.length,a=[],o=0,u=e[0],s=0;i>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),a.push(n.substring(i-=u,i+u)),!((s+=u+1)>r));)u=e[o=(o+1)%e.length];return a.reverse().join(t)}}function i(e,n){var r=t(e,n);if(!r)return e+"";var i=r[0],a=r[1],o=a-(m=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+t(e,Math.max(0,n+o-1))[0]}function a(e,n){var r=t(e,n);if(!r)return e+"";var i=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}function o(e,t){e=e.toPrecision(t);e:for(var n,r=e.length,i=1,a=-1;i<r;++i)switch(e[i]){case".":a=n=i;break;case"0":0===a&&(a=i),n=i;break;case"e":break e;default:a>0&&(a=0)}return a>0?e.slice(0,a)+e.slice(n+1):e}function u(e){return new s(e)}function s(e){if(!(t=g.exec(e)))throw new Error("invalid format: "+e);var t,n=t[1]||" ",r=t[2]||">",i=t[3]||"-",a=t[4]||"",o=!!t[5],u=t[6]&&+t[6],s=!!t[7],c=t[8]&&+t[8].slice(1),l=t[9]||"";"n"===l?(s=!0,l="g"):h[l]||(l=""),(o||"0"===n&&"="===r)&&(o=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=a,this.zero=o,this.width=u,this.comma=s,this.precision=c,this.type=l}function c(e){return e}function l(e){function t(e){e=u(e);var t=e.fill,n=e.align,r=e.sign,i=e.symbol,c=e.zero,l=e.width,f=e.comma,d=e.precision,p=e.type,g="$"===i?o[0]:"#"===i&&/[boxX]/.test(p)?"0"+p.toLowerCase():"",y="$"===i?o[1]:/[%p]/.test(p)?"%":"",b=h[p],_=!p||/[defgprs%]/.test(p);return d=null==d?p?6:12:/[gprs]/.test(p)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),function(e){var i=g,o=y;if("c"===p)o=b(e)+o,e="";else{e=+e;var u=(e<0||1/e<0)&&(e*=-1,!0);if(e=b(e,d),u){var h,S=-1,x=e.length;for(u=!1;++S<x;)if(48<(h=e.charCodeAt(S))&&h<58||"x"===p&&96<h&&h<103||"X"===p&&64<h&&h<71){u=!0;break}}if(i=(u?"("===r?r:"-":"-"===r||"("===r?"":r)+i,o=o+("s"===p?v[8+m/3]:"")+(u&&"("===r?")":""),_)for(var h,S=-1,x=e.length;++S<x;)if(48>(h=e.charCodeAt(S))||h>57){o=(46===h?s+e.slice(S+1):e.slice(S))+o,e=e.slice(0,S);break}}f&&!c&&(e=a(e,1/0));var M=i.length+e.length+o.length,E=M<l?new Array(l-M+1).join(t):"";switch(f&&c&&(e=a(E+e,E.length?l-o.length:1/0),E=""),n){case"<":return i+e+o+E;case"=":return i+E+e+o;case"^":return E.slice(0,M=E.length>>1)+i+e+o+E.slice(M)}return E+i+e+o}}function i(e,r){var i=t((e=u(e),e.type="f",e)),a=3*Math.max(-8,Math.min(8,Math.floor(n(r)/3))),o=Math.pow(10,-a),s=v[8+a/3];return function(e){return i(o*e)+s}}var a=e.grouping&&e.thousands?r(e.grouping,e.thousands):c,o=e.currency,s=e.decimal;return{format:t,formatPrefix:i}}function f(e){return Math.max(0,-n(Math.abs(e)))}function d(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(n(t)/3)))-n(Math.abs(e)))}function p(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,n(t)-n(e))+1}var m,h={"":o,"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return a(100*e,t)},r:a,s:i,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},g=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;s.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var v=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],y=l({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),b=l({decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),_=l({decimal:",",thousands:" ",grouping:[3],currency:[""," Kč"]}),S=l({decimal:",",thousands:"'",grouping:[3],currency:[""," CHF"]}),x=l({decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),M=l({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),E=l({decimal:".",thousands:",",grouping:[3],currency:["£",""]}),w=l({decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),O=l({decimal:",",thousands:" ",grouping:[3],currency:[""," €"]}),N=l({decimal:",",thousands:" ",grouping:[3],currency:["","$"]}),T=l({decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),A=l({decimal:".",thousands:",",grouping:[3],currency:["₪",""]}),D=l({decimal:",",thousands:" ",grouping:[3],currency:[""," Ft"]}),k=l({decimal:",",thousands:".",grouping:[3],currency:["€",""]}),C=l({decimal:".",thousands:",",grouping:[3],currency:["","円"]}),P=l({decimal:".",thousands:",",grouping:[3],currency:["₩",""]}),R=l({decimal:",",thousands:".",grouping:[3],currency:[""," ден."]}),L=l({decimal:",",thousands:".",grouping:[3],currency:["€ ",""]}),I=l({decimal:",",thousands:".",grouping:[3],currency:["","zł"]}),U=l({decimal:",",thousands:".",grouping:[3],currency:["R$",""]}),j=l({decimal:",",thousands:" ",grouping:[3],currency:[""," руб."]}),F=l({decimal:",",thousands:" ",grouping:[3],currency:["","SEK"]}),H=l({decimal:".",thousands:",",grouping:[3],currency:["¥",""]}),z=y.format,Y=y.formatPrefix;e.version="0.4.2",e.format=z,e.formatPrefix=Y,e.locale=l,e.localeCaEs=b,e.localeCsCz=_,e.localeDeCh=S,e.localeDeDe=x,e.localeEnCa=M,e.localeEnGb=E,e.localeEnUs=y,e.localeEsEs=w,e.localeFiFi=O,e.localeFrCa=N,e.localeFrFr=T,e.localeHeIl=A,e.localeHuHu=D,e.localeItIt=k,e.localeJaJp=C,e.localeKoKr=P,e.localeMkMk=R,e.localeNlNl=L,e.localePlPl=I,e.localePtBr=U,e.localeRuRu=j,e.localeSvSe=F,e.localeZhCn=H,e.formatSpecifier=u,e.precisionFixed=f,e.precisionPrefix=d,e.precisionRound=p})},{}],6:[function(t,n,r){!function(i,a){"object"==typeof r&&void 0!==n?a(r,t("d3-time")):"function"==typeof e&&e.amd?e("d3-time-format",["exports","d3-time"],a):a(i.d3_time_format={},i.d3_time)}(this,function(e,t){"use strict";function n(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function r(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function i(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function a(e){function t(e,t){return function(n){var r,i,a,o=[],u=-1,s=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++u<c;)37===e.charCodeAt(u)&&(o.push(e.slice(s,u)),null!=(i=ee[r=e.charAt(++u)])?r=e.charAt(++u):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),s=u+1);return o.push(e.slice(s,u)),o.join("")}}function a(e,t){return function(n){var a=i(1900);if(o(a,e,n+="",0)!=n.length)return null;if("p"in a&&(a.H=a.H%12+12*a.p),"W"in a||"U"in a){"w"in a||(a.w="W"in a?1:0);var u="Z"in a?r(i(a.y)).getUTCDay():t(i(a.y)).getDay();a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(u+5)%7:a.w+7*a.U-(u+6)%7}return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,r(a)):t(a)}}function o(e,t,n,r){for(var i,a,o=0,u=t.length,s=n.length;o<u;){if(r>=s)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=Ue[i in ee?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function u(e,t,n){var r=we.exec(t.slice(n));return r?(e.p=Oe[r[0].toLowerCase()],n+r[0].length):-1}function K(e,t,n){var r=Ae.exec(t.slice(n));return r?(e.w=De[r[0].toLowerCase()],n+r[0].length):-1}function te(e,t,n){var r=Ne.exec(t.slice(n));return r?(e.w=Te[r[0].toLowerCase()],n+r[0].length):-1}function ne(e,t,n){var r=Pe.exec(t.slice(n));return r?(e.m=Re[r[0].toLowerCase()],n+r[0].length):-1}function re(e,t,n){var r=ke.exec(t.slice(n));return r?(e.m=Ce[r[0].toLowerCase()],n+r[0].length):-1}function ie(e,t,n){return o(e,ve,t,n)}function ae(e,t,n){return o(e,ye,t,n)}function oe(e,t,n){return o(e,be,t,n)}function ue(e){return xe[e.getDay()]}function se(e){return Se[e.getDay()]}function ce(e){return Ee[e.getMonth()]}function le(e){return Me[e.getMonth()]}function fe(e){return _e[+(e.getHours()>=12)]}function de(e){return xe[e.getUTCDay()]}function pe(e){return Se[e.getUTCDay()]}function me(e){return Ee[e.getUTCMonth()]}function he(e){return Me[e.getUTCMonth()]}function ge(e){return _e[+(e.getUTCHours()>=12)]}var ve=e.dateTime,ye=e.date,be=e.time,_e=e.periods,Se=e.days,xe=e.shortDays,Me=e.months,Ee=e.shortMonths,we=s(_e),Oe=c(_e),Ne=s(Se),Te=c(Se),Ae=s(xe),De=c(xe),ke=s(Me),Ce=c(Me),Pe=s(Ee),Re=c(Ee),Le={a:ue,A:se,b:ce,B:le,c:null,d:E,e:E,H:w,I:O,j:N,L:T,m:A,M:D,p:fe,S:k,U:C,w:P,W:R,x:null,X:null,y:L,Y:I,Z:U,"%":Z},Ie={a:de,A:pe,b:me,B:he,c:null,d:j,e:j,H:F,I:H,j:z,L:Y,m:q,M:X,p:ge,S:W,U:B,w:$,W:G,x:null,X:null,y:V,Y:J,Z:Q,"%":Z},Ue={a:K,A:te,b:ne,B:re,c:ie,d:v,e:v,H:b,I:b,j:y,L:x,m:g,M:_,p:u,S:S,U:f,w:l,W:d,x:ae,X:oe,y:m,Y:p,Z:h,"%":M};return Le.x=t(ye,Le),Le.X=t(be,Le),Le.c=t(ve,Le),Ie.x=t(ye,Ie),Ie.X=t(be,Ie),Ie.c=t(ve,Ie),{format:function(e){var r=t(e+="",Le);return r.parse=a(e,n),r.toString=function(){return e},r},utcFormat:function(e){var n=t(e+="",Ie);return n.parse=a(e,r),n.toString=function(){return e},n}}}function o(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function u(e){return e.replace(re,"\\$&")}function s(e){return new RegExp("^(?:"+e.map(u).join("|")+")","i")}function c(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function l(e,t,n){var r=te.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function f(e,t,n){var r=te.exec(t.slice(n));return r?(e.U=+r[0],n+r[0].length):-1}function d(e,t,n){var r=te.exec(t.slice(n));return r?(e.W=+r[0],n+r[0].length):-1}function p(e,t,n){var r=te.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function m(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function h(e,t,n){var r=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function g(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function v(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function y(e,t,n){var r=te.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function b(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function _(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function S(e,t,n){var r=te.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function x(e,t,n){var r=te.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function M(e,t,n){var r=ne.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function E(e,t){return o(e.getDate(),t,2)}function w(e,t){return o(e.getHours(),t,2)}function O(e,t){return o(e.getHours()%12||12,t,2)}function N(e,n){return o(1+t.day.count(t.year(e),e),n,3)}function T(e,t){return o(e.getMilliseconds(),t,3)}function A(e,t){return o(e.getMonth()+1,t,2)}function D(e,t){return o(e.getMinutes(),t,2)}function k(e,t){return o(e.getSeconds(),t,2)}function C(e,n){return o(t.sunday.count(t.year(e),e),n,2)}function P(e){return e.getDay()}function R(e,n){return o(t.monday.count(t.year(e),e),n,2)}function L(e,t){return o(e.getFullYear()%100,t,2)}function I(e,t){return o(e.getFullYear()%1e4,t,4)}function U(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+o(t/60|0,"0",2)+o(t%60,"0",2)}function j(e,t){return o(e.getUTCDate(),t,2)}function F(e,t){return o(e.getUTCHours(),t,2)}function H(e,t){return o(e.getUTCHours()%12||12,t,2)}function z(e,n){return o(1+t.utcDay.count(t.utcYear(e),e),n,3)}function Y(e,t){return o(e.getUTCMilliseconds(),t,3)}function q(e,t){return o(e.getUTCMonth()+1,t,2)}function X(e,t){return o(e.getUTCMinutes(),t,2)}function W(e,t){return o(e.getUTCSeconds(),t,2)}function B(e,n){return o(t.utcSunday.count(t.utcYear(e),e),n,2)}function $(e){return e.getUTCDay()}function G(e,n){return o(t.utcMonday.count(t.utcYear(e),e),n,2)}function V(e,t){return o(e.getUTCFullYear()%100,t,2)}function J(e,t){return o(e.getUTCFullYear()%1e4,t,4)}function Q(){return"+0000"}function Z(){return"%"}function K(e){return e.toISOString()}var ee={"-":"",_:" ",0:"0"},te=/^\s*\d+/,ne=/^%/,re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ie=a({dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),ae=a({dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["diumenge","dilluns","dimarts","dimecres","dijous","divendres","dissabte"],shortDays:["dg.","dl.","dt.","dc.","dj.","dv.","ds."],months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],shortMonths:["gen.","febr.","març","abr.","maig","juny","jul.","ag.","set.","oct.","nov.","des."]}),oe=a({dateTime:"%A, der %e. %B %Y, %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],
shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),ue=a({dateTime:"%A, der %e. %B %Y, %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),se=a({dateTime:"%a %b %e %X %Y",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),ce=a({dateTime:"%a %e %b %X %Y",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),le=a({dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],shortDays:["dom","lun","mar","mié","jue","vie","sáb"],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortMonths:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"]}),fe=a({dateTime:"%A, %-d. %Bta %Y klo %X",date:"%-d.%-m.%Y",time:"%H:%M:%S",periods:["a.m.","p.m."],days:["sunnuntai","maanantai","tiistai","keskiviikko","torstai","perjantai","lauantai"],shortDays:["Su","Ma","Ti","Ke","To","Pe","La"],months:["tammikuu","helmikuu","maaliskuu","huhtikuu","toukokuu","kesäkuu","heinäkuu","elokuu","syyskuu","lokakuu","marraskuu","joulukuu"],shortMonths:["Tammi","Helmi","Maalis","Huhti","Touko","Kesä","Heinä","Elo","Syys","Loka","Marras","Joulu"]}),de=a({dateTime:"%a %e %b %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["",""],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim","lun","mar","mer","jeu","ven","sam"],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["jan","fév","mar","avr","mai","jui","jul","aoû","sep","oct","nov","déc"]}),pe=a({dateTime:"%A, le %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]}),me=a({dateTime:"%A, %e ב%B %Y %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],shortDays:["א׳","ב׳","ג׳","ד׳","ה׳","ו׳","ש׳"],months:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],shortMonths:["ינו׳","פבר׳","מרץ","אפר׳","מאי","יוני","יולי","אוג׳","ספט׳","אוק׳","נוב׳","דצמ׳"]}),he=a({dateTime:"%Y. %B %-e., %A %X",date:"%Y. %m. %d.",time:"%H:%M:%S",periods:["de.","du."],days:["vasárnap","hétfő","kedd","szerda","csütörtök","péntek","szombat"],shortDays:["V","H","K","Sze","Cs","P","Szo"],months:["január","február","március","április","május","június","július","augusztus","szeptember","október","november","december"],shortMonths:["jan.","feb.","már.","ápr.","máj.","jún.","júl.","aug.","szept.","okt.","nov.","dec."]}),ge=a({dateTime:"%A %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],shortDays:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],shortMonths:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"]}),ve=a({dateTime:"%Y %b %e %a %X",date:"%Y/%m/%d",time:"%H:%M:%S",periods:["AM","PM"],days:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],shortDays:["日","月","火","水","木","金","土"],months:["睦月","如月","弥生","卯月","皐月","水無月","文月","葉月","長月","神無月","霜月","師走"],shortMonths:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]}),ye=a({dateTime:"%Y/%m/%d %a %X",date:"%Y/%m/%d",time:"%H:%M:%S",periods:["오전","오후"],days:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],shortDays:["일","월","화","수","목","금","토"],months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],shortMonths:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]}),be=a({dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["недела","понеделник","вторник","среда","четврток","петок","сабота"],shortDays:["нед","пон","вто","сре","чет","пет","саб"],months:["јануари","февруари","март","април","мај","јуни","јули","август","септември","октомври","ноември","декември"],shortMonths:["јан","фев","мар","апр","мај","јун","јул","авг","сеп","окт","ное","дек"]}),_e=a({dateTime:"%a %e %B %Y %T",date:"%d-%m-%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],shortDays:["zo","ma","di","wo","do","vr","za"],months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],shortMonths:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"]}),Se=a({dateTime:"%A, %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],shortDays:["Niedz.","Pon.","Wt.","Śr.","Czw.","Pt.","Sob."],months:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],shortMonths:["Stycz.","Luty","Marz.","Kwie.","Maj","Czerw.","Lipc.","Sierp.","Wrz.","Paźdz.","Listop.","Grudz."]}),xe=a({dateTime:"%A, %e de %B de %Y. %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],shortDays:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],shortMonths:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}),Me=a({dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],shortDays:["вс","пн","вт","ср","чт","пт","сб"],months:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],shortMonths:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"]}),Ee=a({dateTime:"%A den %d %B %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["fm","em"],days:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],shortDays:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],shortMonths:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"]}),we=a({dateTime:"%a %b %e %X %Y",date:"%Y/%-m/%-d",time:"%H:%M:%S",periods:["上午","下午"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],shortDays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortMonths:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]});K.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},K.toString=function(){return"%Y-%m-%dT%H:%M:%S.%LZ"};var Oe=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?K:ie.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ"),Ne=ie.format,Te=ie.utcFormat;e.version="0.2.1",e.format=Ne,e.utcFormat=Te,e.locale=a,e.localeCaEs=ae,e.localeDeCh=oe,e.localeDeDe=ue,e.localeEnCa=se,e.localeEnGb=ce,e.localeEnUs=ie,e.localeEsEs=le,e.localeFiFi=fe,e.localeFrCa=de,e.localeFrFr=pe,e.localeHeIl=me,e.localeHuHu=he,e.localeItIt=ge,e.localeJaJp=ve,e.localeKoKr=ye,e.localeMkMk=be,e.localeNlNl=_e,e.localePlPl=Se,e.localePtBr=xe,e.localeRuRu=Me,e.localeSvSe=Ee,e.localeZhCn=we,e.isoFormat=Oe})},{"d3-time":7}],7:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,o){function u(t){return e(t=new Date(+t)),t}return u.floor=u,u.round=function(t){var r=new Date(+t),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var a=[];if(t=new Date(t-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(t<r&&i>0))return a;for(n(t,1),e(t),t<r&&a.push(new Date(+t));n(t,i),e(t),t<r;)a.push(new Date(+t));return a},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),a.setTime(+n),e(i),e(a),Math.floor(r(i,a))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(o?function(t){return o(t)%e==0}:function(t){return u.count(0,t)%e==0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,a=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):o:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),s=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),c=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),f=n(0),d=n(1),p=n(2),m=n(3),h=n(4),g=n(5),v=n(6),y=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),b=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),_=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),S=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),x=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),M=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),E=r(0),w=r(1),O=r(2),N=r(3),T=r(4),A=r(5),D=r(6),k=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),C=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),P=o.range,R=u.range,L=s.range,I=c.range,U=l.range,j=f.range,F=d.range,H=p.range,z=m.range,Y=h.range,q=g.range,X=v.range,W=f.range,B=y.range,$=b.range,G=o,V=P,J=_.range,Q=S.range,Z=x.range,K=M.range,ee=E.range,te=w.range,ne=O.range,re=N.range,ie=T.range,ae=A.range,oe=D.range,ue=E.range,se=k.range,ce=C.range;e.version="0.1.1",e.milliseconds=P,e.seconds=R,e.minutes=L,e.hours=I,e.days=U,e.sundays=j,e.mondays=F,e.tuesdays=H,e.wednesdays=z,e.thursdays=Y,e.fridays=q,e.saturdays=X,e.weeks=W,e.months=B,e.years=$,e.utcMillisecond=G,e.utcMilliseconds=V,e.utcSeconds=J,e.utcMinutes=Q,e.utcHours=Z,e.utcDays=K,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=ae,e.utcSaturdays=oe,e.utcWeeks=ue,e.utcMonths=se,e.utcYears=ce,e.millisecond=o,e.second=u,e.minute=s,e.hour=c,e.day=l,e.sunday=f,e.monday=d,e.tuesday=p,e.wednesday=m,e.thursday=h,e.friday=g,e.saturday=v,e.week=f,e.month=y,e.year=b,e.utcSecond=_,e.utcMinute=S,e.utcHour=x,e.utcDay=M,e.utcSunday=E,e.utcMonday=w,e.utcTuesday=O,e.utcWednesday=N,e.utcThursday=T,e.utcFriday=A,e.utcSaturday=D,e.utcWeek=E,e.utcMonth=k,e.utcYear=C,e.interval=t})},{}],8:[function(e,t,n){t.exports={name:"datalib",version:"1.7.3",description:"JavaScript utilites for loading, summarizing and working with data.",keywords:["data","table","statistics","parse","csv","tsv","json","utility"],repository:{type:"git",url:"http://github.com/vega/datalib.git"},author:{name:"Jeffrey Heer",url:"http://idl.cs.washington.edu"},contributors:[{name:"Michael Correll",url:"http://pages.cs.wisc.edu/~mcorrell/"},{name:"Ryan Russell",url:"https://github.com/RussellSprouts"}],license:"BSD-3-Clause",dependencies:{"d3-dsv":"0.1","d3-format":"0.4","d3-time":"0.1","d3-time-format":"0.2",topojson:"^1.6.19",request:"^2.67.0","sync-request":"^2.1.0"},devDependencies:{browserify:"^12.0.1",chai:"^3.4.1",istanbul:"latest",jshint:"^2.9.1-rc1",mocha:"^2.3.4","uglify-js":"^2.6.1"},main:"src/index.js",scripts:{deploy:"npm run test && scripts/deploy.sh",lint:"jshint src/",test:"npm run lint && TZ=America/Los_Angeles mocha --recursive test/",cover:"TZ=America/Los_Angeles istanbul cover _mocha -- --recursive test/",build:"browserify src/index.js -d -s dl -o datalib.js",postbuild:"uglifyjs datalib.js -c -m -o datalib.min.js"},browser:{buffer:!1,fs:!1,http:!1,request:!1,"sync-request":!1,url:!1}}},{}],9:[function(e,t,n){var r=e("./util"),i=e("./time"),a=i.utc,o=t.exports;o.$year=r.$func("year",i.year.unit),o.$month=r.$func("month",i.months.unit),o.$date=r.$func("date",i.dates.unit),o.$day=r.$func("day",i.weekdays.unit),o.$hour=r.$func("hour",i.hours.unit),o.$minute=r.$func("minute",i.minutes.unit),o.$second=r.$func("second",i.seconds.unit),o.$utcYear=r.$func("utcYear",a.year.unit),o.$utcMonth=r.$func("utcMonth",a.months.unit),o.$utcDate=r.$func("utcDate",a.dates.unit),o.$utcDay=r.$func("utcDay",a.weekdays.unit),o.$utcHour=r.$func("utcHour",a.hours.unit),o.$utcMinute=r.$func("utcMinute",a.minutes.unit),o.$utcSecond=r.$func("utcSecond",a.seconds.unit)},{"./time":31,"./util":32}],10:[function(e,t,n){function r(){this._cells={},this._aggr=[],this._stream=!1}function i(e){if(a.isArray(e))return e;if(null==e)return[];var t,n,r=[];for(t in e)n=a.array(e[t]),r.push({name:t,ops:n});return r}var a=e("../util"),o=e("./measures"),u=e("./collector"),s=r.Flags={ADD_CELL:1,MOD_CELL:2},c=r.prototype;c.stream=function(e){return null==e?this._stream:(this._stream=!!e,this._aggr=[],this)},c.key=function(e){return null==e?this._key:(this._key=a.$(e),this)},c.groupby=function(e){return this._dims=a.array(e).map(function(e,t){if(null==(e=a.isString(e)?{name:e,get:a.$(e)}:a.isFunction(e)?{name:a.name(e)||e.name||"_"+t,get:e}:e.name&&a.isFunction(e.get)?e:null))throw"Invalid groupby argument: "+e;return e}),this.clear()},c.summarize=function(e){e=i(e),this._count=!0;var t,n,r,u,s,c,l,f=this._aggr=[];for(r=0;r<e.length;++r){for(u=0,t=[],n=e[r];u<n.ops.length;++u)s=n.ops[u],"count"!==s&&(this._count=!1),c=n.as&&n.as[u]||s+("*"===n.name?"":"_"+n.name),t.push(o[s](c));l=n.get&&a.$(n.get)||("*"===n.name?a.identity:a.$(n.name)),f.push({name:n.name,measures:o.create(t,this._stream,l,this._assign)})}return this.clear()},c.count=function(){return this.summarize({"*":"count"})},c._assign=function(e,t,n){e[t]=n},c.clear=function(){return this._cells={},this},c._cellkey=function(e){var t,n=this._dims,r=n.length,i=String(n[0].get(e));for(t=1;t<r;++t)i+="|"+n[t].get(e);return i},c._cell=function(e){var t=this._dims.length?this._cellkey(e):"";return this._cells[t]||(this._cells[t]=this._newcell(e,t))},c._newcell=function(e,t){var n,r={num:0,tuple:this._newtuple(e,t),flag:s.ADD_CELL,aggs:{}},i=this._aggr;for(n=0;n<i.length;++n)r.aggs[i[n].name]=new i[n].measures(r,r.tuple);return r.collect&&(r.data=new u(this._key)),r},c._newtuple=function(e){var t,n,r=this._dims,i={};for(t=0,n=r.length;t<n;++t)i[r[t].name]=r[t].get(e);return this._ingest(i)},c._ingest=a.identity,c._add=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num+=1,!this._count)for(n.collect&&n.data.add(e),t=0;t<r.length;++t)n.aggs[r[t].name].add(e);n.flag|=s.MOD_CELL,this._on_add&&this._on_add(e,n)},c._rem=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num-=1,!this._count)for(n.collect&&n.data.rem(e),t=0;t<r.length;++t)n.aggs[r[t].name].rem(e);n.flag|=s.MOD_CELL,this._on_rem&&this._on_rem(e,n)},c._mod=function(e,t){var n,r=this._cell(t),i=this._cell(e),o=this._aggr;for(r!==i?(r.num-=1,i.num+=1,r.collect&&r.data.rem(t),i.collect&&i.data.add(e)):r.collect&&!a.isObject(e)&&(r.data.rem(t),r.data.add(e)),n=0;n<o.length;++n)r.aggs[o[n].name].rem(t),i.aggs[o[n].name].add(e);r.flag|=s.MOD_CELL,i.flag|=s.MOD_CELL,this._on_mod&&this._on_mod(e,t,r,i)},c._markMod=function(e){this._cell(e).flag|=s.MOD_CELL},c.result=function(){var e,t,n,r=[],i=this._aggr;for(n in this._cells){if(e=this._cells[n],e.num>0){for(e.collect&&e.data.values(),t=0;t<i.length;++t)e.aggs[i[t].name].set();r.push(e.tuple)}else delete this._cells[n];e.flag=0}return this._rems=!1,r},c.changes=function(e){var t,n,r,i,a=e||{add:[],rem:[],mod:[]},o=this._aggr;for(i in this._cells){for(t=this._cells[i],n=t.flag,t.collect&&t.data.values(),r=0;r<o.length;++r)t.aggs[o[r].name].set();t.num<=0?(a.rem.push(t.tuple),delete this._cells[i],this._on_drop&&this._on_drop(t)):(this._on_keep&&this._on_keep(t),n&s.ADD_CELL?a.add.push(t.tuple):n&s.MOD_CELL&&a.mod.push(t.tuple)),t.flag=0}return this._rems=!1,a},c.execute=function(e){return this.clear().insert(e).result()},c.insert=function(e){this._consolidate();for(var t=0;t<e.length;++t)this._add(e[t]);return this},c.remove=function(e){if(!this._stream)throw"Aggregator not configured for streaming removes. Call stream(true) prior to calling summarize.";for(var t=0;t<e.length;++t)this._rem(e[t]);return this._rems=!0,this},c._consolidate=function(){if(this._rems){for(var e in this._cells)this._cells[e].collect&&this._cells[e].data.values();this._rems=!1}},t.exports=r},{"../util":32,"./collector":11,"./measures":13}],11:[function(e,t,n){function r(e){this._add=[],this._rem=[],this._key=e||null,this._last=null}var i=e("../util"),a=e("../stats"),o="__dl_rem__",u=r.prototype;u.add=function(e){this._add.push(e)},u.rem=function(e){this._rem.push(e)},u.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,r,u=this._add,s=this._rem,c=this._key,l=Array(u.length-s.length);if(i.isObject(s[0]))if(c)for(r=i.toMap(s,c),e=0,t=0,n=u.length;e<n;++e)r.hasOwnProperty(c(u[e]))||(l[t++]=u[e]);else{for(e=0,n=s.length;e<n;++e)s[e][o]=1;for(e=0,t=0,n=u.length;e<n;++e)u[e][o]||(l[t++]=u[e]);for(e=0,n=s.length;e<n;++e)delete s[e][o]}else for(r=a.count.map(s),e=0,t=0,n=u.length;e<n;++e)r[u[e]]>0?r[u[e]]-=1:l[t++]=u[e];return this._rem=[],this._add=l},u.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=a.extent.index(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},u.argmin=function(e){return this.extent(e)[0]},u.argmax=function(e){return this.extent(e)[1]},u.min=function(e){var t=this.extent(e)[0];return null!=t?e(t):1/0},u.max=function(e){var t=this.extent(e)[1];return null!=t?e(t):-1/0},u.quartile=function(e){return this._get===e&&this._q||(this._q=a.quartile(this.values(),e),this._get=e),this._q},u.q1=function(e){return this.quartile(e)[0]},u.q2=function(e){return this.quartile(e)[1]},u.q3=function(e){return this.quartile(e)[2]},t.exports=r},{"../stats":29,"../util":32}],12:[function(e,t,n){var r=e("../util"),i=e("./aggregator");t.exports=function(){var e=[].reduce.call(arguments,function(e,t){return e.concat(r.array(t))},[]);return(new i).groupby(e).summarize({"*":"values"})}},{"../util":32,"./aggregator":10}],13:[function(e,t,n){function r(e){return function(t){var n=o.extend({init:"",add:"",rem:"",idx:0},e);return n.out=t||e.name,n}}function i(e,t){function n(e,r){function i(t){e[t]||n(e,e[t]=u[t]())}return r.req&&r.req.forEach(i),t&&r.str&&r.str.forEach(i),e}var r=e.reduce(n,e.reduce(function(e,t){return e[t.name]=t,e},{}));return o.vals(r).sort(function(e,t){return e.idx-t.idx})}function a(t,n,r,a){var u=i(t,n),s="this.cell = cell; this.tuple = t; this.valid = 0; this.missing = 0;",c="if (v==null) this.missing++; if (!this.isValid(v)) return; ++this.valid;",l="if (v==null) this.missing--; if (!this.isValid(v)) return; --this.valid;",f="var t = this.tuple; var cell = this.cell;";return u.forEach(function(e){e.idx<0?(s=e.init+s,c=e.add+c,l=e.rem+l):(s+=e.init,c+=e.add,l+=e.rem)}),t.slice().sort(function(e,t){return e.idx-t.idx}).forEach(function(e){f+="this.assign(t,'"+e.out+"',"+e.set+");"}),f+="return t;",s=Function("cell","t",s),s.prototype.assign=a,s.prototype.add=Function("t","var v = this.get(t);"+c),s.prototype.rem=Function("t","var v = this.get(t);"+l),s.prototype.set=Function(f),s.prototype.get=r,s.prototype.distinct=e("../stats").count.distinct,s.prototype.isValid=o.isValid,s.fields=t.map(o.$("out")),s}var o=e("../util"),u={values:r({name:"values",init:"cell.collect = true;",set:"cell.data.values()",idx:-1}),count:r({name:"count",set:"cell.num"}),missing:r({name:"missing",set:"this.missing"}),valid:r({name:"valid",set:"this.valid"}),sum:r({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:r({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:r({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:r({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:r({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:r({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:r({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),stderr:r({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : 0",req:["variance"],idx:2}),median:r({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:r({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:r({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),distinct:r({name:"distinct",set:"this.distinct(cell.data.values(), this.get)",req:["values"],idx:3}),argmin:r({name:"argmin",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin = this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:r({name:"argmax",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax = this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:r({name:"min",init:"this.min = +Infinity;",add:"if (v < this.min) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:r({name:"max",init:"this.max = -Infinity;",add:"if (v > this.max) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4}),modeskew:r({name:"modeskew",set:"this.dev===0 ? 0 : (this.mean - cell.data.q2(this.get)) / Math.sqrt(this.dev/(this.valid-1))",req:["mean","variance","median"],idx:5})};u.create=a,t.exports=u},{"../stats":29,"../util":32}],14:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,u,s,c,l,f=e.maxbins||15,d=e.base||10,p=Math.log(d),m=e.div||[5,2],h=e.min,g=e.max,v=g-h;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,v/f,0,e.steps.length))];else{for(n=Math.ceil(Math.log(f)/p),r=e.minstep||0,t=Math.max(r,Math.pow(d,Math.round(Math.log(v)/p)-n));Math.ceil(v/t)>f;)t*=d;for(c=0;c<m.length;++c)(s=t/m[c])>=r&&v/s<=f&&(t=s)}return s=Math.log(t),u=s>=0?0:1+~~(-s/p),l=Math.pow(d,-u-1),h=Math.min(h,Math.floor(h/t+l)*t),g=Math.ceil(g/t)*t,{start:h,stop:g,step:t,unit:{precision:u},value:a,index:o}}function i(e,t,n,r){for(;n<r;){var i=n+r>>>1;c.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e){return this.step*Math.floor(e/this.step+f)}function o(e){return Math.floor((e-this.start)/this.step+f)}function u(e){return this.unit.date(a.call(this,e))}function s(e){return o.call(this,this.unit.unit(e))}var c=e("../util"),l=e("../time"),f=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,a=e.maxbins||20,o=e.minbins||4,c=+i-+n,f=e.unit?t[e.unit]:t.find(c,o,a),d=r({min:null!=f.min?f.min:f.unit(n),max:null!=f.max?f.max:f.unit(i),maxbins:a,minstep:f.minstep,steps:f.step});return d.unit=f,d.index=s,e.raw||(d.value=u),d},t.exports=r},{"../time":31,"../util":32}],15:[function(e,t,n){function r(e,t,n){n=o(e,t,n);var r=a(n);return r?d.$func("bin",r.unit.unit?function(e){return r.value(r.unit.unit(e))}:function(e){return r.value(e)})(n.accessor):n.accessor||d.identity}function i(e,t,n){n=o(e,t,n);var r=a(n);return r?u(e,n.accessor,r):s(e,n.accessor,n&&n.sort)}function a(e){var t=e.type,n=null;return(null==t||m[t])&&("integer"===t&&null==e.minstep&&(e.minstep=1),n="date"===t?c.date(e):c(e)),n}function o(){var e=arguments,t=0,n=d.isArray(e[t])?e[t++]:null,r=d.isFunction(e[t])||d.isString(e[t])?d.$(e[t++]):null,i=d.extend({},e[t]);if(n&&(i.type=i.type||f(n,r),m[i.type])){var a=p.extent(n,r);i=d.extend({min:a[0],max:a[1]},i)}return r&&(i.accessor=r),i}function u(e,t,n){for(var r,i,a=l.range(n.start,n.stop+n.step/2,n.step).map(function(e){return{value:n.value(e),count:0}}),o=0;o<e.length;++o)if(r=t?t(e[o]):e[o],d.isValid(r)){if((i=n.index(r))<0||i>=a.length||!isFinite(i))continue;a[i].count+=1}return a.bins=n,a}function s(e,t,n){var r=p.unique(e,t),i=p.count.map(e,t);return r.map(function(e){return{value:e,count:i[e]}}).sort(d.comparator(n?"-count":"+value"))}var c=e("./bins"),l=e("../generate"),f=e("../import/type"),d=e("../util"),p=e("../stats"),m={integer:1,number:1,date:1};t.exports={$bin:r,histogram:i}},{"../generate":18,"../import/type":27,"../stats":29,"../util":32,"./bins":14}],16:[function(e,t,n){function r(e,t){t=u.extend({separator:" ",minwidth:8,maxwidth:15},t);var n=t.fields||u.keys(e[0]),r=s.all(e);if(t.start||t.limit){var i=t.start||0,a=t.limit?i+t.limit:e.length;e=e.slice(i,a)}var o=n.map(function(n){var i=f[r[n]]||"",a=l("{{"+n+i+"}}"),o=c.max(e,function(e){return a(e).length});return o=Math.max(Math.min(n.length,t.minwidth),o),t.maxwidth>0?Math.min(o,t.maxwidth):o}),p=n.map(function(e,t){return u.truncate(u.pad(e,o[t],"center"),o[t])}).join(t.separator),m=l(n.map(function(e,t){return"{{"+e+(f[r[e]]||"")+"|pad:"+o[t]+","+(d[r[e]]||"right")+"|truncate:"+o[t]+"}}"}).join(t.separator));return p+"\n"+e.map(m).join("\n")}function i(e){e=e?e.__summary__?e:c.summary(e):this;var t,n,r=[];for(t=0,n=e.length;t<n;++t)r.push("-- "+e[t].field+" --"),"string"===e[t].type||e[t].distinct<10?r.push(o(e[t])):r.push(a(e[t])),r.push("");return r.join("\n")}function a(e){return["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"min:      "+e.min,"max:      "+e.max,"median:   "+e.median,"mean:     "+e.mean,"stdev:    "+e.stdev,"modeskew: "+e.modeskew].join("\n")}function o(e){var t=["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"top values: "],n=e.unique,r=u.keys(n).sort(function(e,t){return n[t]-n[e]}).slice(0,6).map(function(e){return" '"+e+"' ("+n[e]+")"});return t.concat(r).join("\n")}var u=e("./util"),s=e("./import/type"),c=e("./stats"),l=e("./template");t.exports={table:r,summary:i};var f={date:'|time:"%m/%d/%Y %H:%M:%S"',number:'|number:".4f"',integer:'|number:"d"'},d={number:"left",integer:"left"}},{"./import/type":27,"./stats":29,"./template":30,"./util":32}],17:[function(e,t,n){function r(e){return e.length>4&&"locale"+(e[0].toUpperCase()+e[1].toLowerCase()+e[3].toUpperCase()+e[4].toLowerCase())}function i(e){var t=S.isString(e)?E[r(e)]:E.locale(e);if(null==t)throw Error("Unrecognized locale: "+e);w=t}function a(e){var t=S.isString(e)?M[r(e)]:M.locale(e);if(null==t)throw Error("Unrecognized locale: "+e);O=t,v=y=b=_=null}function o(e,t){e.length||(e=[0]),null==t&&(t=10);var n=e[0],r=e[e.length-1];r<n&&(o=r,r=n,n=o);var i=r-n||(t=1,n||r||1),a=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),o=i/t/a;return o>=T?a*=10:o>=A?a*=5:o>=D&&(a*=2),[Math.ceil(n/a)*a,Math.floor(r/a)*a+a/2,a]}function u(e,t){return function(n){var r=e(n),i=r.indexOf(t);if(i<0)return r;for(var a=s(r,i),o=a<r.length?r.slice(a):"";--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}function s(e,t){var n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if((n=e.charCodeAt(r))>=48&&n<=57)return r+1}function c(e){var t=w.format(".1f")(1)[1];switch(null==e&&(e=","),e=E.formatSpecifier(e),null==e.precision&&(e.precision=12),e.type){case"%":e.precision-=2;break;case"e":e.precision-=1}return u(w.format(e),t)}function l(e,t,n){var r=o(e,t);switch(null==n&&(n=",f"),n=E.formatSpecifier(n),n.type){case"s":var i=Math.max(Math.abs(r[0]),Math.abs(r[1]));return null==n.precision&&(n.precision=E.precisionPrefix(r[2],i)),w.formatPrefix(n,i);case"":case"e":case"g":case"p":case"r":null==n.precision&&(n.precision=E.precisionRound(r[2],Math.max(Math.abs(r[0]),Math.abs(r[1])))-("e"===n.type));break;case"f":case"%":null==n.precision&&(n.precision=E.precisionFixed(r[2])-2*("%"===n.type))}return w.format(n)}function f(){var e=O.format,t=e(".%L"),n=e(":%S"),r=e("%I:%M"),i=e("%I %p"),a=e("%a %d"),o=e("%b %d"),u=e("%B"),s=e("%Y");return function(e){var c=+e;return(x.second(e)<c?t:x.minute(e)<c?n:x.hour(e)<c?r:x.day(e)<c?i:x.month(e)<c?x.week(e)<c?a:o:x.year(e)<c?u:s)(e)}}function d(){var e=O.utcFormat,t=e(".%L"),n=e(":%S"),r=e("%I:%M"),i=e("%I %p"),a=e("%a %d"),o=e("%b %d"),u=e("%B"),s=e("%Y");return function(e){var c=+e;return(x.utcSecond(e)<c?t:x.utcMinute(e)<c?n:x.utcHour(e)<c?r:x.utcDay(e)<c?i:x.utcMonth(e)<c?x.utcWeek(e)<c?a:o:x.utcYear(e)<c?u:s)(e)}}function p(e,t){var n=t?y||(y=O.format("%b")):v||(v=O.format("%B"));return N.setMonth(e),n(N)}function m(e,t){var n=t?_||(_=O.format("%a")):b||(b=O.format("%A"));return N.setMonth(0),N.setDate(2+e),n(N)}
function h(e){return Math.floor(e.getMonth()/3)+1}function g(e){return Math.floor(e.getUTCMonth()/3)+1}var v,y,b,_,S=e("./util"),x=e("d3-time"),M=e("d3-time-format"),E=e("d3-format"),w=E,O=M,N=new Date(2e3,0,1);t.exports={numberLocale:i,number:function(e){return w.format(e)},numberPrefix:function(e,t){return w.formatPrefix(e,t)},timeLocale:a,time:function(e){return O.format(e)},utc:function(e){return O.utcFormat(e)},locale:function(e){i(e),a(e)},auto:{number:c,linear:l,time:function(){return f()},utc:function(){return d()}},month:p,day:m,quarter:h,utcQuarter:g};var T=Math.sqrt(50),A=Math.sqrt(10),D=Math.sqrt(2)},{"./util":32,"d3-format":5,"d3-time":7,"d3-time-format":6}],18:[function(e,t,n){var r=e("./util"),i=t.exports;i.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(n<0)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,r=function(){return e+n*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=t?1/n:0},r.cdf=function(r){return r<e?0:r>t?1:(r-e)/n},r.icdf=function(t){return t>=0&&t<=1?e+t*n:NaN},r},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,r=function(){return e+Math.floor(n*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<t?1/n:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=t?1:(i-e+1)/n},r.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*n):NaN},r},i.random.normal=function(e,t){e=e||0,t=t||1;var n,r=function(){var r,i,a=0,o=0;if(void 0!==n)return a=n,n=void 0,a;do{a=2*Math.random()-1,o=2*Math.random()-1,r=a*a+o*o}while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+o*i*t,e+a*i*t};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},r.cdf=function(n){var r,i=(n-e)/t,a=Math.abs(i);if(a>37)r=0;else{var o,u=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,r=u*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,r/=o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,r=u/o/2.506628274631)}return i>0?1-r:r},r.icdf=function(n){if(n<=0||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),a=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,o=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(a*a-o)-a);return e+t*Math.SQRT2*u},r},i.random.bootstrap=function(e,t){var n=e.filter(r.isValid),a=n.length,o=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*a)]+(o?o():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":32}],19:[function(e,t,n){function r(e,t){if(e){var n=t.header;e=(n?n.join(t.delimiter)+"\n":"")+e}return a.dsv(t.delimiter).parse(e)}var i=e("../../util"),a=e("d3-dsv");r.delimiter=function(e){var t={delimiter:e};return function(e,n){return r(e,n?i.extend(n,t):t)}},t.exports=r},{"../../util":32,"d3-dsv":4}],20:[function(e,t,n){var r=e("./dsv");t.exports={json:e("./json"),topojson:e("./topojson"),treejson:e("./treejson"),dsv:r,csv:r.delimiter(","),tsv:r.delimiter("\t")}},{"./dsv":19,"./json":21,"./topojson":22,"./treejson":23}],21:[function(e,t,n){var r=e("../../util");t.exports=function(e,t){var n=r.isObject(e)&&!r.isBuffer(e)?e:JSON.parse(e);return t&&t.property&&(n=r.accessor(t.property)(n)),n}},{"../../util":32}],22:[function(e,t,n){var r=e("./json"),i=function(e,t){var n=i.topojson;if(null==n)throw Error("TopoJSON library not loaded.");var a,o=r(e,t);if(t&&t.feature){if(a=o.objects[t.feature])return n.feature(o,a).features;throw Error("Invalid TopoJSON object: "+t.feature)}if(t&&t.mesh){if(a=o.objects[t.mesh])return[n.mesh(o,o.objects[t.mesh])];throw Error("Invalid TopoJSON object: "+t.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")};i.topojson=e("topojson"),t.exports=i},{"./json":21,topojson:37}],23:[function(e,t,n){function r(e,t){function n(e,t){e[i]=t,a.push(e);var o=e[r];if(o)for(var u=0;u<o.length;++u)n(o[u],e)}var r=t&&t.children||"children",i=t&&t.parent||"parent",a=[];return n(e,null),a.root=e,a}var i=e("./json");t.exports=function(e,t){return r(i(e,t),t)}},{"./json":21}],24:[function(e,t,n){function r(t){var n=t.url;if(!n&&t.file)return p+t.file;if(t.baseURL&&!d.test(n)&&(l(n,"/")||"/"===t.baseURL[t.baseURL.length-1]||(n="/"+n),n=t.baseURL+n),!i.useXHR&&l(n,"//")&&(n=(t.defaultProtocol||"http")+":"+n),t.domainWhiteList){var r,a;if(i.useXHR){var o=document.createElement("a");o.href=n,""===o.host&&(o.href=o.href),r=o.hostname.toLowerCase(),a=window.location.hostname}else{var u=e("url").parse(n);r=u.hostname,a=null}if(a!==r){if(!t.domainWhiteList.some(function(e){var t=r.length-e.length;return e===r||t>1&&"."===r[t-1]&&r.lastIndexOf(e)===t}))throw"URL is not whitelisted: "+n}}return n}function i(e,t){return i.loader(e,t)}function a(e,t){var n,r=t||function(e){throw e};try{n=i.sanitizeUrl(e)}catch(e){return void r(e)}if(n)return i.useXHR?i.xhr(n,e,t):l(n,p)?i.file(n.slice(p.length),e,t):n.indexOf("://")<0?i.file(n,e,t):i.http(n,e,t);r("Invalid URL: "+e.url)}function o(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function u(e,t,n){function r(){var e=u.status;!e&&o(u)||e>=200&&e<300||304===e?n(null,u.responseText):n(u,null)}var a=!!n,u=new XMLHttpRequest;if("undefined"==typeof XDomainRequest||"withCredentials"in u||!/^(http(s)?:)?\/\//.test(e)||(u=new XDomainRequest),a&&("onload"in u?u.onload=u.onerror=r:u.onreadystatechange=function(){u.readyState>3&&r()}),u.open("GET",e,a),u.setRequestHeader){var s=f.extend({},i.headers,t.headers);for(var c in s)u.setRequestHeader(c,s[c])}if(u.send(),!a&&o(u))return u.responseText}function s(t,n,r){var i=e("fs");if(!r)return i.readFileSync(t,"utf8");i.readFile(t,r)}function c(t,n,r){var a=f.extend({},i.headers,n.headers),o={url:t,encoding:null,gzip:!0,headers:a};if(!r)return e("sync-request")("GET",t,o).getBody();e("request")(o,function(e,t,n){e||200!==t.statusCode?(e=e||"Load failed with response code "+t.statusCode+".",r(e,null)):r(null,n)})}function l(e,t){return null!=e&&0===e.lastIndexOf(t,0)}var f=e("../util"),d=/^([A-Za-z]+:)?\/\//,p="file://";i.loader=a,i.sanitizeUrl=r,i.xhr=u,i.file=s,i.http=c,i.useXHR="undefined"!=typeof XMLHttpRequest,i.headers={},t.exports=i},{"../util":32,fs:1,request:1,"sync-request":1,url:1}],25:[function(e,t,n){function r(e,t){var n=t&&t.type||"json";return e=u[n](e,t),t&&t.parse&&i(e,t.parse),e}function i(e,t){var n,r,i,u,c,l,f=e.length;for(t="auto"===t?o.inferAll(e):a.duplicate(t),n=a.keys(t),r=n.map(function(e){var n=t[e];if(n&&0===n.indexOf("date:")){var r=n.split(/:(.+)?/,2),i=r[1];if(!("'"===i[0]&&"'"===i[i.length-1]||'"'===i[0]&&'"'===i[i.length-1]))throw Error("Format pattern must be quoted: "+i);return i=i.slice(1,-1),i=s(i),function(e){return i.parse(e)}}if(!o.parsers[n])throw Error("Illegal format pattern: "+e+":"+n);return o.parsers[n]}),u=0,l=n.length;u<f;++u)for(i=e[u],c=0;c<l;++c)i[n[c]]=r[c](i[n[c]]);o.annotation(e,t)}var a=e("../util"),o=e("./type"),u=e("./formats"),s=e("../format").time;r.formats=u,t.exports=r},{"../format":17,"../util":32,"./formats":20,"./type":27}],26:[function(e,t,n){var r=e("../util"),i=e("./load"),a=e("./read");t.exports=r.keys(a.formats).reduce(function(e,t){return e[t]=function(e,n,o){r.isString(e)&&(e={url:e}),2===arguments.length&&r.isFunction(n)&&(o=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=t;var u=i(e,o?function(e,t){if(e)return void o(e,null);try{t=a(t,n),o(null,t)}catch(e){o(e,null)}}:void 0);if(!o)return a(u,n)},e},{})},{"../util":32,"./load":24,"./read":25}],27:[function(e,t,n){function r(e,t){if(!t)return e&&e[f]||null;e[f]=t}function i(e){return l.keys(e)}function a(e){return"["+e+"]"}function o(e,t){e=l.array(e),t=l.$(t);var n,r,i;if(e[f]&&(n=t(e[f]),l.isString(n)))return n;for(r=0,i=e.length;!l.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function u(e,t){if(e.length){var n=t?l.identity:(t=i(e[0]),a);return t.reduce(function(t,r){return t[r]=o(e,n(r)),t},{})}}function s(e,t){e=l.array(e),t=l.$(t);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<a.length;++r)l.isValid(i)&&!p[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function c(e,t){var n=t?l.identity:(t=i(e[0]),a);return t.reduce(function(t,r){return t[r]=s(e,n(r)),t},{})}var l=e("../util"),f="__types__",d={boolean:l.boolean,integer:l.number,number:l.number,date:l.date,string:function(e){return null==e||""===e?null:e+""}},p={boolean:function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)==~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};o.annotation=r,o.all=u,o.infer=s,o.inferAll=c,o.parsers=d,t.exports=o},{"../util":32}],28:[function(e,t,n){var r=e("./util"),i={version:e("../package.json").version,load:e("./import/load"),read:e("./import/read"),type:e("./import/type"),Aggregator:e("./aggregate/aggregator"),groupby:e("./aggregate/groupby"),bins:e("./bins/bins"),$bin:e("./bins/histogram").$bin,histogram:e("./bins/histogram").histogram,format:e("./format"),template:e("./template"),time:e("./time")};r.extend(i,r),r.extend(i,e("./accessor")),r.extend(i,e("./generate")),r.extend(i,e("./stats")),r.extend(i,e("./import/readers")),r.extend(i.format,e("./format-tables")),i.print={table:i.format.table,summary:i.format.summary},t.exports=i},{"../package.json":8,"./accessor":9,"./aggregate/aggregator":10,"./aggregate/groupby":12,"./bins/bins":14,"./bins/histogram":15,"./format":17,"./format-tables":16,"./generate":18,"./import/load":24,"./import/read":25,"./import/readers":26,"./import/type":27,"./stats":29,"./template":30,"./time":31,"./util":32}],29:[function(e,t,n){function r(e,t,n){var r=e&&e.nullh||0,i=s.random.normal(0,1),a=c.mean(t,n),o=c.stdev(t,n)/Math.sqrt(c.count.valid(t,n));if(0===o)return a-r==0?1:0;var u=(a-r)/o;return 2*i.cdf(-Math.abs(u))}function i(e,t,n,r){var i,a=r?t.map(o.$(n)):t,u=r?t.map(o.$(r)):n,s=c.count(a),l=c.count(u),f=Array();if(s!==l)throw Error("Array lengths must match.");for(i=0;i<s;++i)o.isValid(a[i])&&o.isValid(u[i])&&f.push(a[i]-u[i]);return c.z.test(f,e&&e.nullh||0)}function a(e,t,n,r){var i=r?t.map(o.$(n)):t,a=r?t.map(o.$(r)):n,u=c.count.valid(i),l=c.count.valid(a),f=s.random.normal(0,1),d=c.mean(i)-c.mean(a)-(e&&e.nullh||0),p=Math.sqrt(c.variance(i)/u+c.variance(a)/l);if(0===p)return 0===d?1:0;var m=d/p;return 2*f.cdf(-Math.abs(m))}var o=e("./util"),u=e("./import/type"),s=e("./generate"),c=t.exports;c.unique=function(e,t,n){t=o.$(t),n=n||[];var r,i,a,u={};for(i=0,a=e.length;i<a;++i)(r=t?t(e[i]):e[i])in u||(u[r]=1,n.push(r));return n},c.count=function(e){return e&&e.length||0},c.count.valid=function(e,t){t=o.$(t);var n,r,i,a=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o.isValid(n)&&(a+=1);return a},c.count.missing=function(e,t){t=o.$(t);var n,r,i=0;for(n=0,r=e.length;n<r;++n)null==(t?t(e[n]):e[n])&&(i+=1);return i},c.count.distinct=function(e,t){t=o.$(t);var n,r,i,a={},u=0;for(r=0,i=e.length;r<i;++r)(n=t?t(e[r]):e[r])in a||(a[n]=1,u+=1);return u},c.count.map=function(e,t){t=o.$(t);var n,r,i,a={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],a[n]=n in a?a[n]+1:1;return a},c.median=function(e,t){return t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp),c.quantile(e,.5)},c.quartile=function(e,t){t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp);var n=c.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},c.quantile=function(e,t,n){void 0===n&&(n=t,t=o.identity),t=o.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),a=+t(e[i-1]),u=r-i;return u?a+u*(t(e[i])-a):a},c.sum=function(e,t){t=o.$(t);for(var n,r=0,i=0,a=e.length;i<a;++i)n=t?t(e[i]):e[i],o.isValid(n)&&(r+=n);return r},c.mean=function(e,t){t=o.$(t);var n,r,i,a,u,s=0;for(r=0,a=0,i=e.length;r<i;++r)u=t?t(e[r]):e[r],o.isValid(u)&&(n=u-s,s+=n/++a);return s},c.mean.geometric=function(e,t){t=o.$(t);var n,r,i,a,u=1;for(a=0,n=0,r=e.length;a<r;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");u*=i,++n}return u=n>0?Math.pow(u,1/n):0},c.mean.harmonic=function(e,t){t=o.$(t);var n,r,i,a,u=0;for(a=0,n=0,r=e.length;a<r;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(u+=1/i,++n);return n/u},c.variance=function(e,t){if(t=o.$(t),!o.isArray(e)||e.length<2)return 0;var n,r,i,a,u=0,s=0;for(r=0,i=0;r<e.length;++r)a=t?t(e[r]):e[r],o.isValid(a)&&(n=a-u,u+=n/++i,s+=n*(a-u));return s/=i-1},c.stdev=function(e,t){return Math.sqrt(c.variance(e,t))},c.modeskew=function(e,t){var n=c.mean(e,t),r=c.median(e,t),i=c.stdev(e,t);return 0===i?0:(n-r)/i},c.min=function(e,t){return c.extent(e,t)[0]},c.max=function(e,t){return c.extent(e,t)[1]},c.extent=function(e,t){t=o.$(t);var n,r,i,a,u=e.length;for(a=0;a<u;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){n=r=i;break}for(;a<u;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},c.extent.index=function(e,t){t=o.$(t);var n,r,i,a,u=-1,s=-1,c=e.length;for(a=0;a<c;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){n=r=i,u=s=a;break}for(;a<c;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(i<n&&(n=i,u=a),i>r&&(r=i,s=a));return[u,s]},c.dot=function(e,t,n){var r,i,a=0;if(n)for(t=o.$(t),n=o.$(n),r=0;r<e.length;++r)(i=t(e[r])*n(e[r]))===i&&(a+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)(i=e[r]*t[r])===i&&(a+=i)}return a},c.dist=function(e,t,n,r){var i,a,u=o.isFunction(n)||o.isString(n),s=e,c=u?e:t,l=u?r:n,f=2===l||null==l,d=e.length,p=0;for(u&&(t=o.$(t),n=o.$(n)),a=0;a<d;++a)i=u?t(s[a])-n(c[a]):s[a]-c[a],p+=f?i*i:Math.pow(Math.abs(i),l);return f?Math.sqrt(p):Math.pow(p,1/l)},c.cohensd=function(e,t,n){var r=n?e.map(o.$(t)):e,i=n?e.map(o.$(n)):t,a=c.mean(r),u=c.mean(i),s=c.count.valid(r),l=c.count.valid(i);if(s+l-2<=0)return 0;var f=c.variance(r),d=c.variance(i),p=Math.sqrt(((s-1)*f+(l-1)*d)/(s+l-2));return 0===p?0:(a-u)/p},c.covariance=function(e,t,n){var r,i,a,u,s,l=n?e.map(o.$(t)):e,f=n?e.map(o.$(n)):t,d=l.length,p=c.mean(l),m=c.mean(f),h=0,g=0;if(d!==f.length)throw Error("Input lengths must match.");for(r=0;r<d;++r)if(i=l[r],u=o.isValid(i),a=f[r],s=o.isValid(a),u&&s)h+=(i-p)*(a-m),++g;else if(u||s)throw Error("Valid values must align.");return h/(g-1)},c.rank=function(e,t){t=o.$(t)||o.identity;var n,r,i,a=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(o.comparator("val")),u=e.length,s=Array(u),c=-1,l={};for(n=0;n<u;++n){if(r=a[n].val,c<0&&l===r)c=n-1;else if(c>-1&&l!==r){for(i=1+(n-1+c)/2;c<n;++c)s[a[c].idx]=i;c=-1}s[a[n].idx]=n+1,l=r}if(c>-1)for(i=1+(u-1+c)/2;c<u;++c)s[a[c].idx]=i;return s},c.cor=function(e,t,n){var r=n;n=r?e.map(o.$(n)):t,t=r?e.map(o.$(t)):e;var i=c.dot(t,n),a=c.mean(t),u=c.mean(n),s=c.stdev(t),l=c.stdev(n),f=e.length;return(i-f*a*u)/((f-1)*s*l)},c.cor.rank=function(e,t,n){var r,i,a,o=n?c.rank(e,t):c.rank(e),u=n?c.rank(e,n):c.rank(t),s=e.length;for(r=0,i=0;r<s;++r)a=o[r]-u[r],i+=a*a;return 1-6*i/(s*(s*s-1))},c.cor.dist=function(e,t,n){var r,i,a,u,s=n?e.map(o.$(t)):e,l=n?e.map(o.$(n)):t,f=c.dist.mat(s),d=c.dist.mat(l),p=f.length;for(r=0,i=0,a=0,u=0;r<p;++r)i+=f[r]*f[r],a+=d[r]*d[r],u+=f[r]*d[r];return Math.sqrt(u/Math.sqrt(i*a))},c.linearRegression=function(e,t,n){var r,i,a=n?e.map(o.$(t)):e,u=n?e.map(o.$(n)):t,s=a.length,l=c.covariance(a,u),f=c.stdev(a),d=c.stdev(u),p=l/(f*f),m=c.mean(u)-p*c.mean(a),h={slope:p,intercept:m,R:l/(f*d),rss:0};for(i=0;i<s;++i)o.isValid(a[i])&&o.isValid(u[i])&&(r=p*a[i]+m-u[i],h.rss+=r*r);return h},c.bootstrap={},c.bootstrap.ci=function(e,t,n,r,i){var a,u,l,f,d,p,m;for(o.isFunction(t)||o.isString(t)?(a=e.map(o.$(t)),u=n,l=r,f=i):(a=e,u=t,l=n,f=r),u=u?+u:1e3,l=l||.05,d=s.random.bootstrap(a,f),m=0,p=Array(u);m<u;++m)p[m]=c.mean(d.samples(a.length));return p.sort(o.numcmp),[c.quantile(p,l/2),c.quantile(p,1-l/2)]},c.z={},c.z.ci=function(e,t,n){var r=e,i=t;(o.isFunction(t)||o.isString(t))&&(r=e.map(o.$(t)),i=n),i=i||.05;var a=.05===i?1.96:s.random.normal(0,1).icdf(1-i/2),u=c.mean(r),l=c.stdev(r)/Math.sqrt(c.count.valid(r));return[u-a*l,u+a*l]},c.z.test=function(e,t,n,u){return o.isFunction(n)||o.isString(n)?(u&&u.paired?i:a)(u,e,t,n):o.isArray(t)?(n&&n.paired?i:a)(n,e,t):o.isFunction(t)||o.isString(t)?r(n,e,t):r(t,e)},c.dist.mat=function(e){var t,n,r,i=e.length,a=i*i,o=Array(a),u=s.zeros(i),c=0;for(n=0;n<i;++n)for(o[n*i+n]=0,r=n+1;r<i;++r)o[n*i+r]=t=Math.abs(e[n]-e[r]),o[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)c+=u[n],u[n]/=i;for(c/=a,n=0;n<i;++n)for(r=n;r<i;++r)o[n*i+r]+=c-u[n]-u[r],o[r*i+n]=o[n*i+r];return o},c.entropy=function(e,t){t=o.$(t);var n,r,i=0,a=0,u=e.length;for(n=0;n<u;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<u;++n)(r=(t?t(e[n]):e[n])/i)&&(a+=r*Math.log(r));return-a/Math.LN2},c.mutual=function(e,t,n,r){var i,a,u,s=r?e.map(o.$(t)):e,c=r?e.map(o.$(n)):t,l=r?e.map(o.$(r)):n,f={},d={},p=l.length,m=0,h=0,g=0;for(u=0;u<p;++u)f[s[u]]=0,d[c[u]]=0;for(u=0;u<p;++u)f[s[u]]+=l[u],d[c[u]]+=l[u],m+=l[u];for(a=1/(m*Math.LN2),u=0;u<p;++u)0!==l[u]&&(i=m*l[u]/(f[s[u]]*d[c[u]]),h+=l[u]*a*Math.log(i),g+=l[u]*a*Math.log(l[u]/m));return[h,1+h/g]},c.mutual.info=function(e,t,n,r){return c.mutual(e,t,n,r)[0]},c.mutual.dist=function(e,t,n,r){return c.mutual(e,t,n,r)[1]},c.profile=function(e,t){var n,r,i,a,s,l=0,f=0,d=0,p=0,m=null,h=null,g=0,v=[],y={};for(i=0;i<e.length;++i)a=t?t(e[i]):e[i],y[a]=a in y?y[a]+1:(p+=1,1),null==a?++d:o.isValid(a)&&(s="string"==typeof a?a.length:a,(null===m||s<m)&&(m=s),(null===h||s>h)&&(h=s),n=s-l,l+=n/++f,g+=n*(s-l),v.push(s));return g/=f-1,r=Math.sqrt(g),v.sort(o.cmp),{type:u(e,t),unique:y,count:e.length,valid:f,missing:d,distinct:p,min:m,max:h,mean:l,stdev:r,median:a=c.quantile(v,.5),q1:c.quantile(v,.25),q3:c.quantile(v,.75),modeskew:0===r?0:(l-a)/r}},c.summary=function(e,t){t=t||o.keys(e[0]);var n=t.map(function(t){var n=c.profile(e,o.$(t));return n.field=t,n});return n.__summary__=!0,n}},{"./generate":18,"./import/type":27,"./util":32}],30:[function(e,t,n){function r(e){var t=i(e,"d");return t="var __t; return "+t+";",new Function("d",t).bind(f)}function i(e,t,n){t=t||"obj";var r=0,i="'",u=d;return e.replace(u,function(u,s,c){return i+=e.slice(r,c).replace(g,o),r=c+u.length,s&&(i+="'\n+((__t=("+a(s,t,n)+"))==null?'':__t)+\n'"),u}),i+"'"}function a(e,t,n){function i(e){return e=e||"",f?(f=!1,d="String("+d+")"+e):d+=e,d}function a(){return"(typeof "+d+'==="number"?new Date('+d+"):"+d+")"}function o(e){var t=_[0];if(!("'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]))throw Error("Format pattern must be quoted: "+t);t=t.slice(1,-1),v=u(t,e),f=!1;var n="number"===e?d:a();d="this.formats["+v+"]("+n+")"}var s=e.match(p),l=s.shift().trim(),f=!0;n&&(n[l]=1);for(var d=r.property(t,l),h=0;h<s.length;++h){var g,v,y,b=s[h],_=null;switch((g=b.indexOf(":"))>0&&(b=b.slice(0,g),_=s[h].slice(g+1).match(m).map(function(e){return e.trim()})),b=b.trim()){case"length":i(".length");break;case"lower":i(".toLowerCase()");break;case"upper":i(".toUpperCase()");break;case"lower-locale":i(".toLocaleLowerCase()");break;case"upper-locale":i(".toLocaleUpperCase()");break;case"trim":i(".trim()");break;case"left":v=c.number(_[0]),i(".slice(0,"+v+")");break;case"right":v=c.number(_[0]),i(".slice(-"+v+")");break;case"mid":v=c.number(_[0]),y=v+c.number(_[1]),i(".slice(+"+v+","+y+")");break;case"slice":v=c.number(_[0]),i(".slice("+v+(_.length>1?","+c.number(_[1]):"")+")");break;case"truncate":v=c.number(_[0]),y=_[1],y="left"!==y&&"middle"!==y&&"center"!==y?"right":y,d="this.truncate("+i()+","+v+",'"+y+"')";break;case"pad":v=c.number(_[0]),y=_[1],y="left"!==y&&"middle"!==y&&"center"!==y?"right":y,d="this.pad("+i()+","+v+",'"+y+"')";break;case"number":o("number");break;case"time":o("time");break;case"time-utc":o("utc");break;case"month":d="this.month("+d+")";break;case"month-abbrev":d="this.month("+d+",true)";break;case"day":d="this.day("+d+")";break;case"day-abbrev":d="this.day("+d+",true)";break;case"quarter":d="this.quarter("+d+")";break;case"quarter-utc":d="this.utcQuarter("+d+")";break;default:throw Error("Unrecognized template filter: "+b)}}return d}function o(e){return"\\"+h[e]}function u(e,t){var n=t+":"+e;if(null==f.format_map[n]){var r=l[t](e),i=f.formats.length;return f.formats.push(r),f.format_map[n]=i,i}return f.format_map[n]}function s(e,t){return f.formats[u(e,t)]}var c=e("./util"),l=e("./format"),f={formats:[],format_map:{},truncate:c.truncate,pad:c.pad,day:l.day,month:l.month,quarter:l.quarter,utcQuarter:l.utcQuarter};r.source=i,r.context=f,r.format=s,t.exports=r,r.clearFormatCache=function(){f.formats=[],f.format_map={}},r.property=function(e,t){return e+"["+c.field(t).map(c.str).join("][")+"]"};var d=/\{\{(.+?)\}\}|$/g,p=/(?:"[^"]*"|\'[^\']*\'|[^\|"]+|[^\|\']+)+/g,m=/(?:"[^"]*"|\'[^\']*\'|[^,"]+|[^,\']+)+/g,h={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},g=/\\|'|\r|\n|\u2028|\u2029/g},{"./format":17,"./util":32}],31:[function(e,t,n){function r(e){return c.setTime(+e),c}function i(e,t,n,r,i,a){var o={type:e,date:t,unit:n};return r?o.step=r:o.minstep=1,null!=i&&(o.min=i),null!=a&&(o.max=a),o}function a(e,t,n,r,a,o){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,a,o)}function o(e,t,n,r){var i,a,o,u=m[0];for(i=1,a=m.length;i<a;++i)if(u=m[i],t>u[0]){if((o=t/u[0])>r)return e[m[i-1][1]];if(o>=n)return e[u[1]]}return e[m[a-1][1]]}function u(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return o(e,t,n,r)},r}var s=e("d3-time"),c=new Date,l=new Date(0,0,1).setFullYear(0),f=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),d=[a("second",s.second,l),a("minute",s.minute,l),a("hour",s.hour,l),a("day",s.day,l,[1,7]),a("month",s.month,l,[1,3,6]),a("year",s.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[a("second",s.utcSecond,f),a("minute",s.utcMinute,f),a("hour",s.utcHour,f),a("day",s.utcDay,f,[1,7]),a("month",s.utcMonth,f,[1,3,6]),a("year",s.utcYear,f),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],m=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(d),t.exports.utc=u(p)},{"d3-time":7}],32:[function(e,t,n){(function(e){function n(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function r(e,t,n){var r=0,i=e.split(o);return e=n?(i=i.reverse()).filter(function(e){return(r+=e.length)<=t}).reverse():i.filter(function(e){return(r+=e.length)<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports;i.namedfunc=function(e,t){return t.__name__=e,t},i.name=function(e){return null==e?null:e.__name__},i.identity=function(e){return e},i.true=i.namedfunc("true",function(){return!0}),i.false=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i.false,i.number=function(e){return null==e||""===e?null:+e},i.boolean=function(e){return null==e||""===e?null:"false"!==e&&!!e},i.date=function(e,t){var n=t||Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};i.field=function(e){return String(e).match(/\[(.*?)\]|[^.\[]+/g).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var r=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(r,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,r){var a,o,u,s;for(a=0,o=e.length;a<o;++a)if(u=e[a],s=i.cmp(u(n),u(r)))return s*t[a];return 0}},i.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var a=t(e),o=t(i);return a<o?-1:a>o?1:r[n(e)]-r[n(i)]}),e},i.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},i.pad=function(e,t,r,i){i=i||" ";var a=t-e.length;if(a<=0)return e;switch(r){case"left":return n(a,i)+e;case"middle":case"center":return n(Math.floor(a/2),i)+e+n(Math.ceil(a/2),i);default:return e+n(a,i)}},i.truncate=function(e,t,n,i,a){var o=e.length;if(o<=t)return e;a=void 0!==a?String(a):"…";var u=Math.max(0,t-a.length);switch(n){case"left":return a+(i?r(e,u,1):e.slice(o-u));case"middle":case"center":var s=Math.ceil(u/2),c=Math.floor(u/2);return(i?r(e,s):e.slice(0,s))+a+(i?r(e,c,1):e.slice(o-c));default:return(i?r(e,u):e.slice(0,u))+a}};var o=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],33:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},s=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},a={key:r,value:t[r]};return e(i,a)}}}(t.cmp),c=[];return function e(t,l,f,d){var p=n?"\n"+new Array(d+1).join(n):"",m=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),void 0!==(f=u.call(t,l,f))){if("object"!=typeof f||null===f)return r.stringify(f);if(i(f)){for(var h=[],g=0;g<f.length;g++){var v=e(f,g,f[g],d+1)||r.stringify(null);h.push(p+n+v)}return"["+h.join(",")+p+"]"}if(-1!==c.indexOf(f)){if(o)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}c.push(f);for(var y=a(f).sort(s&&s(f)),h=[],g=0;g<y.length;g++){var l=y[g],b=e(f,l,f[l],d+1);if(b){var _=r.stringify(l)+m+b;h.push(p+n+_)}}return c.splice(c.indexOf(f),1),"{"+h.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:34}],34:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":35,"./lib/stringify":36}],35:[function(e,t,n){var r,i,a,o,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},s=function(e){throw{name:"SyntaxError",message:e,at:r,text:a}},c=function(e){return e&&e!==i&&s("Expected '"+e+"' instead of '"+i+"'"),i=a.charAt(r),r+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",c("-"));i>="0"&&i<="9";)t+=i,c();if("."===i)for(t+=".";c()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,c(),"-"!==i&&"+"!==i||(t+=i,c());i>="0"&&i<="9";)t+=i,c();if(e=+t,isFinite(e))return e;s("Bad number")},f=function(){var e,t,n,r="";if('"'===i)for(;c();){if('"'===i)return c(),r;if("\\"===i)if(c(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(c(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}s("Bad string")},d=function(){for(;i&&i<=" ";)c()},p=function(){switch(i){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}s("Unexpected '"+i+"'")},m=function(){var e=[];if("["===i){if(c("["),d(),"]"===i)return c("]"),e;for(;i;){if(e.push(o()),d(),"]"===i)return c("]"),e;c(","),d()}}s("Bad array")},h=function(){var e,t={};if("{"===i){if(c("{"),d(),"}"===i)return c("}"),t;for(;i;){if(e=f(),d(),c(":"),Object.hasOwnProperty.call(t,e)&&s('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===i)return c("}"),t;c(","),d()}}s("Bad object")};o=function(){switch(d(),i){case"{":return h();case"[":return m();case'"':return f();case"-":return l();default:return i>="0"&&i<="9"?l():p()}},t.exports=function(e,t){var n;return a=e,r=0,i=" ",n=o(),d(),i&&s("Syntax error"),"function"==typeof t?function e(n,r){var i,a,o=n[r];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(a=e(o,i),void 0!==a?o[i]=a:delete o[i]);return t.call(n,r,o)}({"":n},""):n}},{}],36:[function(e,t,n){function r(e){return s.lastIndex=0,s.test(e)?'"'+e.replace(s,function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,s,c,l,f,d=a,p=t[e]
;switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof u&&(p=u.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,n=0;n<l;n+=1)f[n]=i(n,p)||"null";return c=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,c}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)"string"==typeof(s=u[n])&&(c=i(s,p))&&f.push(r(s)+(a?": ":":")+c);else for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(c=i(s,p))&&f.push(r(s)+(a?": ":":")+c);return c=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,c}}var a,o,u,s=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(a="",o="","number"==typeof n)for(r=0;r<n;r+=1)o+=" ";else"string"==typeof n&&(o=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],37:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.topojson=t.topojson||{})}(this,function(e){"use strict";function t(){}function n(e){if(!e)return t;var n,r,i=e.scale[0],a=e.scale[1],o=e.translate[0],u=e.translate[1];return function(e,t){t||(n=r=0),e[0]=(n+=e[0])*i+o,e[1]=(r+=e[1])*a+u}}function r(e){if(!e)return t;var n,r,i=e.scale[0],a=e.scale[1],o=e.translate[0],u=e.translate[1];return function(e,t){t||(n=r=0);var s=Math.round((e[0]-o)/i),c=Math.round((e[1]-u)/a);e[0]=s-n,e[1]=c-r,n=s,r=c}}function i(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}function a(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n}function o(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return u(e,t)})}:u(e,t)}function u(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:s(e,t)};return null==t.id&&delete n.id,n}function s(e,t){function r(e,t){t.length&&t.pop();for(var n,r=f[e<0?~e:e],a=0,o=r.length;a<o;++a)t.push(n=r[a].slice()),l(n,a);e<0&&i(t,o)}function a(e){return e=e.slice(),l(e,0),e}function o(e){for(var t=[],n=0,i=e.length;n<i;++n)r(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function u(e){for(var t=o(e);t.length<4;)t.push(t[0].slice());return t}function s(e){return e.map(u)}function c(e){var t=e.type;return"GeometryCollection"===t?{type:t,geometries:e.geometries.map(c)}:t in d?{type:t,coordinates:d[t](e)}:null}var l=n(e.transform),f=e.arcs,d={Point:function(e){return a(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(a)},LineString:function(e){return o(e.arcs)},MultiLineString:function(e){return e.arcs.map(o)},Polygon:function(e){return s(e.arcs)},MultiPolygon:function(e){return e.arcs.map(s)}};return c(t)}function c(e,t){function n(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach(function(e){n[0]+=e[0],n[1]+=e[1]})):n=r[r.length-1],t<0?[n,i]:[i,n]}function r(e,t){for(var n in e){var r=e[n];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){i[e<0?~e:e]=1}),u.push(r)}}var i={},a={},o={},u=[],s=-1;return t.forEach(function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++s],t[s]=n,t[r]=i)}),t.forEach(function(e){var t,r,i=n(e),u=i[0],s=i[1];if(t=o[u])if(delete o[t.end],t.push(e),t.end=s,r=a[s]){delete a[r.start];var c=r===t?t:t.concat(r);a[c.start=t.start]=o[c.end=r.end]=c}else a[t.start]=o[t.end]=t;else if(t=a[s])if(delete a[t.start],t.unshift(e),t.start=u,r=o[u]){delete o[r.end];var l=r===t?t:r.concat(t);a[l.start=r.start]=o[l.end=t.end]=l}else a[t.start]=o[t.end]=t;else t=[e],a[t.start=u]=o[t.end=s]=t}),r(o,a),r(a,o),t.forEach(function(e){i[e<0?~e:e]||u.push([e])}),u}function l(e){return s(e,f.apply(this,arguments))}function f(e,t,n){function r(e){var t=e<0?~e:e;(l[t]||(l[t]=[])).push({i:e,g:s})}function i(e){e.forEach(r)}function a(e){e.forEach(i)}function o(e){"GeometryCollection"===e.type?e.geometries.forEach(o):e.type in f&&(s=e,f[e.type](e.arcs))}var u=[];if(arguments.length>1){var s,l=[],f={LineString:i,MultiLineString:a,Polygon:a,MultiPolygon:function(e){e.forEach(a)}};o(t),l.forEach(arguments.length<3?function(e){u.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&u.push(e[0].i)})}else for(var d=0,p=e.arcs.length;d<p;++d)u.push(d);return{type:"MultiLineString",arcs:c(e,u)}}function d(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function p(e){for(var t,n=-1,r=e.length,i=e[r-1],a=0;++n<r;)t=i,i=e[n],a+=t[0]*i[1]-t[1]*i[0];return a/2}function m(e){return s(e,h.apply(this,arguments))}function h(e,t){function n(e){e.forEach(function(t){t.forEach(function(t){(i[t=t<0?~t:t]||(i[t]=[])).push(e)})}),a.push(e)}function r(t){return Math.abs(p(s(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var i={},a=[],o=[];return t.forEach(function(e){"Polygon"===e.type?n(e.arcs):"MultiPolygon"===e.type&&e.arcs.forEach(n)}),a.forEach(function(e){if(!e._){var t=[],n=[e];for(e._=1,o.push(t);e=n.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),a.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:o.map(function(t){var n,a=[];if(t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].length<2&&a.push(e)})})}),a=c(e,a),(n=a.length)>1)for(var o,u,s=1,l=r(a[0]);s<n;++s)(o=r(a[s]))>l&&(u=a[0],a[0]=a[s],a[s]=u,l=o);return a})}}function g(e){function t(e,t){e.forEach(function(e){e<0&&(e=~e);var n=i[e];n?n.push(t):i[e]=[t]})}function n(e,n){e.forEach(function(e){t(e,n)})}function r(e,t){"GeometryCollection"===e.type?e.geometries.forEach(function(e){r(e,t)}):e.type in u&&u[e.type](e.arcs,t)}var i={},o=e.map(function(){return[]}),u={LineString:t,MultiLineString:n,Polygon:n,MultiPolygon:function(e,t){e.forEach(function(e){n(e,t)})}};e.forEach(r);for(var s in i)for(var c=i[s],l=c.length,f=0;f<l;++f)for(var d=f+1;d<l;++d){var p,m=c[f],h=c[d];(p=o[m])[s=a(p,h)]!==h&&p.splice(s,0,h),(p=o[h])[s=a(p,m)]!==m&&p.splice(s,0,m)}return o}function v(e,t){return e[1][2]-t[1][2]}function y(){function e(e,t){for(;t>0;){var n=(t+1>>1)-1,i=r[n];if(v(e,i)>=0)break;r[i._=t]=i,r[e._=t=n]=e}}function t(e,t){for(;;){var n=t+1<<1,a=n-1,o=t,u=r[o];if(a<i&&v(r[a],u)<0&&(u=r[o=a]),n<i&&v(r[n],u)<0&&(u=r[o=n]),o===t)break;r[u._=t]=u,r[e._=t=o]=e}}var n={},r=[],i=0;return n.push=function(t){return e(r[t._=i]=t,i++),i},n.pop=function(){if(!(i<=0)){var e,n=r[0];return--i>0&&(e=r[i],t(r[e._=0]=e,0)),n}},n.remove=function(n){var a,o=n._;if(r[o]===n)return o!==--i&&(a=r[i],(v(a,n)<0?e:t)(r[a._=o]=a,o)),o},n}function b(e,t){function i(e){u.remove(e),e[1][2]=t(e),u.push(e)}var a=n(e.transform),o=r(e.transform),u=y();return t||(t=d),e.arcs.forEach(function(e){var n,r,s,c,l=[],f=0;for(r=0,s=e.length;r<s;++r)c=e[r],a(e[r]=[c[0],c[1],1/0],r);for(r=1,s=e.length-1;r<s;++r)n=e.slice(r-1,r+2),n[1][2]=t(n),l.push(n),u.push(n);for(r=0,s=l.length;r<s;++r)n=l[r],n.previous=l[r-1],n.next=l[r+1];for(;n=u.pop();){var d=n.previous,p=n.next;n[1][2]<f?n[1][2]=f:f=n[1][2],d&&(d.next=p,d[2]=n[2],i(d)),p&&(p.previous=d,p[0]=n[0],i(p))}e.forEach(o)}),e}e.version="1.6.27",e.mesh=l,e.meshArcs=f,e.merge=m,e.mergeArcs=h,e.feature=o,e.neighbors=g,e.presimplify=b,Object.defineProperty(e,"__esModule",{value:!0})})},{}],38:[function(t,n,r){(function(t){var r,i,a,o,u,s,c,l,f,d,p,m,h,g,v;!function(r){function i(e,t){return function(n,r){return e[n]=t?t(n,r):r}}var a="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){r(i(a,i(e)))}):r("object"==typeof n&&"object"==typeof n.exports?i(a,i(n.exports)):i(a))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};r=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},o=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},u=function(e,t){return function(n,r){t(n,r,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},l=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,u,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},f=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},d=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},m=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},h=function(e,t,n){function r(e){return function(t){return new Promise(function(n,r){m.push([e,t,n,r]),i()})}}function i(){!f&&m.length&&a((f=m.shift())[0],f[1])}function a(e,t){try{o(p[e](t))}catch(e){l(f[3],e)}}function o(e){e.done?l(f[2],e):"yield"===e.value[0]?l(f[2],{value:e.value[1],done:!1}):Promise.resolve(e.value[1]).then("delegate"===e.value[0]?u:s,c)}function u(e){o(e.done?e:{value:["yield",e.value],done:!1})}function s(e){a("next",e)}function c(e){a("throw",e)}function l(e,t){f=void 0,e(t),i()}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f,d,p=n.apply(e,t||[]),m=[];return d={next:r("next"),throw:r("throw"),return:r("return")},d[Symbol.asyncIterator]=function(){return this},d},g=function(e){function t(t,n){return function(r){return{value:["delegate",(e[t]||n).call(e,r)],done:!1}}}var n={next:t("next"),throw:t("throw",function(e){throw e}),return:t("return",function(e){return{value:e,done:!0}})};return e=v(e),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof d?d(e):e[Symbol.iterator]()},e("__extends",r),e("__assign",i),e("__rest",a),e("__decorate",o),e("__param",u),e("__metadata",s),e("__awaiter",c),e("__generator",l),e("__exportStar",f),e("__values",d),e("__read",p),e("__spread",m),e("__asyncGenerator",h),e("__asyncDelegator",g),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],39:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return c.hasOwnProperty(e)}function n(e,t,n,r,i){for(var a,o=0,u=e.length;t<u;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function r(e){for(var t=[],r=0,i=e.length,a=0;a<i;)a=n(e,a,v,d+m,p+h),t.push(e.substring(r,a).trim()),r=++a;if(0===t.length)throw"Empty event selector: "+e;return t}function i(e){return"["===e[0]?a(e):o(e)}function a(e){var t,a,o=e.length,u=1;if((u=n(e,u,p,d,p))===o)throw"Empty between selector: "+e;if(t=r(e.substring(1,u)),2!==t.length)throw"Between selector must have two elements: "+e;if(e=e.slice(u+1).trim(),e[0]!==b)throw"Expected '>' after between selector: "+e;return t=t.map(i),a=i(e.slice(1).trim()),a.between?{between:t,stream:a}:(a.between=t,a)}function o(e){var r,i,a={source:s},o=[],c=[0,0],l=0,f=0,v=e.length,b=0;if(e[v-1]===h){if(!((b=e.lastIndexOf(m))>=0))throw"Unmatched right brace: "+e;try{c=u(e.substring(b+1,v-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,b).trim(),v=e.length,b=0}if(!v)throw e;if(e[0]===y&&(l=++b),r=n(e,b,g),r<v&&(o.push(e.substring(f,r).trim()),f=b=++r),(b=n(e,b,d))===v)o.push(e.substring(f,v).trim());else if(o.push(e.substring(f,b).trim()),i=[],(f=++b)===v)throw"Unmatched left bracket: "+e;for(;b<v;){if((b=n(e,b,p))===v)throw"Unmatched left bracket: "+e;if(i.push(e.substring(f,b).trim()),b<v-1&&e[++b]!==d)throw"Expected left bracket: "+e;f=++b}if(!(v=o.length)||_.test(o[v-1]))throw"Invalid event selector: "+e;return v>1?(a.type=o[1],l?a.markname=o[0].slice(1):t(o[0])?a.marktype=o[0]:a.source=o[0]):a.type=o[0],"!"===a.type.slice(-1)&&(a.consume=!0,a.type=a.type.slice(0,-1)),null!=i&&(a.filter=i),c[0]&&(a.throttle=c[0]),c[1]&&(a.debounce=c[1]),a}function u(e){var t=e.split(v);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!==n)throw e;return n})}var s,c,l=function(e,t,n){return s=t||f,c=n||S,r(e.trim()).map(i)},f="view",d="[",p="]",m="{",h="}",g=":",v=",",y="@",b=">",_=/[\[\]\{\}]/,S={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=l,Object.defineProperty(e,"__esModule",{value:!0})})},{}],40:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-alpha.9",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/vl.js",types:"build/src/vl.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{tsc:"rm -rf build/*/** && tsc",prebuild:"mkdir -p build/site build/examples/images build/test-gallery",build:"npm run tsc && cp package.json build && browserify src/vl.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"uglifyjs build/vega-lite.js -cm --in-source-map build/vega-lite.js.map --source-map build/vega-lite.min.js.map > build/vega-lite.min.js && npm run schema","build:examples":"./scripts/build-examples.sh","build:images":"npm run data && scripts/generate-images.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"npm run link && browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts|vg.json)' -delete & rm -rf data",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"typescript-json-schema --required true --noExtraProps true src/spec.ts TopLevelExtendedSpec > build/vega-lite-schema.json && rm -f _data/vega-lite-schema.json && cp build/vega-lite-schema.json _data/",presite:"npm run build && npm run data && npm run build:site && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve",lint:"tslint --project tsconfig.json -c tslint.json --type-check",pretest:"npm run tsc && npm run schema && npm run data",test:"npm run test:nocompile","test:nocompile":"npm run test:only && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:debug":"npm run pretest && mocha --recursive --debug-brk build/test build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/vl.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^3.5.0","@types/d3":"^4.7.0","@types/highlight.js":"^9.1.9","@types/json-stable-stringify":"^1.0.31","@types/mocha":"^2.2.40","@types/node":"^7.0.12",ajv:"5.0.1-beta.1","browser-sync":"~2.18.8",browserify:"~14.3.0","browserify-shim":"^3.8.14",chai:"~3.5.0",cheerio:"~0.22.0",codecov:"~2.1.0",d3:"^4.7.4",exorcist:"~0.4.0","highlight.js":"^9.10.0",mocha:"~3.2.0",nodemon:"~1.11.0",nyc:"~10.2.0","source-map-support":"~0.4.14",tsify:"~3.0.1",tslint:"~5.1.0","tslint-eslint-rules":"^4.0.0",typescript:"^2.2.2","typescript-json-schema":"^0.11.0","uglify-js":"~2.8.22",vega:"3.0.0-beta.28","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"3.0.0-beta.10",watchify:"~3.9.0","yaml-front-matter":"~3.4.0"},dependencies:{"json-stable-stringify":"~1.0.1",tslib:"^1.6.0","vega-event-selector":"^2.0.0-beta","vega-util":"~1.1.4",yargs:"~7.0.2"}}},{}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","ci0","ci1","modeskew","min","max","argmin","argmax"],n.AGGREGATE_OP_INDEX=r.toSet(n.AGGREGATE_OPS),n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"]},{"./util":124}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"]},{}],43:[function(e,t,n){"use strict";function r(e){return o.isBoolean(e)?"bin":"bin"+Object.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")}function i(e){switch(e){case a.ROW:case a.COLUMN:case a.SIZE:case a.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./channel"),o=e("./util");n.binToString=r,n.autoMaxBins=i},{"./channel":44,"./util":124}],44:[function(e,t,n){"use strict";function r(e,t){return t in i(e)}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function a(e){return!l.contains([n.DETAIL,n.TEXT,n.ORDER],e)}function o(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in f;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function u(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:return"discrete";case n.COLOR:return"flexible";case n.X2:case n.Y2:case n.DETAIL:case n.TEXT:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var s,c=e("./scale"),l=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail"}(s=n.Channel||(n.Channel={})),n.X=s.X,n.Y=s.Y,n.X2=s.X2,n.Y2=s.Y2,n.ROW=s.ROW,n.COLUMN=s.COLUMN,n.SHAPE=s.SHAPE,n.SIZE=s.SIZE,n.COLOR=s.COLOR,n.TEXT=s.TEXT,n.DETAIL=s.DETAIL,n.ORDER=s.ORDER,n.OPACITY=s.OPACITY,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.LEVEL_OF_DETAIL_CHANNELS=l.without(n.NONSPATIAL_CHANNELS,["order"]),n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=r,n.getSupportedMark=i,n.hasScale=a;var f=l.toSet(l.without(c.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=o,n.rangeType=u},{"./scale":115,"./util":124}],45:[function(e,t,n){"use strict";function r(e,t,n,r){var s=e.fieldDef(t),c=e.axis(t),l=e.config;return s.type===a.TEMPORAL&&(n=o.extend({text:{signal:u.timeFormatExpression("datum.value",s.timeUnit,c.format,l.axis.shortTimeLabels,l.timeFormat)}},n)),void 0!==c.labelAngle?n.angle={value:c.labelAngle}:t===i.X&&(o.contains([a.NOMINAL,a.ORDINAL],s.type)||s.bin||s.type===a.TEMPORAL)&&(n.angle={value:270}),n.angle&&(270===n.angle.value?n.align={value:"top"===r.orient?"left":t===i.X||t===i.COLUMN?"right":"center"}:90===n.angle.value&&(n.align={value:"center"})),n.angle&&(270===n.angle.value?n.baseline={value:t===i.X||t===i.COLUMN?"middle":"bottom"}:90===n.angle.value&&(n.baseline={value:"bottom"})),0===o.keys(n).length?void 0:n}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../type"),o=e("../../util"),u=e("../common");n.labels=r},{"../../channel":44,"../../type":123,"../../util":124,"../common":48}],46:[function(e,t,n){"use strict";function r(e,t){return t.reduce(function(t,n){var r=[];if(e.axis(n)){var i=s(n,e);i&&a(i)&&r.push(i);var o=u(n,e);o&&a(o)&&r.push(o),r.length>0&&(t[n]=r)}return t},{})}function i(e){return!1===e||null===e}function a(e){return m.some(h,function(t){return o(e,t)})}function o(e,t){return"grid"===t||"title"===t?!!e[t]:!i(e[t])}function u(e,t){return c(e,t,!0)}function s(e,t){return c(e,t,!1)}function c(e,t,n){var r=t.axis(e),i={scale:t.scaleName(e)};f.AXIS_PROPERTIES.forEach(function(a){var o=l(a,r,e,t,n);void 0!==o&&(i[a]=o)});var a=l("gridScale",r,e,t,n);void 0!==a&&(i.gridScale=a);var u=r.encode||{};return h.forEach(function(n){if(o(i,n)){var r;r="labels"===n?d.labels(t,e,u.labels||{},i):u[n]||{},void 0!==r&&m.keys(r).length>0&&(i.encode=i.encode||{},i.encode[n]={update:r})}}),i}function l(e,t,n,r,i){var a=r.fieldDef(n);switch(e){case"labels":return!i&&t[e];case"domain":return p.domain(e,t,i,n);case"ticks":return p.ticks(e,t,i,n);case"format":return p.format(t,n,a,r.config);case"grid":return p.grid(r,n,i);case"gridScale":return p.gridScale(r,n,i);case"orient":return p.orient(t,n);case"tickCount":return p.tickCount(t,n,a);case"title":return p.title(t,a,r.config,i);case"values":return p.values(t);case"zindex":return p.zindex(t,i)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../axis"),d=e("./encode"),p=e("./rules"),m=e("../../util"),h=["domain","grid","labels","ticks","title"];n.parseAxisComponent=r,n.parseGridAxis=u,n.parseMainAxis=s},{"../../axis":42,"../../util":124,"./encode":45,"./rules":47}],47:[function(e,t,n){"use strict";function r(e,t,n,r){return y.numberFormat(n,e.format,r,t)}function i(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.hasDiscreteScale(t)&&!e.fieldDef(t).bin}function a(e,t,n){if(t===m.ROW||t===m.COLUMN)return!1;if(n)return i(e,t)}function o(e,t,n){if(n){var r="x"===t?"y":"x";if(e.scale(r))return e.scaleName(r)}}function u(e,t){var n=e.orient;if(n)return n;switch(t){case m.COLUMN:return"top";case m.X:return"bottom";case m.ROW:case m.Y:return"left"}throw new Error(p.message.INVALID_CHANNEL_FOR_AXIS)}function s(e,t,n){var r=e.tickCount;return void 0!==r?r:t!==m.X||n.bin?void 0:5}function c(e,t,n,r){if(!r){if(void 0!==e.title)return e.title;var i=g.title(t,n),a=e.titleMaxLength;return a?v.truncate(i,a):i}}function l(e){var t=e.values;return e.values&&h.isDateTime(t[0])?t.map(function(e){return h.timestamp(e,!0)}):t}function f(e,t){var n=e.zindex;return void 0!==n?n:t?0:1}function d(e,t,n,r){return!n&&r!==m.ROW&&r!==m.COLUMN&&t[e]}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../log"),m=e("../../channel"),h=e("../../datetime"),g=e("../../fielddef"),v=e("../../util"),y=e("../common");n.format=r,n.gridShow=i,n.grid=a,n.gridScale=o,n.orient=u,n.tickCount=s,n.title=c,n.values=l,n.zindex=f,n.domainAndTicks=d,n.domain=d,n.ticks=d},{"../../channel":44,"../../datetime":107,"../../fielddef":110,"../../log":113,"../../util":124,"../common":48}],48:[function(e,t,n){"use strict";function r(e,t,n,r){if(h.isFacetSpec(e))return new v.FacetModel(e,t,n,r);if(h.isLayerSpec(e))return new y.LayerModel(e,t,n,r);if(h.isUnitSpec(e))return new b.UnitModel(e,t,n,r);throw new Error(l.message.INVALID_SPEC)}function i(e,t,n){return n.forEach(function(n){var r=t[n];void 0!==r&&(e[n]={value:r})}),e}function a(e,t,n){return n.forEach(function(n){var r=o(n,t.mark(),t.config);void 0!==r&&(e[n]={value:r})}),e}function o(e,t,n){var r=n[t];return void 0!==r[e]?r[e]:n.mark[e]}function u(e,t,n,r){if(e.type===p.QUANTITATIVE)return t||("count"===e.aggregate&&r===f.TEXT?"d":n.numberFormat)}function s(e,t,n,r,i){if(!t||n){return"timeFormat("+e+", '"+(n||i)+"')"}return g.formatExpression(t,e,r)}function c(e){return(m.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(d.field(t,{binSuffix:"start"})),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../log"),f=e("../channel"),d=e("../fielddef"),p=e("../type"),m=e("../util"),h=e("../spec"),g=e("../timeunit"),v=e("./facet"),y=e("./layer"),b=e("./unit");n.buildModel=r,n.applyConfig=i,n.applyMarkConfig=a,n.getMarkConfig=o,n.numberFormat=u,n.timeFormatExpression=s,n.sortParams=c},{"../channel":44,"../fielddef":110,"../log":113,"../spec":118,"../timeunit":120,"../type":123,"../util":124,"./facet":65,"./layer":66,"./unit":103}],49:[function(e,t,n){"use strict";function r(e,t){t&&l.set(t);try{var n=f.normalize(e),r=s.initConfig(e.config),o=m.buildModel(n,null,"",r);return o.parse(),a(o,i(e,r))}finally{t&&l.reset()}}function i(e,t){return u.__assign({},d.extractTopLevelProperties(t),d.extractTopLevelProperties(e))}function a(e,t){return{spec:p.extend({$schema:"http://vega.github.io/schema/vega/v3.0.json"},{autosize:"pad"},t,{signals:[{name:"width",update:"data('"+e.getName(c.LAYOUT)+"')[0]."+e.getName("width")},{name:"height",update:"data('"+e.getName(c.LAYOUT)+"')[0]."+e.getName("height")}].concat(h.assembleTopLevelSignals(e))},{data:[].concat(e.assembleData(),e.assembleLayout([]),e.assembleSelectionData([])),marks:[o(e)]})}}function o(e){var t=p.extend({name:e.getName("main-group"),type:"group"},e.description?{description:e.description}:{},{from:{data:e.getName(c.LAYOUT)},encode:{update:p.extend({width:{field:e.getName("width")},height:{field:e.getName("height")}},e.assembleParentGroupProperties(e.config.cell))}});return p.extend(t,e.assembleGroup())}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),s=e("../config"),c=e("../data"),l=e("../log"),f=e("../spec"),d=e("../toplevelprops"),p=e("../util"),m=e("./common"),h=e("./selection/selection");n.compile=r,n.assembleRootGroup=o},{"../config":105,"../data":106,"../log":113,"../spec":118,"../toplevelprops":121,"../util":124,"./common":48,"./selection/selection":93,tslib:38}],50:[function(e,t,n){"use strict";function r(e,t){return t.bin?(e[o.field(t,{binSuffix:"start"})]=!0,e[o.field(t,{binSuffix:"end"})]=!0,e[o.field(t,{binSuffix:"range"})]=!0):e[o.field(t)]=!0,e}function i(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=!0:e[n]={op:!0})}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../fielddef"),u=e("../../log"),s=e("../../util"),c=e("./dataflow"),l=function(e){function t(t,n){var r=e.call(this)||this;return r.dimensions=t,r.measures=n,r}return a.__extends(t,e),t.prototype.clone=function(){return new t(s.extend({},this.dimensions),s.duplicate(this.measures))},t.make=function(e){var n=!1;e.forEachFieldDef(function(e){e.aggregate&&(n=!0)});var i={},a={};return n?(e.forEachFieldDef(function(t,n){if(t.aggregate)if("count"===t.aggregate)i["*"]=i["*"]||{},i["*"].count=!0;else{i[t.field]=i[t.field]||{},i[t.field][t.aggregate]=!0;var o=e.scale(n);o&&"unaggregated"===o.domain&&(i[t.field].min=!0,i[t.field].max=!0)}else r(a,t)}),Object.keys(a).length+Object.keys(i).length===0?null:new t(a,i)):null},t.prototype.merge=function(e){s.differ(this.dimensions,e.dimensions)?u.debug("different dimensions, cannot merge"):(i(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return s.keys(this.dimensions).forEach(function(t){return e[t]=!0}),s.keys(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return s.keys(this.measures).forEach(function(n){s.keys(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){var e=this,t=[],n=[];return s.keys(this.measures).forEach(function(r){s.keys(e.measures[r]).forEach(function(e){t.push(e),n.push(r)})}),{type:"aggregate",groupby:s.keys(this.dimensions),ops:t,fields:n}},t}(c.DataFlowNode);n.AggregateNode=l},{"../../fielddef":110,"../../log":113,"../../util":124,"./dataflow":53,tslib:38}],51:[function(e,t,n){"use strict";function r(e){
e instanceof y.NonPositiveFilterNode&&d.every(d.vals(e.filter),function(e){return!1===e})&&e.remove(),e instanceof b.NullFilterNode&&d.every(d.vals(e.filteredFields),function(e){return null===e})&&e.remove(),e instanceof h.OutputNode&&!e.required&&e.remove(),e.children.forEach(r)}function i(e){function t(r){if(!(r instanceof x.OrderNode)){var i=r.clone();if(i instanceof h.OutputNode){var a=n.FACET_SCALE_PREFIX+e.model.getName(i.source);i.source=a,e.model.component.data.outputNodes[a]=i,d.flatten(r.children.map(t)).forEach(function(e){return e.parent=i})}else i instanceof p.AggregateNode||i instanceof E.StackNode?(i.addDimensions(e.fields),d.flatten(r.children.map(t)).forEach(function(e){return e.parent=i})):d.flatten(r.children.map(t)).forEach(function(e){return e.parent=i});return[i]}return d.flatten(r.children.map(t))}return t}function a(e){if(e instanceof g.FacetNode)if(1!==e.numChildren()||e.children[0]instanceof h.OutputNode){o(e.model.component.data.main);var t=d.flatten(e.children.map(i(e)));t.forEach(function(t){return t.parent=e.model.component.data.main})}else{var n=e.children[0];(n instanceof p.AggregateNode||n instanceof E.StackNode)&&n.addDimensions(e.fields),n.swapWithParent(),a(e)}else e.children.forEach(a)}function o(e){if(e instanceof h.OutputNode&&e.type===f.MAIN&&1===e.numChildren()){var t=e.children[0];t instanceof g.FacetNode||(t.swapWithParent(),o(e))}}function u(e){function t(e){0===e.numChildren()?n.push(e):e.children.forEach(t)}var n=[];return e.forEach(t),n}function s(e){function t(r,i){if(r instanceof v.ParseNode){if(!(r.parent instanceof M.SourceNode&&i.format))throw new Error("Can only instantiate parse next to source.");i.format.parse=r.assemble()}if(r instanceof g.FacetNode)return i.name||(i.name="data_"+n++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source,void r.assemble().forEach(function(t){return e.push(t)});if((r instanceof O.FilterNode||r instanceof b.NullFilterNode||r instanceof O.CalculateNode||r instanceof p.AggregateNode||r instanceof x.OrderNode)&&i.transform.push(r.assemble()),(r instanceof y.NonPositiveFilterNode||r instanceof m.BinNode||r instanceof w.TimeUnitNode||r instanceof E.StackNode)&&(i.transform=i.transform.concat(r.assemble())),r instanceof h.OutputNode)if(i.source&&0===i.transform.length)r.source=i.source;else{if(r.parent instanceof h.OutputNode)throw r.source=i.name,new Error("cannot happen");if(i.name||(i.name="data_"+n++),r.source=i.name,1===r.numChildren()&&i.transform.length>0){e.push(i);var a={name:null,source:i.name,transform:[]};i=a}}switch(r.numChildren()){case 0:(!i.source||i.transform.length>0)&&e.push(i);break;case 1:t(r.children[0],i);break;default:var o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source,r.children.forEach(function(e){t(e,{name:null,source:o,transform:[]})})}}var n=0;return t}function c(e){var t=[],n=s(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t}function l(e){var t=[];e.forEach(r),u(e).forEach(_.optimizeFromLeaves(S.parse)),e.forEach(a);var n=s(t),i=0;return e.forEach(function(e){e.hasName()||(e.dataName="source_"+i++);var t=e.assemble();n(e,t)}),t}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../data"),d=e("../../util"),p=e("./aggregate"),m=e("./bin"),h=e("./dataflow"),g=e("./facet"),v=e("./formatparse"),y=e("./nonpositivefilter"),b=e("./nullfilter"),_=e("./optimizers"),S=e("./optimizers"),x=e("./pathorder"),M=e("./source"),E=e("./stack"),w=e("./timeunit"),O=e("./transforms");n.FACET_SCALE_PREFIX="scale_",n.assembleFacetData=c,n.assembleData=l},{"../../data":106,"../../util":124,"./aggregate":50,"./bin":52,"./dataflow":53,"./facet":54,"./formatparse":55,"./nonpositivefilter":56,"./nullfilter":57,"./optimizers":58,"./pathorder":60,"./source":61,"./stack":62,"./timeunit":63,"./transforms":64}],52:[function(e,t,n){"use strict";function r(e,t){return"format("+e+", '"+t+"')"}function i(e,t,n){if(s.hasDiscreteDomain(e.scale(n).type)){var i=(e.axis(n)||e.legend(n)||{}).format||e.config.numberFormat,a=u.field(t,{datum:!0,binSuffix:"start"}),o=u.field(t,{datum:!0,binSuffix:"end"});return{formulaAs:u.field(t,{binSuffix:"range"}),formula:r(a,i)+" + ' - ' + "+r(o,i)}}return{}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../bin"),u=e("../../fielddef"),s=e("../../scale"),c=e("../../util"),l=e("./dataflow"),f=function(e){function t(t){var n=e.call(this)||this;return n.bins=t,n}return a.__extends(t,e),t.prototype.clone=function(){return new t(c.duplicate(this.bins))},t.make=function(e){var n=e.reduceFieldDef(function(t,n,r){var s=e.fieldDef(r).bin;if(s){var l=c.isBoolean(s)?{}:s,f=o.binToString(n.bin)+"_"+n.field;f in t||(t[f]={bin:l,field:n.field,as:[u.field(n,{binSuffix:"start"}),u.field(n,{binSuffix:"end"})],signal:c.varName(e.getName(f+"_bins")),extentSignal:e.getName(f+"_extent")}),t[f]=a.__assign({},t[f],i(e,n,r))}return t},{});return 0===Object.keys(n).length?null:new t(n)},t.prototype.merge=function(e){this.bins=c.extend(e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return c.vals(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return c.vals(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return c.flatten(c.vals(this.bins).map(function(e){var t=[],n=a.__assign({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return e.bin.extent||(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(l.DataFlowNode);n.BinNode=f},{"../../bin":43,"../../fielddef":110,"../../scale":115,"../../util":124,"./dataflow":53,tslib:38}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=function(){function e(e){this.debugName=e,this._children=[],this._parent=null}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){var e=this;this._children.forEach(function(t){return t.parent=e._parent}),this._parent.removeChild(this)},e.prototype.swapWithParent=function(){var e=this._parent,t=e.parent;this._children.forEach(function(t){return t.parent=e}),this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}();n.DataFlowNode=i;var a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.type=n,r._refcount=0,r._source=t,r}return r.__extends(t,e),t.prototype.clone=function(){var e=new this.constructor;return e._source=this._source,e.debugName="clone_"+this.debugName,e._refcount=this._refcount,e},Object.defineProperty(t.prototype,"source",{get:function(){return this._refcount++,this._source},set:function(e){this._source=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){return this._refcount>0},enumerable:!0,configurable:!0}),t}(i);n.OutputNode=a},{tslib:38}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../channel"),a=e("./dataflow"),o=function(e){function t(t,n,r){var a=e.call(this)||this;return a.model=t,a.name=n,a.data=r,t.facet.column&&(a.columnField=t.field(i.COLUMN),a.columnName=t.getName("column")),t.facet.row&&(a.rowField=t.field(i.ROW),a.rowName=t.getName("row")),a}return r.__extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){var e=[];return this.columnField&&e.push(this.columnField),this.rowField&&e.push(this.rowField),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this.name},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=[];return this.columnName&&e.push({name:this.columnName,source:this.data,transform:[{type:"aggregate",groupby:[this.columnField]}]}),this.rowName&&e.push({name:this.rowName,source:this.data,transform:[{type:"aggregate",groupby:[this.rowField]}]}),e},t}(a.DataFlowNode);n.FacetNode=o},{"../../channel":44,"./dataflow":53,tslib:38}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../data"),a=e("../../datetime"),o=e("../../fielddef"),u=e("../../filter"),s=e("../../type"),c=e("../../util"),l=e("../../transform"),f=e("./dataflow"),d=function(e){function t(t){var n=e.call(this)||this;return n._parse={},n._parse=t,n}return r.__extends(t,e),t.make=function(e){var n={},r=e.transforms.filter(l.isCalculate).reduce(function(e,t){return e[t.as]=!0,e},{});e.transforms.filter(l.isFilter).forEach(function(e){var t=e.filter;c.isArray(t)||(t=[t]),t.forEach(function(e){var t=null;u.isEqualFilter(e)?t=e.equal:u.isRangeFilter(e)?t=e.range[0]:u.isOneOfFilter(e)&&(t=(e.oneOf||e.in)[0]),t&&(a.isDateTime(t)?n[e.field]="date":c.isNumber(t)?n[e.field]="number":c.isString(t)&&(n[e.field]="string"))})}),e.forEachFieldDef(function(e){if(e.type===s.TEMPORAL)n[e.field]="date";else if(e.type===s.QUANTITATIVE){if(o.isCount(e)||r[e.field])return;n[e.field]="number"}});var f=e.data;if(f&&i.isUrlData(f)&&f.format&&f.format.parse){var d=f.format.parse;c.keys(d).forEach(function(e){n[e]=d[e]})}return new t(n)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=c.extend(this._parse,e.parse),e.remove()},t.prototype.assemble=function(){return this._parse},t}(f.DataFlowNode);n.ParseNode=d},{"../../data":106,"../../datetime":107,"../../fielddef":110,"../../filter":111,"../../transform":122,"../../type":123,"../../util":124,"./dataflow":53,tslib:38}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../scale"),a=e("../../util"),o=e("./dataflow"),u=function(e){function t(t){var n=e.call(this)||this;return n._filter=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(a.extend({},this._filter))},t.make=function(e){var n=e.channels().reduce(function(t,n){var r=e.scale(n);return r&&e.field(n)?(t[e.field(n)]=r.type===i.ScaleType.LOG,t):t},{});return Object.keys(n).length?new t(n):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this;return a.keys(this._filter).filter(function(t){return e._filter[t]}).map(function(e){return{type:"filter",expr:'datum["'+e+'"] > 0'}})},t}(o.DataFlowNode);n.NonPositiveFilterNode=u},{"../../scale":115,"../../util":124,"./dataflow":53,tslib:38}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../type"),a=e("../../util"),o=e("./dataflow"),u={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0},s=function(e){function t(t){var n=e.call(this)||this;return n._filteredFields=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(a.duplicate(this._filteredFields))},t.make=function(e){var n=e.reduceFieldDef(function(t,n){return"count"!==n.aggregate&&(e.config.filterInvalid||void 0===e.config.filterInvalid&&n.field&&u[n.type]?t[n.field]=n:t[n.field]=null),t},{});return 0===Object.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"filteredFields",{get:function(){return this._filteredFields},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){var t=this,n=Object.keys(this._filteredFields).map(function(e){return e+" "+a.hash(t._filteredFields[e])}),r=Object.keys(e.filteredFields).map(function(t){return t+" "+a.hash(e.filteredFields[t])});a.differArray(n,r)||(this._filteredFields=a.extend(this._filteredFields,e._filteredFields),e.remove())},t.prototype.assemble=function(){var e=this,t=a.keys(this._filteredFields).reduce(function(t,n){var r=e._filteredFields[n];return null!==r&&(t.push('datum["'+r.field+'"] !== null'),a.contains([i.QUANTITATIVE,i.TEMPORAL],r.type)&&t.push('!isNaN(datum["'+r.field+'"])')),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(o.DataFlowNode);n.NullFilterNode=s},{"../../type":123,"../../util":124,"./dataflow":53,tslib:38}],58:[function(e,t,n){"use strict";function r(e){function t(n){if(!(n.parent instanceof o.SourceNode)){if(!n||!n.parent)throw new Error("A source node cannot have parents and roots haev to be source nodes.");var r=n.parent;e(n),t(r)}}return t}function i(e){var t=e.parent;e instanceof a.ParseNode&&(t instanceof a.ParseNode?t.merge(e):e.swapWithParent())}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./formatparse"),o=e("./source");n.optimizeFromLeaves=r,n.parse=i},{"./formatparse":55,"./source":61}],59:[function(e,t,n){"use strict";function r(e,t){if(e.data||!e.parent){var n=new g.SourceNode(e),r=n.hash();return r in t?t[r]:(t[r]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function i(e){var t=r(e,e.component.data.sources),n=e.component.data.outputNodes,i=t,g=d.ParseNode.make(e);if(g.parent=t,i=g,e.transforms.length>0){var _=b.parseTransformArray(e),S=_.first,x=_.last;S.parent=i,i=x}var M=m.NullFilterNode.make(e);M&&(M.parent=i,i=M);var E=c.BinNode.make(e);E&&(E.parent=i,i=E);var w=y.TimeUnitNode.make(e);w&&(w.parent=i,i=w);var O=e.getName(a.RAW),N=new l.OutputNode(O,a.RAW);if(n[O]=N,N.parent=i,i=N,e instanceof u.UnitModel){var T=s.AggregateNode.make(e);T&&(T.parent=i,i=T)}if(e instanceof u.UnitModel){var A=v.StackNode.make(e);A&&(A.parent=i,i=A)}var D=p.NonPositiveFilterNode.make(e);if(D&&(D.parent=i,i=D),e instanceof u.UnitModel){var k=h.OrderNode.make(e);k&&(k.parent=i,i=k)}var C=e.getName(a.MAIN),P=new l.OutputNode(C,a.MAIN);n[C]=P,P.parent=i,i=P;var R=null;if(e instanceof o.FacetModel){var L=e.getName("facet");R=new f.FacetNode(e,L,P.source),n[L]=R,R.parent=i,i=R}return{sources:e.component.data.sources,outputNodes:n,main:P,facetRoot:R}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../data"),o=e("../facet"),u=e("../unit"),s=e("./aggregate"),c=e("./bin"),l=e("./dataflow"),f=e("./facet"),d=e("./formatparse"),p=e("./nonpositivefilter"),m=e("./nullfilter"),h=e("./pathorder"),g=e("./source"),v=e("./stack"),y=e("./timeunit"),b=e("./transforms");n.parseData=i},{"../../data":106,"../facet":65,"../unit":103,"./aggregate":50,"./bin":52,"./dataflow":53,"./facet":54,"./formatparse":55,"./nonpositivefilter":56,"./nullfilter":57,"./pathorder":60,"./source":61,"./stack":62,"./timeunit":63,"./transforms":64}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../encoding"),a=e("../../fielddef"),o=e("../../sort"),u=e("../../util"),s=e("../common"),c=e("./dataflow"),l=function(e){function t(t){var n=e.call(this)||this;return n.sort=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this.sort))},t.make=function(e){var n=null;if(!u.contains(["line","area"],e.mark()))return null;if("line"===e.mark()&&e.channelHasField("order"))n=s.sortParams(e.encoding.order);else{var r="horizontal"===e.markDef.orient?"y":"x",c=e.sort(r);n={field:o.isSortField(c)?a.field({aggregate:i.isAggregate(e.encoding)?c.op:void 0,field:c.field}):e.field(r,{binSuffix:"start"}),order:"descending"}}return new t(n)},t.prototype.assemble=function(){return{type:"collect",sort:this.sort}},t}(c.DataFlowNode);n.OrderNode=l},{"../../encoding":108,"../../fielddef":110,"../../sort":117,"../../util":124,"../common":48,"./dataflow":53,tslib:38}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../data"),a=e("../../util"),o=e("./dataflow"),u=function(e){function t(t){var n=e.call(this)||this,o=t.data||{name:"source"};if(i.isInlineData(o))n._data={values:o.values,format:{type:"json"}};else if(i.isUrlData(o)){var u=/(?:\.([^.]+))?$/.exec(o.url)[1];a.contains(["json","csv","tsv","topojson"],u)||(u="json");var s=o.format||{},c=s.type||o.formatType,l=s.property,f=s.feature,d=s.mesh,p=r.__assign({type:c||u},l?{property:l}:{},f?{feature:f}:{},d?{mesh:d}:{});n._data={url:o.url,format:p}}else i.isNamedData(o)&&(n._name=o.name);return n}return r.__extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),t.prototype.hash=function(){if(i.isInlineData(this._data))return a.hash(this._data);if(i.isUrlData)return this._data.url+" "+a.hash(this._data.format);if(i.isNamedData)return this._data.name;throw new Error("Unsupported source")},t.prototype.assemble=function(){return r.__assign({name:this._name},this._data,{transform:[]})},t}(o.DataFlowNode);n.SourceNode=u},{"../../data":106,"../../util":124,"./dataflow":53,tslib:38}],62:[function(e,t,n){"use strict";function r(e){return e.stack.stackBy.reduce(function(t,n){var r=n.channel,i=n.fieldDef,a=e.scale(r),s=o.field(i,{binSuffix:a&&u.hasDiscreteDomain(a.type)?"range":"start"});return s&&t.push(s),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("vega-util"),o=e("../../fielddef"),u=e("../../scale"),s=e("../../util"),c=e("../common"),l=e("./dataflow"),f=function(e){function t(t){var n=e.call(this)||this;return n._stack=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this._stack))},t.make=function(e){var n=e.stack;if(!n)return null;var i=[];if(n.groupbyChannel){e.fieldDef(n.groupbyChannel).bin?(i.push(e.field(n.groupbyChannel,{binSuffix:"start"})),i.push(e.field(n.groupbyChannel,{binSuffix:"end"}))):i.push(e.field(n.groupbyChannel))}var a,o=r(e),u=e.encoding.order;return a=u?c.sortParams(u):o.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new t({groupby:i,field:e.field(n.fieldChannel),stackby:o,sort:a,offset:n.offset,impute:s.contains(["area","line"],e.mark())})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.groupby=this._stack.groupby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.field]=!0,this._stack.groupby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return a.isArray(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},t.prototype.assemble=function(){var e=[],t=this._stack;return t.impute&&e.push({type:"impute",field:t.field,groupby:t.stackby,orderby:t.groupby,method:"value",value:0}),e.push({type:"stack",groupby:t.groupby,field:t.field,sort:t.sort,as:[t.field+"_start",t.field+"_end"],offset:t.offset}),e},t}(l.DataFlowNode);n.StackNode=f},{"../../fielddef":110,"../../scale":115,"../../util":124,"../common":48,"./dataflow":53,tslib:38,"vega-util":128}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../../fielddef"),a=e("../../timeunit"),o=e("../../type"),u=e("../../util"),s=e("./dataflow"),c=function(e){function t(t){var n=e.call(this)||this;return n.formula=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(u.duplicate(this.formula))},t.make=function(e){var n=e.reduceFieldDef(function(e,t){if(t.type===o.TEMPORAL&&t.timeUnit){var n=i.field(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===Object.keys(n).length?null:new t(n)},t.prototype.merge=function(e){this.formula=u.extend(this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return u.vals(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return u.vals(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return u.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:a.fieldExpr(e.timeUnit,e.field)}})},t}(s.DataFlowNode);n.TimeUnitNode=c},{"../../fielddef":110,"../../timeunit":120,"../../type":123,"../../util":124,"./dataflow":53,tslib:38}],64:[function(e,t,n){"use strict";function r(e){var t,n,r,i;return e.transforms.forEach(function(e,n){if(s.isCalculate(e))r=new d(e);else{if(!s.isFilter(e))return void u.warn(u.message.invalidTransformIgnored(e));r=new f(e.filter)}0===n?t=r:r.parent=i,i=r}),n=r,{first:t,last:n}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("vega-util"),o=e("../../filter"),u=e("../../log"),s=e("../../transform"),c=e("../../util"),l=e("./dataflow"),f=function(e){function t(t){var n=e.call(this)||this;return n.filter=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(c.duplicate(this.filter))},t.prototype.merge=function(e){this.filter=(a.isArray(this.filter)?this.filter:[this.filter]).concat(a.isArray(e.filter)?e.filter:[e.filter]),this.remove()},t.prototype.assemble=function(){return{type:"filter",expr:o.expression(this.filter)}},t}(l.DataFlowNode);n.FilterNode=f;var d=function(e){function t(t){var n=e.call(this)||this;return n.transform=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(c.duplicate(this.transform))},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(l.DataFlowNode);n.CalculateNode=d,n.parseTransformArray=r},{"../../filter":111,"../../log":113,"../../transform":122,"../../util":124,"./dataflow":53,tslib:38,"vega-util":128}],65:[function(e,t,n){"use strict";function r(e){return e.hasDescendantWithFieldOnChannel("x")||e.hasDescendantWithFieldOnChannel("y")}function i(e,t,n){return void 0!==e.spacing?e.spacing:r(t)?n.scale.facetSpacing:0}function a(e){var t=e.child,n=g.extend({},t.config.cell,t.config.facet.cell);return g.extend({x:e.channelHasField(f.COLUMN)?{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN),offset:e.spacing(f.COLUMN)/2}:{value:e.config.scale.facetSpacing/2},y:e.channelHasField(f.ROW)?{scale:e.scaleName(f.ROW),field:e.field(f.ROW),offset:e.spacing(f.ROW)/2}:{value:e.config.scale.facetSpacing/2},width:{field:{parent:e.child.sizeName("width")}},height:{field:{parent:e.child.sizeName("height")}}},r(e)?t.assembleParentGroupProperties(n):{})}function o(e,t){var n=null,r=e.child;return r.channelHasField(t)&&r.axis(t)&&(n=u(e,t),r.axis(t)&&b.gridShow(r,t)?r.component.axes[t]=[y.parseGridAxis(t,r)]:delete r.component.axes[t]),n}function u(e,t){var n="x"===t,r=n?"column":"row",i=!!e.facet[r],a={name:e.getName(t+"-axes"),type:"group"};return i&&(a.from={data:"x"===t?e.getName("column"):e.getName("row")}),a.encode=n?{update:{width:{field:{parent:e.child.sizeName("width")}},height:{field:{group:"height"}},x:i?{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN),offset:e.spacing(f.COLUMN)/2}:{value:e.config.scale.facetSpacing/2}}}:{update:{width:{field:{group:"width"}},height:{field:{parent:e.child.sizeName("height")}},y:i?{scale:e.scaleName(f.ROW),field:e.field(f.ROW),offset:e.spacing(f.ROW)/2}:{value:e.config.scale.facetSpacing/2}}},a.axes=[y.parseMainAxis(t,e.child)],a}function s(e){var t=e.config.facet.grid;return[{name:e.getName("row-grid"),type:"rule",from:{data:e.getDataName(d.MAIN)},encode:{update:{y:{scale:e.scaleName(f.ROW),field:e.field(f.ROW)},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}},{name:e.getName("row-grid-end"),type:"rule",encode:{update:{y:{field:{group:"height"}},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}function c(e){var t=e.config.facet.grid;return[{name:e.getName("column-grid"),type:"rule",from:{data:e.getDataName(d.MAIN)},encode:{update:{x:{scale:e.scaleName(f.COLUMN),field:e.field(f.COLUMN)},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}},{name:e.getName("column-grid-end"),type:"rule",encode:{update:{x:{field:{group:"width"}},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}Object.defineProperty(n,"__esModule",{value:!0});var l=e("tslib"),f=e("../channel"),d=e("../data"),p=e("../encoding"),m=e("../fielddef"),h=e("../log"),g=e("../util"),v=e("../vega.schema"),y=e("./axis/parse"),b=e("./axis/rules"),_=e("./common"),S=e("./data/assemble"),x=e("./data/parse"),M=e("./layout"),E=e("./model"),w=e("./scale/init"),O=e("./scale/parse"),N=function(e){function t(t,n,r,i){var a=e.call(this,t,n,r,i)||this;a.scales={},a.axes={},a.legends={},a.stack=null,a._spacing={};var o=a.child=_.buildModel(t.spec,a,a.getName("child"),i);a.children=[o];var u=a.facet=a.initFacet(t.facet);return a.scales=a.initScalesAndSpacing(u,a.config),a.axes=a.initAxis(u,a.config,o),a.legends={},a}return l.__extends(t,e),t.prototype.initFacet=function(e){return p.reduce(e,function(e,t,n){return g.contains([f.ROW,f.COLUMN],n)?void 0===t.field?(h.warn(h.message.emptyFieldDef(t,n)),e):(e[n]=m.normalize(t,n),e):(h.warn(h.message.incompatibleChannel(n,"facet")),e)},{})},t.prototype.initScalesAndSpacing=function(e,t){var n=this;return[f.ROW,f.COLUMN].reduce(function(r,a){return e[a]&&(r[a]=w.default(a,e[a],t,void 0,void 0,[]),n._spacing[a]=i(e[a].scale||{},n,t)),r},{})},t.prototype.initAxis=function(e,t,n){var r=this;return[f.ROW,f.COLUMN].reduce(function(i,a){if(e[a]){var o=e[a].axis;if(!1!==o){var u=void 0!==t.facet&&void 0!==t.facet.axis?t.facet.axis:{},s=i[a]=l.__assign({},o,u);if(a===f.ROW){var c=n.axis(f.Y);c&&"right"!==c.orient&&void 0===s.orient&&(s.orient="right"),r.hasDescendantWithFieldOnChannel(f.X)&&void 0===s.labelAngle&&(s.labelAngle="right"===s.orient?90:270)}}}return i},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=x.parseData(this),this.child.parseData()},t.prototype.parseSelection=function(){},t.prototype.parseLayoutData=function(){this.child.parseLayoutData(),this.component.layout=M.parseFacetLayout(this)},t.prototype.parseScale=function(){var e=this,t=this.child,n=this;t.parseScale();var r=this.component.scales=O.default(this);g.keys(t.component.scales).forEach(function(i){var a=r[i]=t.component.scales[i],o=a.name.substr(t.getName("").length),u=n.scaleName(o,!0);t.renameScale(a.name,u),a.name=u;var s=a.domain;v.isDataRefDomain(s)||v.isFieldRefUnionDomain(s)?s.data=S.FACET_SCALE_PREFIX+e.getName(s.data):v.isDataRefUnionedDomain(s)&&(s.fields=s.fields.map(function(t){return l.__assign({},t,{data:S.FACET_SCALE_PREFIX+e.getName(t.data)})})),delete t.component.scales[i]})},t.prototype.parseMark=function(){this.child.parseMark(),this.component.mark=[{name:this.getName("cell"),type:"group",from:{facet:{name:this.component.data.facetRoot.name,data:this.component.data.facetRoot.data,groupby:[].concat(this.channelHasField(f.ROW)?[this.field(f.ROW)]:[],this.channelHasField(f.COLUMN)?[this.field(f.COLUMN)]:[])}},encode:{update:a(this)}}]},t.prototype.parseAxis=function(){this.child.parseAxis(),this.component.axes=y.parseAxisComponent(this,[f.ROW,f.COLUMN])},t.prototype.parseAxisGroup=function(){var e=o(this,f.X),t=o(this,f.Y);this.component.axisGroups=g.extend(e?{x:e}:{},t?{y:t}:{})},t.prototype.parseGridGroup=function(){var e=this.child;this.component.gridGroups=g.extend(!e.channelHasField(f.X)&&this.channelHasField(f.COLUMN)?{column:c(this)}:{},!e.channelHasField(f.Y)&&this.channelHasField(f.ROW)?{row:s(this)}:{})},t.prototype.parseLegend=function(){this.child.parseLegend(),this.component.legends=this.child.component.legends,this.child.component.legends={}},t.prototype.assembleData=function(){return this.parent?[]:S.assembleData(g.vals(this.component.data.sources))},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSignals=function(e){return[]},t.prototype.assembleSelectionData=function(e){return[]},t.prototype.assembleLayout=function(e){return this.child.assembleLayout(e),M.assembleLayout(this,e)},t.prototype.assembleMarks=function(){var e=S.assembleFacetData(this.component.data.facetRoot),t=this.component.mark[0];return t.from.facet.name=this.component.data.facetRoot.name,t.from.facet.data=this.component.data.facetRoot.data,[].concat(g.vals(this.component.axisGroups),g.flatten(g.vals(this.component.gridGroups)),g.extend(t,e.length>0?{data:e}:{},this.child.assembleGroup())).map(this.correctDataNames)},t.prototype.channels=function(){return[f.ROW,f.COLUMN]},t.prototype.getMapping=function(){return this.facet},t.prototype.spacing=function(e){return this._spacing[e]},t.prototype.isFacet=function(){return!0},t}(E.Model);n.FacetModel=N,n.hasSubPlotWithXy=r,n.spacing=i,n.getSharedAxisGroup=u},{"../channel":44,"../data":106,"../encoding":108,"../fielddef":110,"../log":113,"../util":124,"../vega.schema":126,"./axis/parse":46,"./axis/rules":47,"./common":48,"./data/assemble":51,"./data/parse":59,"./layout":67,"./model":83,"./scale/init":86,"./scale/parse":87,tslib:38}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../mark"),a=e("../util"),o=e("../vega.schema"),u=e("./common"),s=e("./data/assemble"),c=e("./data/parse"),l=e("./layout"),f=e("./model"),d=e("./scale/domain"),p=function(e){function t(t,n,r,i){var a=e.call(this,t,n,r,i)||this;return a.scales={},a.axes={},a.legends={},a.stack=null,a.width=t.width,a.height=t.height,a.children=t.layer.map(function(e,t){return u.buildModel(e,a,a.getName("layer_"+t),i)}),a}return r.__extends(t,e),t.prototype.channelHasField=function(e){return!1},t.prototype.hasDiscreteScale=function(e){return this.children[0].hasDiscreteScale(e)},t.prototype.fieldDef=function(e){return null},t.prototype.parseData=function(){this.component.data=c.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){},t.prototype.parseLayoutData=function(){this.children.forEach(function(e){e.parseLayoutData()}),this.component.layout=l.parseLayerLayout(this)},t.prototype.parseScale=function(){var e=this,t=this.component.scales={};this.children.forEach(function(n){n.parseScale(),a.keys(n.component.scales).forEach(function(r){var i=n.component.scales[r],a=t[r];if(!(!i||o.isSignalRefDomain(i.domain)||a&&o.isSignalRefDomain(a.domain))){a?a.domain=d.unionDomains(a.domain,i.domain):t[r]=i;var u=i.name.substr(n.getName("").length),s=e.scaleName(u,!0);n.renameScale(i.name,s),i.name=s,delete n.component.scales[r]}})})},t.prototype.parseMark=function(){this.children.forEach(function(e){e.parseMark()})},t.prototype.parseAxis=function(){var e=this.component.axes={};this.children.forEach(function(t){t.parseAxis(),a.keys(t.component.axes).forEach(function(n){e[n]||(e[n]=t.component.axes[n])})})},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){var e=this.component.legends={};this.children.forEach(function(t){t.parseLegend(),a.keys(t.component.legends).forEach(function(n){e[n]||(e[n]=t.component.legends[n])})})},t.prototype.assembleParentGroupProperties=function(e){return u.applyConfig({},e,i.FILL_STROKE_CONFIG.concat(["clip"]))},
t.prototype.assembleSignals=function(e){return[]},t.prototype.assembleSelectionData=function(e){return[]},t.prototype.assembleData=function(){return this.parent?[]:s.assembleData(a.vals(this.component.data.sources))},t.prototype.assembleScales=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleScales())},e.prototype.assembleScales.call(this))},t.prototype.assembleLayout=function(e){return this.children.forEach(function(t){t.assembleLayout(e)}),l.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return a.flatten(this.children.map(function(e){return e.assembleMarks()}))},t.prototype.channels=function(){return[]},t.prototype.getMapping=function(){return null},t.prototype.isLayer=function(){return!0},t}(f.Model);n.LayerModel=p},{"../mark":114,"../util":124,"../vega.schema":126,"./common":48,"./data/assemble":51,"./data/parse":59,"./layout":67,"./model":83,"./scale/domain":85,tslib:38}],67:[function(e,t,n){"use strict";function r(e,t){var n=e.component.layout;if(!n.width&&!n.height)return t;var r=y.keys(y.extend(n.width.distinct,n.height.distinct)),i=n.width.formula.concat(n.height.formula).map(function(e){return m.__assign({type:"formula"},e)});return[r.length>0?{name:e.getName(g.LAYOUT),source:e.lookupDataSource(n.width.source||n.height.source),transform:[{type:"aggregate",fields:r,ops:r.map(function(){return"distinct"})}].concat(i)}:{name:e.getName(g.LAYOUT),values:[{}],transform:i}]}function i(e){return{width:a(e,h.X),height:a(e,h.Y)}}function a(e,t){var n=d(e,t);return{source:y.keys(n).length>0?e.getDataName(g.MAIN):null,distinct:n,formula:[{as:e.channelSizeName(t),expr:o(e,t)}]}}function o(e,t){var n=e.scale(t);if(n&&v.hasDiscreteDomain(n.type)&&n.rangeStep){var r=p(e,t),i=void 0!==n.paddingOuter?n.paddingOuter:n.padding,a="band"===n.type?void 0!==n.paddingInner?n.paddingInner:n.padding:1;return"max("+(r+(a?" - "+a:"")+(i?" + 2*"+i:""))+", 0) * "+n.rangeStep}return(t===h.X?e.width:e.height)+""}function u(e){return{width:s(e,h.COLUMN),height:s(e,h.ROW)}}function s(e,t){var n=e.child.component.layout,r=t===h.ROW?"height":"width",i=n[r],a=y.extend(d(e,t),i.distinct),o=i.formula.concat([{as:e.channelSizeName(t),expr:c(e,t,e.child.channelSizeName(t))}]);return delete n[r],{source:e.getDataName(g.MAIN),distinct:a,formula:o}}function c(e,t,n){return e.channelHasField(t)?'(datum["'+n+'"] + '+e.spacing(t)+") * "+p(e,t):'datum["'+n+'"] + '+e.config.scale.facetSpacing}function l(e){return{width:f(e,h.X),height:f(e,h.Y)}}function f(e,t){var n=e.children[0].component.layout,r=t===h.Y?"height":"width",i=n[r],a=i.distinct,o=[{as:e.channelSizeName(t),expr:i.formula[0].expr}];return e.children.forEach(function(e){delete e.component.layout[r]}),{source:e.getDataName(g.MAIN),distinct:a,formula:o}}function d(e,t){if(e.channelHasField(t)&&e.hasDiscreteScale(t)){var n=e.scale(t);if(v.hasDiscreteDomain(n.type)&&!(n.domain instanceof Array)){var r=e.field(t),i={};return i[r]=!0,i}}return{}}function p(e,t){var n=e.scale(t);return n.domain instanceof Array?n.domain.length+"":e.field(t,{datum:!0,prefix:"distinct"})}Object.defineProperty(n,"__esModule",{value:!0});var m=e("tslib"),h=e("../channel"),g=e("../data"),v=e("../scale"),y=e("../util");n.assembleLayout=r,n.parseUnitLayout=i,n.unitSizeExpr=o,n.parseFacetLayout=u,n.parseLayerLayout=l,n.cardinalityExpr=p},{"../channel":44,"../data":106,"../scale":115,"../util":124,tslib:38}],68:[function(e,t,n){"use strict";function r(e,t,n,r){var i={},s=n.mark();switch(s){case u.BAR:case u.TICK:case u.TEXT:i.shape={value:"square"};break;case u.CIRCLE:case u.SQUARE:i.shape={value:s};break;case u.POINT:case u.LINE:case u.AREA:}var f=n.config,d=n.markDef.filled,p=r===a.COLOR?c.without(u.FILL_STROKE_CONFIG,[d?"fill":"stroke","strokeDash","strokeDashOffset"]):u.FILL_STROKE_CONFIG;p=c.without(p,["strokeDash","strokeDashOffset"]),l.applyMarkConfig(i,n,p),d&&(i.strokeWidth={value:0});var m,h=n.encoding.color;o.isValueDef(h)&&(m={value:h.value}),void 0!==m?d?i.fill=m:i.stroke=m:r!==a.COLOR&&(i[d?"fill":"stroke"]=i[d?"fill":"stroke"]||{value:f.mark.color}),void 0===i.fill&&(void 0!==f.mark.fill?i.fill={value:f.mark.fill}:void 0!==f.mark.stroke&&(i.stroke={value:f.mark.stroke}));var g=n.encoding.shape;return r!==a.SHAPE&&o.isValueDef(g)&&(i.shape={value:g.value}),i=c.extend(i,t||{}),c.keys(i).length>0?i:void 0}function i(e,t,n,r){var i=n.legend(r),a=n.config,o={};return e.type===s.TEMPORAL&&(t=c.extend({text:{signal:l.timeFormatExpression("datum.value",e.timeUnit,i.format,a.legend.shortTimeLabels,a.timeFormat)}},t||{})),o=c.extend(o,t||{}),c.keys(o).length>0?o:void 0}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../fielddef"),u=e("../../mark"),s=e("../../type"),c=e("../../util"),l=e("../common");n.symbols=r,n.labels=i},{"../../channel":44,"../../fielddef":110,"../../mark":114,"../../type":123,"../../util":124,"../common":48}],69:[function(e,t,n){"use strict";function r(e){return[u.COLOR,u.SIZE,u.SHAPE,u.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=a(e,n)),t},{})}function i(e,t){switch(t){case u.COLOR:var n=e.scaleName(u.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case u.SIZE:return{size:e.scaleName(u.SIZE)};case u.SHAPE:return{shape:e.scaleName(u.SHAPE)};case u.OPACITY:return{opacity:e.scaleName(u.OPACITY)}}return null}function a(e,t){var n=e.fieldDef(t),r=e.legend(t),a=i(e,t);s.LEGEND_PROPERTIES.forEach(function(n){var i=o(n,r,t,e);void 0!==i&&(a[n]=i)});var u=r.encode||{};return["labels","legend","title","symbols"].forEach(function(r){var i=f[r]?f[r](n,u[r],e,t):u[r];void 0!==i&&c.keys(i).length>0&&(a.encode=a.encode||{},a.encode[r]={update:i})}),a}function o(e,t,n,r){var i=r.fieldDef(n);switch(e){case"format":return l.numberFormat(i,t.format,r.config,n);case"title":return d.title(t,i,r.config);case"values":return d.values(t);case"type":return d.type(t,i.type,n,r.scale(n).type)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../channel"),s=e("../../legend"),c=e("../../util"),l=e("../common"),f=e("./encode"),d=e("./rules");n.parseLegendComponent=r,n.parseLegend=a},{"../../channel":44,"../../legend":112,"../../util":124,"../common":48,"./encode":68,"./rules":70}],70:[function(e,t,n){"use strict";function r(e,t,n){return void 0!==e.title?e.title:s.title(t,n)}function i(e){var t=e.values;return t&&u.isDateTime(t[0])?t.map(function(e){return u.timestamp(e,!0)}):t}function a(e,t,n,r){return e.type?e.type:n===o.COLOR&&("quantitative"===t&&!c.isBinScale(r)||"temporal"===t&&l.contains(["time","utc"],r))?"gradient":void 0}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),u=e("../../datetime"),s=e("../../fielddef"),c=e("../../scale"),l=e("../../util");n.title=r,n.values=i,n.type=a},{"../../channel":44,"../../datetime":107,"../../fielddef":110,"../../scale":115,"../../util":124}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins");n.area={vgMark:"area",defaultRole:void 0,encodeEntry:function(e){return r.__assign({},i.pointPosition("x",e,"zeroOrMin"),i.pointPosition("y",e,"zeroOrMin"),i.pointPosition2(e,"zeroOrMin"),i.color(e),i.nonPosition("opacity",e),i.markDefProperties(e.markDef,["orient","interpolate","tension"]))}}},{"./mixins":76,tslib:38}],72:[function(e,t,n){"use strict";function r(e,t){var n=e.config,r=e.width,i=e.markDef.orient,c=e.encoding.size,p=e.encoding.x,m=e.scaleName(u.X),h=e.scale(u.X);if("horizontal"===i)return o.__assign({},f.pointPosition("x",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(s.isFieldDef(p)){if(!c&&l.isBinScale(h.type))return f.binnedPosition("x",e,n.bar.binSpacing);if(h.type===l.ScaleType.BAND)return f.bandPosition("x",e)}return f.centeredBandPosition("x",e,o.__assign({},d.midX(r,n)),a(m,e.scale(u.X),n))}function i(e,t){var n=e.config,r=e.encoding,i=e.height,c=e.markDef.orient,p=r.size,m=r.y,h=e.scaleName(u.Y),g=e.scale(u.Y);if("vertical"===c)return o.__assign({},f.pointPosition("y",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(s.isFieldDef(m)){if(m.bin&&!p)return f.binnedPosition("y",e,n.bar.binSpacing);if(g.type===l.ScaleType.BAND)return f.bandPosition("y",e)}return f.centeredBandPosition("y",e,d.midY(i,n),a(h,e.scale(u.Y),n))}function a(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){if(t.type!==l.ScaleType.POINT)return t.type===l.ScaleType.BAND?d.band(e):{value:n.bar.continuousBandSize};if(null!==t.rangeStep)return{value:t.rangeStep-1};c.warn(c.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),u=e("../../channel"),s=e("../../fielddef"),c=e("../../log"),l=e("../../scale"),f=e("./mixins"),d=e("./valueref");n.bar={vgMark:"rect",defaultRole:"bar",encodeEntry:function(e){var t=e.stack;return o.__assign({},r(e,t),i(e,t),f.color(e),f.nonPosition("opacity",e))}}},{"../../channel":44,"../../fielddef":110,"../../log":113,"../../scale":115,"./mixins":76,"./valueref":82,tslib:38}],73:[function(e,t,n){"use strict";function r(e,t,n,r){var i=d.isMarkDef(e)?s.__assign({},e):{type:e},a=i.orient||g.getMarkConfig("orient",i.type,r);return i.orient=u(i.type,t,n,a),void 0!==a&&a!==i.orient&&f.warn(f.message.orientOverridden(i.orient,a)),void 0===i.filled&&(i.filled=o(i.type,r)),i}function i(e,t,n,r){var i=g.getMarkConfig("opacity",e,r);if(!t.opacity&&void 0===i){var o=a(e,t,n);void 0!==o&&(t.opacity={value:o})}return t}function a(e,t,n){if(h.contains([d.POINT,d.TICK,d.CIRCLE,d.SQUARE],e)&&!c.isAggregate(t))return.7}function o(e,t){var n=g.getMarkConfig("filled",e,t);return void 0!==n?n:e!==d.POINT&&e!==d.LINE&&e!==d.RULE}function u(e,t,n,r){switch(e){case d.POINT:case d.CIRCLE:case d.SQUARE:case d.TEXT:case d.RECT:return}var i=t.y&&t.y2,a=t.x&&t.x2;switch(e){case d.TICK:var o=n.x?n.x.type:null,u=n.y?n.y.type:null;return!p.hasDiscreteDomain(o)&&(!t.y||p.hasDiscreteDomain(u)||l.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case d.RULE:case d.BAR:case d.AREA:if(i)return"vertical";if(a)return"horizontal";if(e===d.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case d.LINE:var s=l.isFieldDef(t.x)&&l.isContinuous(t.x),c=l.isFieldDef(t.y)&&l.isContinuous(t.y);if(s&&!c)return"horizontal";if(!s&&c)return"vertical";if(s&&c){var h=t.x,g=t.y,v=h.type===m.TEMPORAL,y=g.type===m.TEMPORAL;return v&&!y?"vertical":!v&&y?"horizontal":!h.aggregate&&g.aggregate?"vertical":h.aggregate&&!g.aggregate?"horizontal":r||(e===d.LINE&&t.order||f.warn(f.message.unclearOrientContinuous(e)),"vertical")}return void f.warn(f.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),c=e("../../encoding"),l=e("../../fielddef"),f=e("../../log"),d=e("../../mark"),p=e("../../scale"),m=e("../../type"),h=e("../../util"),g=e("../common");n.initMarkDef=r,n.initEncoding=i},{"../../encoding":108,"../../fielddef":110,"../../log":113,"../../mark":114,"../../scale":115,"../../type":123,"../../util":124,"../common":48,tslib:38}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins");n.line={vgMark:"line",defaultRole:void 0,encodeEntry:function(e){return r.__assign({},i.pointPosition("x",e,"zeroOrMin"),i.pointPosition("y",e,"zeroOrMin"),i.color(e),i.nonPosition("opacity",e),i.nonPosition("size",e,{vgChannel:"strokeWidth"}),i.markDefProperties(e.markDef,["interpolate","tension"]))}}},{"./mixins":76,tslib:38}],75:[function(e,t,n){"use strict";function r(e){return l.contains([c.LINE,c.AREA],e.mark())?i(e):a(e)}function i(e){var t=e.mark(),n=o(e),r=[{name:e.getName("marks"),type:_[t].vgMark,from:{data:(n.length>0?S:"")+e.getDataName(b.MAIN)},encode:{update:_[t].encodeEntry(e)}}];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:S+e.getDataName(b.MAIN),data:e.getDataName(b.MAIN),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}function a(e){var t=e.mark(),n=e.markDef.role||_[t].defaultRole,r=[];return r.push(u.__assign({name:e.getName("marks"),type:_[t].vgMark},n?{role:n}:{},{from:{data:e.getDataName(b.MAIN)},encode:{update:_[t].encodeEntry(e)}})),r}function o(e){return s.LEVEL_OF_DETAIL_CHANNELS.reduce(function(t,n){return e.channelHasField(n)&&!e.fieldDef(n).aggregate&&t.push(e.field(n)),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),s=e("../../channel"),c=e("../../mark"),l=e("../../util"),f=e("./area"),d=e("./bar"),p=e("./line"),m=e("./point"),h=e("./rect"),g=e("./rule"),v=e("./text"),y=e("./tick"),b=e("../../data"),_={area:f.area,bar:d.bar,line:p.line,point:m.point,text:v.text,tick:y.tick,rect:h.rect,rule:g.rule,circle:m.circle,square:m.square};n.parseMark=r;var S="faceted-path-"},{"../../channel":44,"../../data":106,"../../mark":114,"../../util":124,"./area":71,"./bar":72,"./line":74,"./point":77,"./rect":78,"./rule":79,"./text":80,"./tick":81,tslib:38}],76:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.filled,r=o("color",e,{vgChannel:n?"fill":"stroke",defaultValue:v.getMarkConfig("color",e.mark(),t)});return!r.fill&&g.contains(["bar","point","circle","square"],e.mark())&&(r.fill={value:"transparent"}),r}function i(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]={value:e[n]}),t},{})}function a(e,t){if(void 0!==t)return n={},n[e]={value:t},n;return;var n}function o(e,t,n){void 0===n&&(n={});var r=n.defaultValue,i=n.vgChannel,a=n.defaultRef||(void 0!==r?{value:r}:void 0),o=t.encoding[e],s=y.midPoint(e,o,t.scaleName(e),t.scale(e),a);return u(t,o&&o.condition,i||e,s)}function u(e,t,n,r){if(t){var i=t.selection,a=t.value;return o={},o[n]=[{test:s(e,i),value:a}].concat(void 0!==r?[r]:[]),o}return void 0!==r?(u={},u[n]=r,u):{};var o,u}function s(e,t){var n="!"===t.charAt(0),r=n?t.slice(1):t;return(n?"!":"")+b.predicate(e.component.selection[r])}function c(e){var t=e.encoding.text;return u(e,t&&t.condition,"text",y.text(t,e.config))}function l(e,t){var n=t.encoding[e],r=t.scaleName(e),i="x"===e?"width":"height";return a={},a[e]=y.fieldRef(n,r,{}),a[i]=y.band(r),a;var a}function f(e,t,n,r){var i="x"===e?"xc":"yc",a="x"===e?"width":"height";return h.__assign({},p(e,t,n,i),o("size",t,{defaultRef:r,vgChannel:a}))}function d(e,t,n){var r=t.encoding[e],i=t.scaleName(e);return"x"===e?{x2:y.bin(r,i,"start",n),x:y.bin(r,i,"end")}:{y2:y.bin(r,i,"start"),y:y.bin(r,i,"end",n)}}function p(e,t,n,r){var i=t.encoding,a=t.stack,o=y.stackable(e,i[e],t.scaleName(e),t.scale(e),a,n);return u={},u[r||e]=o,u;var u}function m(e,t,n){var r=e.encoding,i=e.markDef,a=e.stack;n=n||("horizontal"===i.orient?"x2":"y2");var o="x2"===n?"x":"y",u=y.stackable2(n,r[o],r[n],e.scaleName(o),e.scale(o),a,t);return s={},s[n]=u,s;var s}Object.defineProperty(n,"__esModule",{value:!0});var h=e("tslib"),g=e("../../util"),v=e("../common"),y=e("./valueref"),b=e("../selection/selection");n.color=r,n.markDefProperties=i,n.valueIfDefined=a,n.nonPosition=o,n.text=c,n.bandPosition=l,n.centeredBandPosition=f,n.binnedPosition=d,n.pointPosition=p,n.pointPosition2=m},{"../../util":124,"../common":48,"../selection/selection":93,"./valueref":82,tslib:38}],77:[function(e,t,n){"use strict";function r(e,t){var n=e.config,r=e.width,u=e.height;return a.__assign({},o.pointPosition("x",e,s.midX(r,n)),o.pointPosition("y",e,s.midY(u,n)),o.color(e),o.nonPosition("size",e),i(e,n,t),o.nonPosition("opacity",e))}function i(e,t,n){return n?{shape:{value:n}}:o.nonPosition("shape",e,{defaultValue:u.getMarkConfig("shape","point",t)})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("./mixins"),u=e("../common"),s=e("./valueref");n.shapeMixins=i,n.point={vgMark:"symbol",defaultRole:"point",encodeEntry:function(e){return r(e)}},n.circle={vgMark:"symbol",defaultRole:"circle",encodeEntry:function(e){return r(e,"circle")}},n.square={vgMark:"symbol",defaultRole:"square",encodeEntry:function(e){return r(e,"square")}}},{"../common":48,"./mixins":76,"./valueref":82,tslib:38}],78:[function(e,t,n){"use strict";function r(e){var t=e.encoding.x,n=e.encoding.x2,r=e.scale(o.X);if(u.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("x",e,0);if(r&&l.hasDiscreteDomain(r.type)){if(r.type===l.ScaleType.BAND)return f.bandPosition("x",e);throw new Error(s.message.scaleTypeNotWorkWithMark(c.RECT,r.type))}return a.__assign({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}function i(e){var t=e.encoding.y,n=e.encoding.y2,r=e.scale(o.Y);if(u.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("y",e,0);if(r&&l.hasDiscreteDomain(r.type)){if(r.type===l.ScaleType.BAND)return f.bandPosition("y",e);throw new Error(s.message.scaleTypeNotWorkWithMark(c.RECT,r.type))}return a.__assign({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),u=e("../../fielddef"),s=e("../../log"),c=e("../../mark"),l=e("../../scale"),f=e("./mixins");n.rect={vgMark:"rect",defaultRole:void 0,encodeEntry:function(e){return a.__assign({},r(e),i(e),f.color(e),f.nonPosition("opacity",e))}}},{"../../channel":44,"../../fielddef":110,"../../log":113,"../../mark":114,"../../scale":115,"./mixins":76,tslib:38}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("./mixins"),a=e("./valueref");n.rule={vgMark:"rule",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.markDef,o=e.width,u=e.height,s=n.orient;return r.__assign({},i.pointPosition("x",e,"horizontal"===s?"zeroOrMin":a.midX(o,t)),i.pointPosition("y",e,"vertical"===s?"zeroOrMin":a.midY(u,t)),i.pointPosition2(e,"zeroOrMax"),i.color(e),i.nonPosition("opacity",e),i.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":76,"./valueref":82,tslib:38}],80:[function(e,t,n){"use strict";function r(e,t){return s.isFieldDef(t)&&t.type===c.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function i(e,t){if(void 0===u.getMarkConfig("align","text",t))return f.channelHasField(e,o.X)?"center":"right"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),u=e("../common"),s=e("../../fielddef"),c=e("../../type"),l=e("./mixins"),f=e("../../encoding"),d=e("./valueref");n.text={vgMark:"text",defaultRole:void 0,encodeEntry:function(e){var t=e.config,n=e.encoding,o=e.height,u=n.text;return a.__assign({},l.pointPosition("x",e,r(t,u)),l.pointPosition("y",e,d.midY(o,t)),l.text(e),l.color(e),l.nonPosition("opacity",e),l.nonPosition("size",e,{vgChannel:"fontSize"}),l.valueIfDefined("align",i(n,t)))}}},{"../../channel":44,"../../encoding":108,"../../fielddef":110,"../../type":123,"../common":48,"./mixins":76,"./valueref":82,tslib:38}],81:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.orient,r=(e.scale("horizontal"===n?"x":"y")||{}).rangeStep;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var i=void 0!==r?r:t.scale.rangeStep;if("number"!=typeof i)throw new Error("Function does not handle non-numeric rangeStep");return i/1.5}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("./mixins"),o=e("./valueref");n.tick={vgMark:"rect",defaultRole:"tick",encodeEntry:function(e){var t=e.config,n=e.markDef,u=e.width,s=e.height,c=n.orient,l="horizontal"===c?"width":"height",f="horizontal"===c?"height":"width";return i.__assign({},a.pointPosition("x",e,o.midX(u,t),"xc"),a.pointPosition("y",e,o.midY(s,t),"yc"),a.nonPosition("size",e,{defaultValue:r(e),vgChannel:l}),(d={},d[f]={value:t.tick.thickness},d),a.color(e),a.nonPosition("opacity",e));var d}}},{"./mixins":76,"./valueref":82,tslib:38}],82:[function(e,t,n){"use strict";function r(e,t,n,r,i,a){return t&&i&&e===i.fieldChannel?o(t,n,{suffix:"end"}):c(e,t,n,r,a)}function i(e,t,n,r,i,a,u){return t&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?o(t,r,{suffix:"start"}):c(e,n,r,i,u)}function a(e,t,n,r){return o(e,t,{binSuffix:n},r)}function o(e,t,n,r){var i={scale:t,field:y.field(e,n)};return r&&(i.offset=r),i}function u(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function s(e,t){return{signal:'(scale("'+t+'", '+y.field(e,{binSuffix:"start",datum:!0})+') + scale("'+t+'", '+y.field(e,{binSuffix:"end",datum:!0})+"))/2"}}function c(e,t,n,r,i){if(t){if(y.isFieldDef(t))return b.isBinScale(r.type)?_.contains(["x","y"],e)?s(t,n):o(t,n,{binSuffix:"start"}):b.hasDiscreteDomain(r.type)?"band"===r.type?o(t,n,{binSuffix:"range"},u(n,.5)):o(t,n,{binSuffix:"range"}):o(t,n,{});if(void 0!==t.value)return{value:t.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===i){if(e===v.X||e===v.X2)return p(n,r);if(e===v.Y||e===v.Y2)return h(n,r);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===i){if(e===v.X||e===v.X2)return m(n,r);if(e===v.Y||e===v.Y2)return g(n,r);throw new Error("Unsupported channel "+e+" for base function")}return i}function l(e,t){if(e){if(y.isFieldDef(e)){if("quantitative"===e.type){var n=S.numberFormat(e,e.format,t,"text");return{signal:"format("+y.field(e,{datum:!0})+", '"+n+"')"}}return"temporal"===e.type?{signal:S.timeFormatExpression(y.field(e,{datum:!0}),e.timeUnit,e.format,t.text.shortTimeLabels,t.timeFormat)}:{field:e.field}}if(e.value)return{value:e.value}}return{value:t.text.text}}function f(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function d(e,t){if(e)return{value:e/2};if("string"==typeof t.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:t.scale.rangeStep/2}}function p(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{value:0}}function m(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{field:{group:"width"}}}function h(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{field:{group:"height"}}}function g(e,t){return e&&!_.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&!1!==t.zero?{scale:e,value:0}:{value:0}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("../../channel"),y=e("../../fielddef"),b=e("../../scale"),_=e("../../util"),S=e("../common");n.stackable=r,n.stackable2=i,n.bin=a,n.fieldRef=o,n.band=u,n.midPoint=c,n.text=l,n.midX=f,n.midY=d},{"../../channel":44,"../../fielddef":110,"../../scale":115,"../../util":124,"../common":48}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../channel"),i=e("../encoding"),a=e("../fielddef"),o=e("../scale"),u=e("../util"),s=e("./scale/assemble"),c=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e];)e=this.nameMap[e];return e},e}();n.NameMap=c;var l=function(){function e(e,t,n,r){var i=this;this.scales={},this.axes={},this.legends={},this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=i.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=i.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.name=e.name||n,this.scaleNameMap=t?t.scaleNameMap:new c,this.sizeNameMap=t?t.sizeNameMap:new c,this.data=e.data,this.description=e.description,this.transforms=e.transform||[],this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{}},layout:null,mark:null,scales:null,axes:null,axisGroups:null,gridGroups:null,legends:null,selection:null}}return e.prototype.parse=function(){this.parseData(),this.parseLayoutData(),this.parseScale(),this.parseSelection(),this.parseAxis(),this.parseLegend(),this.parseAxisGroup(),this.parseGridGroup(),this.parseMark()},e.prototype.assembleScales=function(){return s.assembleScale(this)},e.prototype.assembleAxes=function(){return[].concat.apply([],u.vals(this.component.axes))},e.prototype.assembleLegends=function(){return u.vals(this.component.legends)},e.prototype.assembleGroup=function(){var e={},t=this.assembleSignals(e.signals||[]);t.length>0&&(e.signals=t),e.marks=this.assembleMarks();var n=this.assembleScales();n.length>0&&(e.scales=n);var r=this.assembleAxes();r.length>0&&(e.axes=r);var i=this.assembleLegends();return i.length>0&&(e.legends=i),e},e.prototype.reduceFieldDef=function(e,t,n){return i.reduce(this.getMapping(),function(t,n,r){return a.isFieldDef(n)?e(t,n,r):t},t,n)},e.prototype.forEachFieldDef=function(e,t){i.forEach(this.getMapping(),function(t,n){a.isFieldDef(t)&&e(t,n)},t)},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(r.isUnit()){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e,t){return void 0===t&&(t="_"),(this.name?this.name+t:"")+e},e.prototype.getDataName=function(e){var t=this.getName(e);return this.lookupDataSource(t)},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.source:e},e.prototype.renameSize=function(e,t){this.sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===r.X||e===r.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this.sizeNameMap.get(this.getName(e,"_"))},e.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=u.extend({binSuffix:o.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),a.field(n,t)},e.prototype.scale=function(e){return this.scales[e]},e.prototype.hasDiscreteScale=function(e){var t=this.scale(e);return t&&o.hasDiscreteDomain(t.type)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):this.scale&&this.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},e.prototype.axis=function(e){return this.axes[e]},e.prototype.legend=function(e){return this.legends[e]},e.prototype.isUnit=function(){return!1},e.prototype.isFacet=function(){return!1},e.prototype.isLayer=function(){return!1},e}();n.Model=l},{"../channel":44,"../encoding":108,"../fielddef":110,"../scale":115,"../util":124,"./scale/assemble":84}],84:[function(e,t,n){"use strict";function r(e){return o.vals(e.component.scales).map(function(t){var n=t.domain;if(u.isDataRefDomain(n)||u.isFieldRefUnionDomain(n))return n.data=e.lookupDataSource(n.data),t;if(u.isDataRefUnionedDomain(n))return n.fields=n.fields.map(function(t){return i.__assign({},t,{data:e.lookupDataSource(t.data)})}),t;if(u.isSignalRefDomain(n)||a.isArray(n))return t;throw new Error("invalid scale domain")})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),a=e("vega-util"),o=e("../../util"),u=e("../../vega.schema");n.assembleScale=r},{"../../util":124,"../../vega.schema":126,tslib:38,"vega-util":128}],85:[function(e,t,n){"use strict";function r(e,t,n,r){if("unaggregated"===e){var i=u(t,n),a=i.valid,o=i.reason;if(!a)return void l.warn(o)}else if(void 0===e&&r.useUnaggregatedDomain){var a=u(t,n).valid;if(a)return"unaggregated"}return e}function i(e,t){var n=e.scale(t);return"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?c(a(n,e,"x"),a(n,e,"x2")):a(n,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?c(a(n,e,"y"),a(n,e,"y2")):a(n,e,"y2"):a(n,e,t)}function a(e,t,n){var r=t.fieldDef(n);if(e.domain&&"unaggregated"!==e.domain)return p.isDateTime(e.domain[0])?e.domain.map(function(e){return p.timestamp(e,!0)}):e.domain;var i=t.stack;if(i&&n===i.fieldChannel)return"normalize"===i.offset?[0,1]:{data:t.getDataName(y.MAIN),fields:[t.field(n,{suffix:"start"}),t.field(n,{suffix:"end"})]};var a=o(t,n,e.type);if("unaggregated"===e.domain)return{data:t.getDataName(y.MAIN),fields:[t.field(n,{aggregate:"min"}),t.field(n,{aggregate:"max"})]};if(r.bin){if(m.isBinScale(e.type)){var u=t.getName(d.binToString(r.bin)+"_"+r.field+"_bins");return{signal:"sequence("+u+".start, "+u+".stop + "+u+".step, "+u+".step)"}}return m.hasDiscreteDomain(e.type)?{data:t.getDataName(y.MAIN),field:t.field(n,{binSuffix:"range"}),sort:{field:t.field(n,{binSuffix:"start"}),op:"min"}}:"x"===n||"y"===n?{data:t.getDataName(y.MAIN),fields:[t.field(n,{binSuffix:"start"}),t.field(n,{binSuffix:"end"})]}:{data:t.getDataName(y.MAIN),field:t.field(n,{binSuffix:"start"})}}return a?{data:g.isBoolean(a)?t.getDataName(y.MAIN):t.getDataName(y.RAW),field:t.field(n),sort:a}:{data:t.getDataName(y.MAIN),field:t.field(n)}}function o(e,t,n){if(m.hasDiscreteDomain(n)){var r=e.sort(t);return h.isSortField(r)?{op:r.op,field:r.field}:!!g.contains(["ascending","descending",void 0],r)||void 0}}function u(e,t){return e.aggregate?-1===f.SHARED_DOMAIN_OPS.indexOf(e.aggregate)?{valid:!1,reason:l.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:"quantitative"===e.type&&"log"===t?{valid:!1,reason:l.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:l.message.unaggregateDomainHasNoEffectForRawField(e)}}function s(e){if(g.isArray(e))return[e];if(v.isDataRefDomain(e))return delete e.sort,[e];if(v.isFieldRefUnionDomain(e))return e.fields.map(function(t){return{data:e.data,field:t}});if(v.isDataRefUnionedDomain(e))return e.fields.map(function(e){return g.isArray(e)?e:{field:e.field,data:e.data}});throw new Error(l.message.INVAID_DOMAIN)}function c(e,t){if(v.isSignalRefDomain(e)||v.isSignalRefDomain(t)){if(!v.isSignalRefDomain(e)||!v.isSignalRefDomain(t)||e.signal!==t.signal)throw new Error(l.message.UNABLE_TO_MERGE_DOMAINS);return e}var n=s(e),r=s(t),i=n.concat(r);if(i=g.unique(i,g.hash),i.length>1){var a=i.map(function(e){return v.isDataRefDomain(e)?e.data:null});return 1===g.unique(a,function(e){return e}).length&&null!==a[0]?{data:a[0],fields:i.map(function(e){return e.field})}:{fields:i,sort:!0}}return i[0]}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../log"),f=e("../../aggregate"),d=e("../../bin"),p=e("../../datetime"),m=e("../../scale"),h=e("../../sort"),g=e("../../util"),v=e("../../vega.schema"),y=e("../../data");n.initDomain=r,n.parseDomain=i,n.domainSort=o,n.canUseUnaggregatedDomain=u,n.unionDomains=c},{"../../aggregate":41,"../../bin":43,"../../data":106,"../../datetime":107,"../../log":113,"../../scale":115,"../../sort":117,"../../util":124,"../../vega.schema":126}],86:[function(e,t,n){"use strict";function r(e,t,r,a,c,f){var p=(t||{}).scale||{},m={type:d.default(p.type,e,t,a,void 0!==c,p.rangeStep,r.scale)};return n.NON_TYPE_RANGE_SCALE_PROPERTIES.forEach(function(n){var a=p[n],s=u.scaleTypeSupportProperty(m.type,n),c=u.channelScalePropertyIncompatability(e,n);if(void 0!==a&&(s?c&&o.warn(c):o.warn(o.message.scalePropertyNotWorkWithScaleType(m.type,n,e))),s&&void 0===c){var l=i(a,n,m,e,t,r.scale);void 0!==l&&(m[n]=l)}}),s.extend(m,l.default(e,m.type,t.type,p,r,m.zero,a,c,f))}function i(e,t,n,r,i,o){return"domain"===t?c.initDomain(e,i,n.type,o):void 0!==e?e:a(t,n,r,i,o)}function a(e,t,n,r,i){switch(e){case"nice":return f.nice(t.type,n,r);case"padding":return f.padding(n,t.type,i);case"paddingInner":return f.paddingInner(t.padding,n,i);case"paddingOuter":return f.paddingOuter(t.padding,n,t.type,t.paddingInner,i);case"round":return f.round(n,i);case"zero":return f.zero(t,n,r)}return i[e]}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../log"),u=e("../../scale"),s=e("../../util"),c=e("./domain"),l=e("./range"),f=e("./rules"),d=e("./type");n.NON_TYPE_RANGE_SCALE_PROPERTIES=["domain","round","clamp","nice","exponent","zero","interpolate","padding","paddingInner","paddingOuter"],n.default=r},{"../../log":113,"../../scale":115,"../../util":124,"./domain":85,"./range":88,"./rules":89,"./type":90}],87:[function(e,t,n){
"use strict";function r(e){return e.channels().reduce(function(t,n){var r=i(e,n);return r&&(t[n]=r),t},{})}function i(e,t){if(!e.scale(t))return null;var r=e.scale(t),i=e.sort(t),s={name:e.scaleName(t+"",!0),type:r.type,domain:o.parseDomain(e,t),range:u.parseRange(r)};return n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES.forEach(function(e){s[e]=r[e]}),i&&"descending"===(a.isSortField(i)?i.order:i)&&(s.reverse=!0),s}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../sort"),o=e("./domain"),u=e("./range");n.default=r,n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=["round","clamp","nice","exponent","interpolate","zero","padding","paddingInner","paddingOuter"],n.parseScale=i},{"../../sort":117,"./domain":85,"./range":88}],88:[function(e,t,n){"use strict";function r(e){if(e.rangeStep)return{step:e.rangeStep};if(e.scheme){var t=e.scheme;if(f.isExtendedScheme(t)){var n={scheme:t.name};return t.count&&(n.count=t.count),t.extent&&(n.extent=t.extent),n}return{scheme:t}}return e.range}function i(e,t,r,i,s,p,m,h,g){for(var v=!1,y=0,b=n.RANGE_PROPERTIES;y<b.length;y++){var _=b[y];if(void 0!==i[_]){var S=f.scaleTypeSupportProperty(t,_),x=f.channelScalePropertyIncompatability(e,_);if(S)if(x)c.warn(x);else switch(_){case"range":return{range:i[_]};case"scheme":return{scheme:i[_]};case"rangeStep":if(void 0===h){var M=i[_];if(null!==M)return{rangeStep:M};v=!0}else c.warn(c.message.rangeStepDropped(e))}else c.warn(c.message.scalePropertyNotWorkWithScaleType(t,_,e))}}switch(e){case l.ROW:return{range:"height"};case l.COLUMN:return{range:"width"};case l.X:case l.Y:if(void 0===h){if(d.contains(["point","band"],t)&&!v)if(e===l.X&&"text"===m){if(s.scale.textXRangeStep)return{rangeStep:s.scale.textXRangeStep}}else if(s.scale.rangeStep)return{rangeStep:s.scale.rangeStep};h=e===l.X?s.cell.width:s.cell.height}return{range:e===l.X?[0,h]:[h,0]};case l.SIZE:return{range:[o(m,p,s),u(m,g,s)]};case l.SHAPE:case l.COLOR:return{range:a(e,t,r,m)};case l.OPACITY:return{range:[s.scale.minOpacity,s.scale.maxOpacity]}}throw new Error("Scale range undefined for channel "+e)}function a(e,t,n,r){switch(e){case l.SHAPE:return"symbol";case l.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===r?"heatmap":"ramp"}}function o(e,t,n){if(t)return 0;switch(e){case"bar":return void 0!==n.scale.minBandSize?n.scale.minBandSize:n.bar.continuousBandSize;case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":if(n.scale.minSize)return n.scale.minSize}throw new Error(c.message.incompatibleChannel("size",e))}function u(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:s(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=s(t,r);return(i-2)*(i-2)}throw new Error(c.message.incompatibleChannel("size",e))}function s(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../log"),l=e("../../channel"),f=e("../../scale"),d=e("../../util");n.parseRange=r,n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.default=i},{"../../channel":44,"../../log":113,"../../scale":115,"../../util":124}],89:[function(e,t,n){"use strict";function r(e,t,n){return d.contains([l.ScaleType.TIME,l.ScaleType.UTC],e)?f.smallestUnit(n.timeUnit):d.contains([c.X,c.Y],t)}function i(e,t,n){if(d.contains([c.X,c.Y],e)&&t===l.ScaleType.POINT)return n.pointPadding}function a(e,t,n){if(void 0===e)return d.contains([c.X,c.Y],t)?n.bandPaddingInner:void 0}function o(e,t,n,r,i){if(void 0===e)return d.contains([c.X,c.Y],t)&&n===l.ScaleType.BAND?void 0!==i.bandPaddingOuter?i.bandPaddingOuter:r/2:void 0}function u(e,t){if(d.contains(["x","y","row","column"],e))return t.round}function s(e,t,n){return"size"===t&&"quantitative"===n.type||!(e.domain||n.bin||!d.contains([c.X,c.Y],t))}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../channel"),l=e("../../scale"),f=e("../../timeunit"),d=e("../../util");n.nice=r,n.padding=i,n.paddingInner=a,n.paddingOuter=o,n.round=u,n.zero=s},{"../../channel":44,"../../scale":115,"../../timeunit":120,"../../util":124}],90:[function(e,t,n){"use strict";function r(e,t,n,r,a,o,l){var f=i(t,n,r,a,o,l);return c.hasScale(t)?void 0!==e?c.supportScaleType(t,e)?u(e,n)?e:(s.warn(s.message.scaleTypeNotWorkWithFieldDef(e,f)),f):(s.warn(s.message.scaleTypeNotWorkWithChannel(t,e,f)),f):f:null}function i(e,t,n,r,i,o){if(m.contains(["row","column"],e))return"band";switch(t.type){case"nominal":return"color"===e||"discrete"===c.rangeType(e)?"ordinal":a(e,n,r,i,o);case"ordinal":return"color"===e?"ordinal":"discrete"===c.rangeType(e)?(s.warn(s.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):a(e,n,r,i,o);case"temporal":return"color"===e?"sequential":"discrete"===c.rangeType(e)?(s.warn(s.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):f.isDiscreteByDefault(t.timeUnit)?a(e,n,r,i,o):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===c.rangeType(e)?(s.warn(s.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin?"bin-linear":"linear"}throw new Error(s.message.invalidFieldType(t.type))}function a(e,t,n,r,i){if(m.contains(["x","y"],e)){if("rect"===t)return"band";if("bar"===t)return o(n,r,i)?"point":"band"}return"point"}function o(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}function u(e,t){var n=t.type;return h.contains([p.Type.ORDINAL,p.Type.NOMINAL],n)?void 0===e||d.hasDiscreteDomain(e):n===p.Type.TEMPORAL?t.timeUnit?h.contains([l.ScaleType.TIME,l.ScaleType.UTC,void 0],e)||d.hasDiscreteDomain(e):h.contains([l.ScaleType.TIME,l.ScaleType.UTC,void 0],e):n!==p.Type.QUANTITATIVE||(t.bin?e===l.ScaleType.BIN_LINEAR||e===l.ScaleType.BIN_ORDINAL:h.contains([l.ScaleType.LOG,l.ScaleType.POW,l.ScaleType.SQRT,l.ScaleType.QUANTILE,l.ScaleType.QUANTIZE,l.ScaleType.LINEAR,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../log"),c=e("../../channel"),l=e("../../scale"),f=e("../../timeunit"),d=e("../../scale"),p=e("../../type"),m=e("../../util"),h=e("../../util");n.default=r,n.fieldDefMatchScaleType=u},{"../../channel":44,"../../log":113,"../../scale":115,"../../timeunit":120,"../../type":123,"../../util":124}],91:[function(e,t,n){"use strict";function r(e){var t=null,n=null;return e.project.forEach(function(e,r){e.encoding===o.X?t=r:e.encoding===o.Y&&(n=r)}),{x:t,y:n}}function i(e,t,n){var r=c.channelSignalName(t,n),i=n===o.X?"width":"height",u=n+"(unit)",s=c.invert.bind(null,e,t,n);return{name:r,value:[],on:l.default.has(t)?[]:a(t,function(e,t){return e.push({events:t.between[0],update:s("["+u+", "+u+"]")}),e.push({events:t,update:"["+r+"[0], "+s("clamp("+u+", 0, "+i+")")+"]"}),e})}}function a(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(u.warn(n+" is not an ordered event stream for interval selections"),e)},[])}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),u=e("../../log"),s=e("../../util"),c=e("./selection"),l=e("./transforms/scales");n.BRUSH="_brush",n.SIZE="_size";var f={predicate:"vlInterval",signals:function(e,t){var r=[],c=[],f=t.name,d=f+n.SIZE;return t.translate&&!l.default.has(t)&&a(t,function(e,t){(t.between[0].filter||(t.between[0].filter=[])).push("!event.item || (event.item && event.item.mark.name !== "+s.stringValue(f+n.BRUSH)+")")}),t.project.forEach(function(n){if(n.encoding!==o.X&&n.encoding!==o.Y)return void u.warn("Interval selections only support x and y encoding channels.");var a=i(e,t,n.encoding);r.push(a),c.push("{field: "+s.stringValue(n.field)+", extent: "+a.name+"}")}),r.push({name:d,value:[],on:a(t,function(e,t){return e.push({events:t.between[0],update:"{x: x(unit), y: y(unit), width: 0, height: 0}"}),e.push({events:t,update:"{x: "+d+".x, y: "+d+".y, width: abs(x(unit) - "+d+".x), height: abs(y(unit) - "+d+".y)}"}),e})},{name:f,update:"["+c.join(", ")+"]"}),r},tupleExpr:function(e,t){return"intervals: "+t.name},modifyExpr:function(e,t){var n=t.name+c.TUPLE;return n+", {unit: "+n+".unit}"},marks:function(e,t,i){var a=t.name,u=r(t),c=u.x,f=u.y;if(l.default.has(t))return i;var d={x:s.extend({},null!==c?{scale:e.scaleName(o.X),signal:a+"["+c+"].extent[0]"}:{value:0}),x2:s.extend({},null!==c?{scale:e.scaleName(o.X),signal:a+"["+c+"].extent[1]"}:{field:{group:"width"}}),y:s.extend({},null!==f?{scale:e.scaleName(o.Y),signal:a+"["+f+"].extent[0]"}:{value:0}),y2:s.extend({},null!==f?{scale:e.scaleName(o.Y),signal:a+"["+f+"].extent[1]"}:{field:{group:"height"}})};return[{name:void 0,type:"rect",encode:{enter:{fill:{value:"#eee"}},update:d}}].concat(i,{name:a+n.BRUSH,type:"rect",encode:{enter:{fill:{value:"transparent"}},update:d}})}};n.default=f,n.projections=r},{"../../channel":44,"../../log":113,"../../util":124,"./selection":93,"./transforms/scales":98}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./selection"),a={predicate:"vlPoint",signals:function(e,t){var n=t.project,i=n.map(function(e){return r.stringValue(e.field)}).join(", "),a=n.map(function(e){return"(item().isVoronoi ? datum.datum : datum)["+r.stringValue(e.field)+"]"}).join(", ");return[{name:t.name,value:{},on:[{events:t.events,update:"{fields: ["+i+"], values: ["+a+"]}"}]}]},tupleExpr:function(e,t){var n=t.name;return"fields: "+n+".fields, values: "+n+".values"},modifyExpr:function(e,t){return t.name+i.TUPLE}};n.default=a},{"../../util":124,"./selection":93}],93:[function(e,t,n){"use strict";function r(e,t){var n={},r=e.config.selection;for(var i in t)!function(i){if(!t.hasOwnProperty(i))return"continue";var a=t[i],o=r[a.type];for(var u in o)"encodings"===u&&a.fields||"fields"===u&&a.encodings||void 0!==a[u]&&!0!==a[u]||(a[u]=o[u]||a[u]);var s=n[i]=m.extend({},a,{name:e.getName(i),events:m.isString(a.on)?p.selector(a.on,"scope"):a.on,domain:"data",resolve:"union"});y.forEachTransform(s,function(t){t.parse&&t.parse(e,a,s)})}(i);return n}function i(e,t){return c(e,function(r,i){var a=r.name,o=i.tupleExpr(e,r),u=i.modifyExpr(e,r);t.push.apply(t,i.signals(e,r)),y.forEachTransform(r,function(n){n.signals&&(t=n.signals(e,r,t)),n.modifyExpr&&(u=n.modifyExpr(e,r,u))}),t.push({name:a+n.TUPLE,on:[{events:{signal:a},update:"{unit: unit.datum && unit.datum._id, "+o+"}"}]},{name:a+n.MODIFY,on:[{events:{signal:a},update:"modify("+m.stringValue(a+n.STORE)+", "+u+")"}]})}),t}function a(e){var t=[{name:"unit",value:{},on:[{events:"mousemove",update:"group()._id ? group() : unit"}]}];return c(e,function(n,r){r.topLevelSignals&&t.push.apply(t,r.topLevelSignals(e,n)),y.forEachTransform(n,function(r){r.topLevelSignals&&(t=r.topLevelSignals(e,n,t))})}),t}function o(e,t){return t.concat(Object.keys(e.component.selection).map(function(e){return{name:e+n.STORE}}))}function u(e,t){var n=!1,r=t;return c(e,function(i,a){r=a.marks?a.marks(e,i,r):r,y.forEachTransform(i,function(a){n=n||a.clippedGroup,a.marks&&(r=a.marks(e,i,t,r))})}),n&&(r=[{type:"group",encode:{enter:{width:{field:{group:"width"}},height:{field:{group:"height"}},fill:{value:"transparent"},clip:{value:!0}}},marks:r.map(e.correctDataNames)}]),r}function s(e,t){var r=m.stringValue(e.name+n.STORE),i=b[e.resolve];return t=t||"datum",l(e).predicate+"("+r+", parent._id, "+t+", "+i+")"}function c(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,l(i))}}function l(e){switch(e.type){case"single":return v.default;case"multi":return g.default;case"interval":return h.default}return null}function f(e,t,n,r){var i=m.stringValue(e.scaleName(n));return"data"===t.domain?"invert("+i+", "+r+")":r}function d(e,t){return e.name+"_"+t}Object.defineProperty(n,"__esModule",{value:!0});var p=e("vega-event-selector"),m=e("../../util"),h=e("./interval"),g=e("./multi"),v=e("./single"),y=e("./transforms/transforms");n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.parseUnitSelection=r,n.assembleUnitSignals=i,n.assembleTopLevelSignals=a,n.assembleUnitData=o,n.assembleUnitMarks=u;var b={single:'"intersect", "all"',independent:'"intersect", "unit"',union:'"union", "all"',union_others:'"union", "others"',intersect:'"intersect", "all"',intersect_others:'"intersect", "others'};n.predicate=s,n.invert=f,n.channelSignalName=d},{"../../util":124,"./interval":91,"./multi":92,"./single":94,"./transforms/transforms":100,"vega-event-selector":39}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./multi"),a=e("./selection"),o={predicate:i.default.predicate,signals:i.default.signals,topLevelSignals:function(e,t){var n=t.name;return[{name:n,update:"data("+r.stringValue(n+a.STORE)+")[0]"}]},tupleExpr:function(e,t){var n=t.name,r=n+".values";return"fields: "+n+".fields, values: "+r+", "+t.project.map(function(e,t){return e.field+": "+r+"["+t+"]"}).join(", ")},modifyExpr:function(e,t){return t.name+a.TUPLE+", true"}};n.default=o},{"../../util":124,"./multi":92,"./selection":93}],95:[function(e,t,n){"use strict";function r(e){return"_"+e.replace(/\W/g,"_")}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../util"),a={has:function(e){return"single"===e.type&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var a=t.name,o=t.project,u=t.bind;return o.forEach(function(e){n.unshift({name:a+r(e.field),value:"",on:[{events:t.events,update:"(item().isVoronoi ? datum.datum : datum)["+i.stringValue(e.field)+"]"}],bind:u[e.field]||u[e.encoding]||u})}),n},signals:function(e,t,n){var a=t.name,o=t.project,u=n.filter(function(e){return e.name===a})[0],s=o.map(function(e){return i.stringValue(e.field)}).join(", "),c=o.map(function(e){return a+r(e.field)}).join(", ");return u.update="{fields: ["+s+"], values: ["+c+"]}",delete u.value,delete u.on,n}};n.default=a},{"../../../util":124}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={has:function(e){return void 0!==e.nearest&&!1!==e.nearest},marks:function(e,t,n,r){var i=n[0],a=r.indexOf(i),o=i.name===e.getName("pathgroup"),u=function(e){return e.name&&e.name.indexOf("voronoi")>=0},s={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:"datum.x",y:"datum.y",size:[{signal:"width"},{signal:"height"}]}]};return o&&!i.marks.filter(u).length?(i.marks.push(s),r.splice(a,1,i)):o||r.filter(u).length||r.splice(a+1,0,s),r}};n.default=r},{}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={has:function(e){return void 0!==e.fields||void 0!==e.encodings},parse:function(e,t,n){var r={};(t.fields||[]).forEach(function(e){return r[e]=null}),(t.encodings||[]).forEach(function(t){return r[e.field(t)]=t});var i=n.project||(n.project=[]);for(var a in r)r.hasOwnProperty(a)&&i.push({field:a,encoding:r[a]})}};n.default=r},{}],98:[function(e,t,n){"use strict";function r(e,t){return"domain("+o.stringValue(e.scaleName(t))+")"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../log"),a=e("../../../scale"),o=e("../../../util"),u=e("../interval"),s=e("../selection"),c={clippedGroup:!0,has:function(e){return"interval"===e.type&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var r=e.component.scales,o=n.scales=[];n.project.forEach(function(e){var t=e.encoding,u=r[t];if(!u||!a.hasContinuousDomain(u.type))return void i.warn("Scale bindings are currently only supported for scales with continuous domains.");u.domainRaw={signal:s.channelSignalName(n,t)},o.push(t)})},topLevelSignals:function(e,t,n){return n.concat(t.scales.map(function(e){return{name:s.channelSignalName(t,e)}}))},signals:function(e,t,n){var r=t.name;return n=n.filter(function(e){return e.name!==r+u.SIZE&&e.name!==r+s.TUPLE&&e.name!==s.MODIFY}),t.scales.forEach(function(e){var t=n.filter(function(t){return t.name===r+"_"+e})[0];t.push="outer",delete t.value,delete t.update}),n}};n.default=c,n.domain=r},{"../../../log":113,"../../../scale":115,"../../../util":124,"../interval":91,"../selection":93}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../selection"),i={has:function(e){return void 0!==e.toggle&&!1!==e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var i=t.name+r.TUPLE,a=t.name+"_toggle";return a+" ? null : "+i+", "+a+" ? null : true, "+a+" ? "+i+" : null"}};n.default=i},{"../selection":93}],100:[function(e,t,n){"use strict";function r(e,t){for(var n in f)f[n].has(e)&&t(f[n])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./inputs"),a=e("./nearest"),o=e("./project"),u=e("./scales"),s=e("./toggle"),c=e("./translate"),l=e("./zoom"),f={project:o.default,toggle:s.default,scales:u.default,translate:c.default,zoom:l.default,inputs:i.default,nearest:a.default};n.forEachTransform=r},{"./inputs":95,"./nearest":96,"./project":97,"./scales":98,"./toggle":99,"./translate":101,"./zoom":102}],101:[function(e,t,n){"use strict";function r(e,t){var n=t===o.X?"+":"-";return c.default.has(e)&&(n="+"===n?"-":"+"),n}function i(e,t,n,i,a){var s=t.name,d=a.filter(function(e){return e.name===s+"_"+n})[0],p=s+l,m=s+f,h=u.stringValue(e.scaleName(n)),g=".extent_"+n,v=r(t,n),y=v+" abs(span("+p+g+")) * "+m+"."+n+" / "+p+"."+i,b="["+p+g+"[0] "+y+", "+p+g+"[1] "+y+"]",_="invert("+h+(n===o.X?", 0":", unit."+i)+")",S="invert("+h+(n===o.X?", unit."+i:", 0")+")";d.on.push({events:{signal:m},update:c.default.has(t)?b:"clampRange("+b+", "+_+", "+S+")"})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-event-selector"),o=e("../../../channel"),u=e("../../../util"),s=e("../interval"),c=e("./scales"),l="_translate_anchor",f="_translate_delta",d={has:function(e){return"interval"===e.type&&void 0!==e.translate&&!1!==e.translate},signals:function(e,t,n){var r=t.name,u=c.default.has(t),d=u?"unit":r+s.SIZE,p=r+l,m=s.projections(t),h=m.x,g=m.y,v=a.selector(t.translate,"scope");return u||(v=v.map(function(e){return e.between[0].markname=r+s.BRUSH,e})),n.push({name:p,value:{},on:[{events:v.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit), width: "+d+".width, height: "+d+".height, "+(null!==h?"extent_x: "+(u?c.domain(e,o.X):"slice("+r+"_x)")+", ":"")+(null!==g?"extent_y: "+(u?c.domain(e,o.Y):"slice("+r+"_y)")+", ":"")+"}"}]},{name:r+f,value:{},on:[{events:v,update:"{x: x(unit) - "+p+".x, y: y(unit) - "+p+".y}"}]}),null!==h&&i(e,t,o.X,"width",n),null!==g&&i(e,t,o.Y,"height",n),n}};n.default=d},{"../../../channel":44,"../../../util":124,"../interval":91,"./scales":98,"vega-event-selector":39}],102:[function(e,t,n){"use strict";function r(e,t,n,r,i){var u=t.name,f=i.filter(function(e){return e.name===u+"_"+n})[0],d=s.default.has(t),p=d?s.domain(e,n):f.name,m=""+u+c+"."+n,h=u+l,g=o.stringValue(e.scaleName(n)),v="["+m+" + ("+p+"[0] - "+m+") * "+h+", "+m+" + ("+p+"[1] - "+m+") * "+h+"]",y="invert("+g+(n===a.X?", 0":", unit."+r)+")",b="invert("+g+(n===a.X?", unit."+r:", 0")+")";f.on.push({events:{signal:h},update:d?v:"clampRange("+v+", "+y+", "+b+")"})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-event-selector"),a=e("../../../channel"),o=e("../../../util"),u=e("../interval"),s=e("./scales"),c="_zoom_anchor",l="_zoom_delta",f={has:function(e){return"interval"===e.type&&void 0!==e.zoom&&!1!==e.zoom},signals:function(e,t,n){var f=t.name,d=f+l,p=u.projections(t),m=p.x,h=p.y,g=o.stringValue(e.scaleName(a.X)),v=o.stringValue(e.scaleName(a.Y)),y=i.selector(t.zoom,"scope");s.default.has(t)||(y=y.map(function(e){return e.markname=f+u.BRUSH,e})),n.push({name:f+c,on:[{events:y,update:"{x: invert("+g+", x(unit)), y: invert("+v+", y(unit))}"}]},{name:d,on:[{events:y,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==m&&r(e,t,"x","width",n),null!==h&&r(e,t,"y","height",n);var b=n.filter(function(e){return e.name===f+u.SIZE});if(b.length){var _=b[0].name;b[0].on.push({events:{signal:d},update:"{x: "+_+".x, y: "+_+".y, width: "+_+".width * "+d+" , height: "+_+".height * "+d+"}"})}return n}};n.default=f},{"../../../channel":44,"../../../util":124,"../interval":91,"./scales":98,"vega-event-selector":39}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),i=e("../channel"),a=e("../encoding"),o=e("../encoding"),u=e("../fielddef"),s=e("../mark"),c=e("../scale"),l=e("../stack"),f=e("../util"),d=e("./axis/parse"),p=e("./common"),m=e("./data/assemble"),h=e("./data/parse"),g=e("./layout"),v=e("./legend/parse"),y=e("./mark/init"),b=e("./mark/mark"),_=e("./model"),S=e("./scale/init"),x=e("./scale/parse"),M=e("./selection/selection"),E=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i)||this;o.selection={},o.scales={},o.axes={},o.legends={},o.children=[],o.initFacetCellConfig();var u=void 0!==t.width?t.width:n?n.width:void 0,c=void 0!==t.height?t.height:n?n.height:void 0,f=s.isMarkDef(t.mark)?t.mark.type:t.mark,d=o.encoding=a.normalizeEncoding(t.encoding||{},f);o.stack=l.stack(f,d,o.config.stack),o.scales=o.initScales(f,d,u,c),o.markDef=y.initMarkDef(t.mark,d,o.scales,o.config),o.encoding=y.initEncoding(f,d,o.stack,o.config),o.axes=o.initAxes(d),o.legends=o.initLegend(d),o.selection=t.selection;var p=o.initSize(f,o.scales,u,c),m=p.width,h=void 0===m?o.width:m,g=p.height,v=void 0===g?o.height:g;return o.width=h,o.height=v,o}return r.__extends(t,e),t.prototype.initFacetCellConfig=function(){for(var e=this.config,t=this.parent,n=!1;null!==t;){if(t.isFacet()){n=!0;break}t=t.parent}n&&(e.cell=f.extend({},e.cell,e.facet.cell))},t.prototype.initScales=function(e,t,n,r){var a=this,u=[];return i.UNIT_SCALE_CHANNELS.reduce(function(s,c){if(o.channelHasField(t,c)||c===i.X&&o.channelHasField(t,i.X2)||c===i.Y&&o.channelHasField(t,i.Y2)){var l=s[c]=S.default(c,t[c],a.config,e,c===i.X?n:c===i.Y?r:void 0,u);c!==i.X&&c!==i.Y||l.rangeStep&&u.push(l.rangeStep)}return s},{})},t.prototype.initSize=function(e,t,n,r){var a=this.config.cell,o=this.config.scale;if(void 0===n)if(t[i.X])c.hasDiscreteDomain(t[i.X].type)&&t[i.X].rangeStep||(n=a.width);else if(e===s.TEXT)n=o.textXRangeStep;else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");n=o.rangeStep}if(void 0===r)if(t[i.Y])c.hasDiscreteDomain(t[i.Y].type)&&t[i.Y].rangeStep||(r=a.height);else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");r=o.rangeStep}return{width:n,height:r}},t.prototype.initAxes=function(e){return[i.X,i.Y].reduce(function(t,n){var a=e[n];if(u.isFieldDef(a)||n===i.X&&u.isFieldDef(e.x2)||n===i.Y&&u.isFieldDef(e.y2)){var o=u.isFieldDef(a)?a.axis:null;null!==o&&!1!==o&&(t[n]=r.__assign({},o))}return t},{})},t.prototype.initLegend=function(e){return i.NONSPATIAL_SCALE_CHANNELS.reduce(function(t,n){var i=e[n];if(u.isFieldDef(i)){var a=i.legend;null!==a&&!1!==a&&(t[n]=r.__assign({},a))}return t},{})},t.prototype.parseData=function(){this.component.data=h.parseData(this)},t.prototype.parseSelection=function(){this.component.selection=M.parseUnitSelection(this,this.selection)},t.prototype.parseLayoutData=function(){this.component.layout=g.parseUnitLayout(this)},t.prototype.parseScale=function(){this.component.scales=x.default(this)},t.prototype.parseMark=function(){this.component.mark=b.parseMark(this)},t.prototype.parseAxis=function(){this.component.axes=d.parseAxisComponent(this,[i.X,i.Y])},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){this.component.legends=v.parseLegendComponent(this)},t.prototype.assembleData=function(){return this.parent?[]:m.assembleData(f.vals(this.component.data.sources))},t.prototype.assembleSignals=function(e){return M.assembleUnitSignals(this,e)},t.prototype.assembleSelectionData=function(e){return M.assembleUnitData(this,e)},t.prototype.assembleLayout=function(e){return g.assembleLayout(this,e)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return e=M.assembleUnitMarks(this,e),e.map(this.correctDataNames)},t.prototype.assembleParentGroupProperties=function(e){return p.applyConfig({},e,s.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.channels=function(){return i.UNIT_CHANNELS},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,r=f.duplicate(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=f.duplicate(this.config)),t||(n.data=f.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return o.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){return this.encoding[e]||{}},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=f.extend({binSuffix:c.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),u.field(n,t)},t.prototype.isUnit=function(){return!0},t}(_.Model);n.UnitModel=E},{"../channel":44,"../encoding":108,"../fielddef":110,"../mark":114,"../scale":115,"../stack":119,"../util":124,"./axis/parse":46,"./common":48,"./data/assemble":51,"./data/parse":59,"./layout":67,"./legend/parse":69,"./mark/init":73,"./mark/mark":75,"./model":83,"./scale/init":86,"./scale/parse":87,"./selection/selection":93,tslib:38}],104:[function(e,t,n){"use strict";function r(e,t){s[e]=t}function i(e){delete s[e]}function a(e){var t=u.isMarkDef(e.mark)?e.mark.type:e.mark,n=s[t];if(n)return n(e);throw new Error("Unregistered composite mark "+t)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),u=e("./mark");n.ERRORBAR="error-bar";var s={};n.add=r,n.remove=i,n.normalize=a,r(n.ERRORBAR,function(e){var t=(e.mark,e.encoding),n=o.__rest(e,["mark","encoding"]),r=(t.size,o.__rest(t,["size"])),i=(t.x2,t.y2,o.__rest(t,["x2","y2"])),a=(i.x,i.y,o.__rest(i,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return o.__assign({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:i},{mark:"tick",encoding:t.x2?o.__assign({x:t.x2,y:t.y},a):o.__assign({x:t.x,y:t.y2},a)}]})})},{"./mark":114,tslib:38}],105:[function(e,t,n){"use strict";function r(e){return s.mergeDeep(s.duplicate(n.defaultConfig),e)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./legend"),a=e("./mark"),o=e("./scale"),u=e("./selection"),s=e("./util");n.defaultCellConfig={width:200,height:200,fill:"transparent"},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1};var c={color:"#000000",opacity:.4,offset:0};n.defaultFacetConfig={axis:{},grid:c,cell:n.defaultFacetCellConfig},n.defaultOverlayConfig={line:!1},n.defaultConfig={padding:5,numberFormat:"s",timeFormat:"%b %d, %Y",countTitle:"Number of Records",cell:n.defaultCellConfig,mark:a.defaultMarkConfig,area:{},bar:a.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{},square:{},text:a.defaultTextConfig,tick:a.defaultTickConfig,overlay:n.defaultOverlayConfig,scale:o.defaultScaleConfig,axis:{},axisX:{},axisY:{},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:i.defaultLegendConfig,facet:n.defaultFacetConfig,selection:u.defaultConfig},n.initConfig=r},{"./legend":112,"./mark":114,"./scale":115,"./selection":116,"./util":124}],106:[function(e,t,n){"use strict";function r(e){return!!e.url}function i(e){return!!e.values}function a(e){return!!e.name}Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=r,n.isInlineData=i,n.isNamedData=a,n.MAIN="main",n.RAW="raw",n.LAYOUT="layout"},{}],107:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(l.isNumber(e))return e>4&&c.warn(c.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(c.message.invalidTimeUnit("quarter",e))}function a(e){if(l.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(-1!==r)return r+"";var i=t.substr(0,3),a=n.SHORT_MONTHS.indexOf(i);if(-1!==a)return a+"";throw new Error(c.message.invalidTimeUnit("month",e))}function o(e){if(l.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(-1!==r)return r+"";var i=t.substr(0,3),a=n.SHORT_DAYS.indexOf(i);if(-1!==a)return a+"";throw new Error(c.message.invalidTimeUnit("day",e))}function u(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(l.keys(e).length>1)c.warn(c.message.droppedDay(e)),e=l.duplicate(e),delete e.day;else{n.setFullYear(f);var r=t?o(e.day):e.day;n.setDate(+r+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.setMonth(3*+u)}if(void 0!==e.month){var s=t?a(e.month):e.month;n.setMonth(+s)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function s(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&l.keys(e).length>1&&(c.warn(c.message.droppedDay(e)),e=l.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(f):n.push(0),void 0!==e.month){var r=t?a(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.push(u+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var s=t?o(e.day):e.day;n.push(s+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./log"),l=e("./util"),f=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=u,n.dateTimeExpr=s},{"./log":113,"./util":124}],108:[function(e,t,n){"use strict";function r(e,t){var n=e&&e[t];return!!n&&(p.isArray(n)?p.some(n,function(e){return!!e.field}):f.isFieldDef(n))}function i(e){return p.some(l.CHANNELS,function(t){if(r(e,t)){var n=e[t];return p.isArray(n)?p.some(n,function(e){return!!e.aggregate}):f.isFieldDef(n)&&!!n.aggregate}return!1})}function a(e,t){return Object.keys(e).reduce(function(n,r){if(!l.supportMark(r,t))return d.warn(d.message.incompatibleChannel(r,t)),n;if("size"===r&&"line"===t){var i=e[r];if(f.isFieldDef(i)&&i.aggregate)return d.warn(d.message.incompatibleChannel(r,t,"when the field is aggregated.")),n}if(p.isArray(e[r]))n[r]=e[r].reduce(function(e,t){return f.isFieldDef(t)||f.isValueDef(t)?e.push(f.normalize(t,r)):d.warn(d.message.emptyFieldDef(t,r)),e},[]);else{var i=e[r];if(!f.isFieldDef(i)&&!f.isValueDef(i))return d.warn(d.message.emptyFieldDef(i,r)),n;n[r]=f.normalize(i,r)}return n},{})}function o(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function u(e){var t=[];return l.CHANNELS.forEach(function(n){if(r(e,n)){var i=e[n];(p.isArray(i)?i:[i]).forEach(function(e){t.push(e)})}}),t}function s(e,t,n){e&&Object.keys(e).forEach(function(r){var i=r;p.isArray(e[i])?e[i].forEach(function(e){t.call(n,e,i)}):t.call(n,e[i],i)})}function c(e,t,n,r){return e?Object.keys(e).reduce(function(n,i){var a=i;return p.isArray(e[a])?e[a].reduce(function(e,n){return t.call(r,e,n,a)},n):t.call(r,n,e[a],a)},n):n}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./channel"),f=e("./fielddef"),d=e("./log"),p=e("./util");n.channelHasField=r,n.isAggregate=i,n.normalizeEncoding=a,n.isRanged=o,n.fieldDefs=u,n.forEach=s,n.reduce=c},{"./channel":44,"./fielddef":110,"./log":113,"./util":124}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],110:[function(e,t,n){
"use strict";function r(e){return!(!e||!e.field&&"count"!==e.aggregate)}function i(e){return e&&"value"in e&&void 0!==e.value}function a(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(s(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=h.binToString(e.bin),i=t.binSuffix):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.datum&&(n='datum["'+n+'"]'),n}function o(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return y.isDiscreteByDefault(e.timeUnit)}throw new Error(v.message.invalidFieldType(e.type))}function u(e){return!o(e)}function s(e){return"count"===e.aggregate}function c(e,t){if(null!=e.title)return e.title;if(s(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function l(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(g.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function f(e,t){if(r(e)){var n=e;if(n.aggregate&&!m.AGGREGATE_OP_INDEX[n.aggregate]){var i=(n.aggregate,p.__rest(n,["aggregate"]));v.warn(v.message.invalidAggregate(n.aggregate)),n=i}if(n.bin){var a=n.bin;_.isBoolean(a)?n=p.__assign({},n,{bin:{maxbins:h.autoMaxBins(t)}}):a.maxbins||a.step||(n=p.__assign({},n,{bin:p.__assign({},a,{maxbins:h.autoMaxBins(t)})}))}if(n.type){var o=b.getFullName(n.type);n.type!==o&&(n=p.__assign({},n,{type:o}))}else{var u=l(n,t);v.warn(v.message.emptyOrInvalidFieldType(n.type,t,u)),n=p.__assign({},n,{type:u})}var s=d(n,t),c=s.compatible,f=s.warning;return c||v.warn(f),n}return e}function d(e,t){switch(t){case"row":case"column":return u(e)&&!e.timeUnit?{compatible:!1,warning:v.message.facetChannelShouldBeDiscrete(t)}:S;case"x":case"y":case"color":case"text":case"detail":return S;case"opacity":case"size":case"x2":case"y2":return o(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:S;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:S;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:S}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var p=e("tslib"),m=e("./aggregate"),h=e("./bin"),g=e("./channel"),v=e("./log"),y=e("./timeunit"),b=e("./type"),_=e("./util");n.isFieldDef=r,n.isValueDef=i,n.field=a,n.isDiscrete=o,n.isContinuous=u,n.isCount=s,n.title=c,n.defaultType=l,n.normalize=f;var S={compatible:!0};n.channelCompatibility=d},{"./aggregate":41,"./bin":43,"./channel":44,"./log":113,"./timeunit":120,"./type":123,"./util":124,tslib:38}],111:[function(e,t,n){"use strict";function r(e){return e&&!!e.field&&void 0!==e.equal}function i(e){return!!(e&&e.field&&f.isArray(e.range)&&2===e.range.length)}function a(e){return e&&!!e.field&&(f.isArray(e.oneOf)||f.isArray(e.in))}function o(e){if(f.isArray(e))return"("+e.map(function(e){return o(e)}).filter(function(e){return void 0!==e}).join(") && (")+")";if(f.isString(e))return e;var t=e.timeUnit?"time("+l.fieldExpr(e.timeUnit,e.field)+")":c.field(e,{datum:!0});if(r(e))return t+"==="+u(e.equal,e.timeUnit);if(a(e)){return"indexof(["+(e.oneOf||e.in).map(function(t){return u(t,e.timeUnit)}).join(",")+"], "+t+") !== -1"}if(i(e)){var n=e.range[0],s=e.range[1];if(null!==n&&null!==s)return"inrange("+t+", "+u(n,e.timeUnit)+", "+u(s,e.timeUnit)+")";if(null!==n)return t+" >= "+n;if(null!==s)return t+" <= "+s}}function u(e,t){if(s.isDateTime(e)){var n=s.dateTimeExpr(e,!0);return"time("+n+")"}if(l.isSingleTimeUnit(t)){var r={};r[t]=e;var n=s.dateTimeExpr(r,!0);return"time("+n+")"}return JSON.stringify(e)}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./datetime"),c=e("./fielddef"),l=e("./timeunit"),f=e("./util");n.isEqualFilter=r,n.isRangeFilter=i,n.isOneOfFilter=a,n.expression=o},{"./datetime":107,"./fielddef":110,"./timeunit":120,"./util":124}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],113:[function(e,t,n){"use strict";function r(e){e(d=new p),o()}function i(e){return function(){var t=d=new p;e(t),o()}}function a(e){return d=e}function o(){return d=f}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.warn.apply(d,arguments)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.info.apply(d,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.debug.apply(d,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),f=l.logger(l.Warn),d=f,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=r,n.wrap=i,n.set=a,n.reset=o,n.warn=u,n.info=s,n.debug=c;!function(e){function t(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."}function n(e){return'Invalid field type "'+e+'"'}function r(e){return'Invalid aggregation operator "'+e+'"'}function i(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function a(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function o(e,t,n){return e+" dropped as it is incompatible with "+t+n?"when "+n:""}function u(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function s(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function c(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function l(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function f(e,t){return"Specified orient "+e+" overridden with "+t}function d(e){return"Cannot use "+e+" with non-color channel."}function p(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function m(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function h(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function g(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function v(e){return"rangeStep for "+e+" is dropped as top-level "+("x"===e?"width":"height")+" is provided."}function y(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function b(e,t){return"FieldDef does not work with "+e+" scale. We are using "+t+" scale instead."}function _(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function S(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function x(e){return"Cannot stack "+e+" if there is already "+e+"2"}function M(e){return"Cannot stack non-linear scale ("+e+")"}function E(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function w(e,t){return"Invalid "+e+": "+t}function O(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+(e+"").replace("day","date")+"."}function N(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.invalidTransformIgnored=t,e.invalidFieldType=n,e.invalidAggregate=r,e.emptyOrInvalidFieldType=i,e.emptyFieldDef=a,e.incompatibleChannel=o,e.facetChannelShouldBeDiscrete=u,e.discreteChannelCannotEncode=s,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=c,e.unclearOrientDiscreteOrEmpty=l,e.orientOverridden=f,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=d,e.unaggregateDomainHasNoEffectForRawField=p,e.unaggregateDomainWithNonSharedDomainOp=m,e.unaggregatedDomainWithLogScale=h,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=g,e.rangeStepDropped=v,e.scaleTypeNotWorkWithChannel=y,e.scaleTypeNotWorkWithFieldDef=b,e.scalePropertyNotWorkWithScaleType=_,e.scaleTypeNotWorkWithMark=S,e.INVAID_DOMAIN="Invalid scale domain",e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=x,e.cannotStackNonLinearScale=M,e.cannotStackNonSummativeAggregate=E,e.invalidTimeUnit=w,e.dayReplacedWithDate=O,e.droppedDay=N}(n.message||(n.message={}))},{"vega-util":128}],114:[function(e,t,n){"use strict";function r(e){return e.type}function i(e){return(r(e)?e.type:e)in u}Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(a=n.Mark||(n.Mark={})),n.AREA=a.AREA,n.BAR=a.BAR,n.LINE=a.LINE,n.POINT=a.POINT,n.TEXT=a.TEXT,n.TICK=a.TICK,n.RECT=a.RECT,n.RULE=a.RULE,n.CIRCLE=a.CIRCLE,n.SQUARE=a.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=r;var u=o.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=i,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={baseline:"middle"},n.defaultTickConfig={thickness:1}},{"./util":124}],115:[function(e,t,n){"use strict";function r(e){return e in m}function i(e){return e in h}function a(e){return e in p}function o(e){return e in d}function u(e){return e&&!!e.name}function s(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return f.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return o(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return f.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return o(e)||"sequential"===e;case"nice":return o(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return"bin-ordinal"===e||!r(e)&&!f.contains(["log","time","utc","bin-linear"],e)}throw new Error("Invalid scale property "+t+".")}function c(e,t){switch(t){case"range":if("x"===e||"y"===e)return l.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return l.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return l.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return l.message.CANNOT_USE_PADDING_WITH_FACET;return;case"interpolate":case"scheme":if("color"!==e)return l.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".')}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./log"),f=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","bin-linear","log","pow","sqrt","time","utc","sequential","ordinal","bin-ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var d=f.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var p=f.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var m=f.toSet(n.DISCRETE_DOMAIN_SCALES),h=f.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=r,n.isBinScale=i,n.hasContinuousDomain=a,n.isContinuousToContinuous=o,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=u,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=s,n.channelScalePropertyIncompatability=c},{"./log":113,"./util":124}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultConfig={single:{on:"click",fields:["_id"]},multi:{on:"click",fields:["_id"],toggle:"event.shiftKey"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel"}}},{}],117:[function(e,t,n){"use strict";function r(e){return!!e&&!!e.field&&!!e.op}Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=r},{}],118:[function(e,t,n){"use strict";function r(e){return void 0!==e.facet}function i(e){return!!e.mark}function a(e){return void 0!==e.layer}function o(e){if(r(e))return s(e,e.config);if(a(e))return c(e,e.config);if(i(e)){var t=S.channelHasField(e.encoding,x.ROW),n=S.channelHasField(e.encoding,x.COLUMN);return t||n?l(e,e.config):d(e,e.config)}throw new Error(E.message.INVALID_SPEC)}function u(e,t){return a(e)?c(e,t):d(e,t)}function s(e,t){var n=e.spec,r=b.__rest(e,["spec"]);return b.__assign({},r,{spec:u(n,t)})}function c(e,t){var n=e.layer,r=b.__rest(e,["layer"]);return b.__assign({},r,{layer:n.map(function(e){return u(e,t)})})}function l(e,t){var n=e.encoding,r=n.row,i=n.column,a=b.__rest(n,["row","column"]),o=e.mark,u=(e.encoding,b.__rest(e,["mark","encoding"]));return b.__assign({},u,{facet:b.__assign({},r?{row:r}:{},i?{column:i}:{}),spec:d({mark:o,encoding:a},t)})}function f(e){return w.isPrimitiveMark(e.mark)}function d(e,t){if(f(e)){if(S.isRanged(e.encoding))return p(e);var n=t&&t.overlay,r=n&&e.mark===w.AREA&&N.contains(["linepoint","line"],n.area),i=n&&(n.line&&e.mark===w.LINE||"linepoint"===n.area&&e.mark===w.AREA);return i||r?m(e,i,r,t):e}return _.normalize(e)}function p(e){var t=S.channelHasField(e.encoding,x.X),n=S.channelHasField(e.encoding,x.Y),r=S.channelHasField(e.encoding,x.X2),i=S.channelHasField(e.encoding,x.Y2);if(r&&!t||i&&!n){var a=N.duplicate(e);return r&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),i&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}function m(e,t,n,r){var i=e.mark,a=e.encoding,o=b.__rest(e,["mark","encoding"]),u=[{mark:i,encoding:a}],s=O.stack(i,a,r?r.stack:void 0),c=a;if(s){var l=s.fieldChannel,f=s.offset;c=b.__assign({},a,(d={},d[l]=b.__assign({},a[l],f?{stack:f}:{}),d))}return n&&u.push({mark:{type:"line",role:"lineOverlay"},encoding:c}),t&&u.push({mark:{type:"point",filled:!0,role:"pointOverlay"},encoding:c}),b.__assign({},o,{layer:u});var d}function h(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),r=N.hash(n);e[r]=e[r]||t}),e}function g(e,t){return void 0===t&&(t={}),a(e)?e.layer.forEach(function(e){i(e)?h(t,M.fieldDefs(e.encoding)):g(e,t)}):r(e)?(h(t,M.fieldDefs(e.facet)),g(e.spec,t)):h(t,M.fieldDefs(e.encoding)),t}function v(e){return N.vals(g(e))}function y(e,t){return t=t||e.config,!!w.isPrimitiveMark(e.mark)&&null!==O.stack(e.mark,e.encoding,t?t.stack:void 0)}Object.defineProperty(n,"__esModule",{value:!0});var b=e("tslib"),_=e("./compositemark"),S=e("./encoding"),x=e("./channel"),M=e("./encoding"),E=e("./log"),w=e("./mark"),O=e("./stack"),N=e("./util");n.isFacetSpec=r,n.isUnitSpec=i,n.isLayerSpec=a,n.normalize=o,n.fieldDefs=v,n.isStacked=y},{"./channel":44,"./compositemark":104,"./encoding":108,"./log":113,"./mark":114,"./stack":119,"./util":124,tslib:38}],119:[function(e,t,n){"use strict";function r(e,t,r){var d=c.isMarkDef(e)?e.type:e;if(!f.contains(n.STACKABLE_MARKS,d))return null;if(!u.isAggregate(t))return null;var p=o.STACK_GROUP_CHANNELS.reduce(function(e,n){if(u.channelHasField(t,n)){var r=t[n];(f.isArray(r)?r:[r]).forEach(function(t){s.isFieldDef(t)&&!t.aggregate&&e.push({channel:n,fieldDef:t})})}return e},[]);if(0===p.length)return null;var m=s.isFieldDef(t.x),h=s.isFieldDef(t.y),g=s.isFieldDef(t.x)&&!!t.x.aggregate;if(g!==(s.isFieldDef(t.y)&&!!t.y.aggregate)){var v=g?o.X:o.Y,y=t[v],b=y.aggregate,_=y.scale,S=null;return S=void 0!==y.stack?y.stack:f.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===r?"zero":r,S&&"none"!==S?_&&_.type&&_.type!==l.ScaleType.LINEAR?(i.warn(i.message.cannotStackNonLinearScale(_.type)),null):u.channelHasField(t,v===o.X?o.X2:o.Y2)?(i.warn(i.message.cannotStackRangedMark(v)),null):f.contains(a.SUM_OPS,b)?{groupbyChannel:g?h?o.Y:null:m?o.X:null,fieldChannel:v,stackBy:p,offset:S}:(i.warn(i.message.cannotStackNonSummativeAggregate(b)),null):null}return null}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./log"),a=e("./aggregate"),o=e("./channel"),u=e("./encoding"),s=e("./fielddef"),c=e("./mark"),l=e("./scale"),f=e("./util");n.STACKABLE_MARKS=[c.BAR,c.AREA,c.RULE,c.POINT,c.CIRCLE,c.SQUARE,c.LINE,c.TEXT,c.TICK],n.STACK_BY_DEFAULT_MARKS=[c.BAR,c.AREA],n.stack=r},{"./aggregate":41,"./channel":44,"./encoding":108,"./fielddef":110,"./log":113,"./mark":114,"./scale":115,"./util":124}],120:[function(e,t,n){"use strict";function r(e){return!!h[e]}function i(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case f.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case f.YEAR:r.setFullYear(t.getFullYear());break;case f.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case f.MONTH:r.setMonth(t.getMonth());break;case f.DATE:r.setDate(t.getDate());break;case f.HOURS:r.setHours(t.getHours());break;case f.MINUTES:r.setMinutes(t.getMinutes());break;case f.SECONDS:r.setSeconds(t.getSeconds());break;case f.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function a(e){return!!g[e]}function o(e,t){var n=e.indexOf(t);return n>-1&&(t!==f.SECONDS||0===n||"i"!==e.charAt(n-1))}function u(e,t){function r(e){return e===f.QUARTER?"(quarter("+i+")-1)":e+"("+i+")"}var i='datum["'+t+'"]',a=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=r(n)),t},{});return a.day&&m.keys(a).length>1&&(p.warn(p.message.dayReplacedWithDate(e)),delete a.day,a.date=r(f.DATE)),d.dateTimeExpr(a)}function s(e){if(e)return o(e,f.SECONDS)?"second":o(e,f.MINUTES)?"minute":o(e,f.HOURS)?"hour":o(e,f.DAY)||o(e,f.DATE)?"day":o(e,f.MONTH)?"month":o(e,f.YEAR)?"year":void 0}function c(e,t,n){if(e){var r=[],i="",a=o(e,f.YEAR);o(e,f.QUARTER)&&(i="'Q' + quarter("+t+")"),o(e,f.MONTH)&&r.push(!1!==n?"%b":"%B"),o(e,f.DAY)?r.push(n?"%a":"%A"):o(e,f.DATE)&&r.push("%d"+(a?",":"")),a&&r.push(n?"%y":"%Y");var u=[];o(e,f.HOURS)&&u.push("%H"),o(e,f.MINUTES)&&u.push("%M"),o(e,f.SECONDS)&&u.push("%S"),o(e,f.MILLISECONDS)&&u.push("%L");var s=[];return r.length>0&&s.push(r.join(" ")),u.length>0&&s.push(u.join(":")),s.length>0&&(i&&(i+=" + ' ' + "),i+="timeFormat("+t+", '"+s.join(" ")+"')"),i||void 0}}function l(e){switch(e){case"hours":case"day":case"month":case"quarter":return!0}return!1}Object.defineProperty(n,"__esModule",{value:!0});var f,d=e("./datetime"),p=e("./log"),m=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(f=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[f.YEAR,f.QUARTER,f.MONTH,f.DAY,f.DATE,f.HOURS,f.MINUTES,f.SECONDS,f.MILLISECONDS];var h=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=i,n.MULTI_TIMEUNITS=[f.YEARQUARTER,f.YEARQUARTERMONTH,f.YEARMONTH,f.YEARMONTHDATE,f.YEARMONTHDATEHOURS,f.YEARMONTHDATEHOURSMINUTES,f.YEARMONTHDATEHOURSMINUTESSECONDS,f.QUARTERMONTH,f.HOURSMINUTES,f.HOURSMINUTESSECONDS,f.MINUTESSECONDS,f.SECONDSMILLISECONDS];var g=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=a,n.TIMEUNITS=[f.YEAR,f.QUARTER,f.MONTH,f.DAY,f.DATE,f.HOURS,f.MINUTES,f.SECONDS,f.MILLISECONDS,f.YEARQUARTER,f.YEARQUARTERMONTH,f.YEARMONTH,f.YEARMONTHDATE,f.YEARMONTHDATEHOURS,f.YEARMONTHDATEHOURSMINUTES,f.YEARMONTHDATEHOURSMINUTESSECONDS,f.QUARTERMONTH,f.HOURSMINUTES,f.HOURSMINUTESSECONDS,f.MINUTESSECONDS,f.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=u,n.smallestUnit=s,n.formatExpression=c,n.isDiscreteByDefault=l},{"./datetime":107,"./log":113,"./util":124}],121:[function(e,t,n){"use strict";function r(e){return i.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}Object.defineProperty(n,"__esModule",{value:!0});var i=["background","padding"];n.extractTopLevelProperties=r},{}],122:[function(e,t,n){"use strict";function r(e){return void 0!==e.filter}function i(e){return void 0!==e.calculate}Object.defineProperty(n,"__esModule",{value:!0}),n.isFilter=r,n.isCalculate=i},{}],123:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={})),n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=r},{}],124:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=b(e);return t.forEach(function(e){delete n[e]}),n}function a(e){return E.isString(e)||E.isNumber(e)||_(e)?String(e):x(e)}function o(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!o(t,e)})}function s(e,t){return e.concat(u(t,e))}function c(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function f(e){return[].concat.apply([],e)}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=p(e,i[r])}return e}function p(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||E.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=d(t[n].constructor===Array?[]:{},t[n]):d(e[n],t[n]));return e}function m(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var u=o[a];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function g(e,t){for(var n in e)if(n in t)return!0;return!1}function v(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function y(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function b(e){return JSON.parse(JSON.stringify(e))}function _(e){return!0===e||!1===e}function S(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}Object.defineProperty(n,"__esModule",{value:!0});var x=e("json-stable-stringify"),M=e("vega-util");n.extend=M.extend,n.isArray=M.isArray,n.isObject=M.isObject,n.isNumber=M.isNumber,n.isString=M.isString,n.truncate=M.truncate,n.toSet=M.toSet,n.stringValue=M.stringValue;var E=e("vega-util");n.pick=r,n.omit=i,n.hash=a,n.contains=o,n.without=u,n.union=s,n.some=c,n.every=l,n.flatten=f,n.mergeDeep=d,n.unique=m,n.differ=h,n.hasIntersection=g,n.differArray=v,n.keys=Object.keys,n.vals=y,n.duplicate=b,n.isBoolean=_,n.varName=S},{"json-stable-stringify":33,"vega-util":128}],125:[function(e,t,n){"use strict";function r(e,t,r){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===r&&(r=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var o=i.isMarkDef(e.mark)?e.mark.type:e.mark,u=e.encoding,s=t[o],c=r[o];for(var l in s)if(!(s[l]in u))return'Missing encoding channel "'+s[l]+'" for mark "'+o+'"';for(var f in u)if(!c[f])return'Encoding channel "'+f+'" is not supported by mark type "'+o+'"';return o!==a.BAR||u.x||u.y?null:"Missing both x and y for bar"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mark"),a=e("./mark"),o=e("./util");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:o.toSet(["row","column","x","y","size","color","detail"]),line:o.toSet(["row","column","x","y","color","detail"]),area:o.toSet(["row","column","x","y","color","detail"]),tick:o.toSet(["row","column","x","y","color","detail"]),circle:o.toSet(["row","column","x","y","color","size","detail"]),square:o.toSet(["row","column","x","y","color","size","detail"]),point:o.toSet(["row","column","x","y","color","size","detail","shape"]),text:o.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=r},{"./mark":114,"./util":124}],126:[function(e,t,n){"use strict";function r(e){return!u.isArray(e)&&("fields"in e&&!("data"in e))}function i(e){return!u.isArray(e)&&("fields"in e&&"data"in e)}function a(e){return!u.isArray(e)&&("field"in e&&"data"in e)}function o(e){return!u.isArray(e)&&"signal"in e}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./util");n.isDataRefUnionedDomain=r,n.isFieldRefUnionDomain=i,n.isDataRefDomain=a,n.isSignalRefDomain=o},{"./util":124}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var r=e("./compile/compile");n.compile=r.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":40,"./aggregate":41,"./axis":42,"./bin":43,"./channel":44,"./compile/compile":49,"./compositemark":104,"./config":105,"./data":106,"./datetime":107,"./encoding":108,"./facet":109,"./fielddef":110,"./legend":112,"./mark":114,"./scale":115,"./sort":117,"./spec":118,"./stack":119,"./timeunit":120,"./transform":122,"./type":123,"./util":124,"./validate":125}],128:[function(t,n,r){!function(t,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return s(e)?"["+e.map(r)+"]":c(e)||l(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},u=function(e){function t(){a.push(l+e.substring(n,r)),l="",n=r+1}var n,r,i,a=[],u=null,s=0,c=e.length,l="";for(e+="",n=r=0;r<c;++r)if("\\"===(i=e[r]))l+=e.substring(n,r),n=++r;else if(i===u)t(),u=null,s=-1;else{if(u)continue;n===s&&'"'===i?(n=r+1,u=i):n===s&&"'"===i?(n=r+1,u=i):"."!==i||s?"["===i?(r>n&&t(),s=n=r+1):"]"===i&&(s||o("Access path missing open bracket: "+e),s>0&&t(),s=0,n=r+1):r>n?t():n=r+1}return s&&o("Access path missing closing bracket: "+e),u&&o("Access path missing closing quote: "+e),r>n&&(++r,t()),a},s=Array.isArray,c=function(e){return e===Object(e)},l=function(e){return"string"==typeof e},f=function(e,t){var n=u(e),i="return _["+n.map(r).join("][")+"];";return a(Function("_",i),[e=1===n.length?n[0]:e],t||e)},d=[],p=f("id"),m=a(function(e){return e},d,"identity"),h=a(function(){return 0},d,"zero"),g=a(function(){return 1},d,"one"),v=a(function(){return!0},d,"true"),y=a(function(){return!1},d,"false"),b=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=1&&i("warn","WARN",arguments),this},info:function(){return t>=2&&i("log","INFO",arguments),this},debug:function(){return t>=3&&i("log","DEBUG",arguments),this}}},_=function(e){return null!=e?s(e)?e:[e]:[]},S=function(e,t){var n,i,o,s,c,l,f,d,p=[],m=(e=_(e)).map(function(e,t){return null==e?null:(p.push(t),u(e).map(r).join("]["))}),h=p.length-1,g=_(t),v="var u,v;return ";if(h<0)return null;for(i=0;i<=h;++i)n=p[i],o=m[n],s="(u=a["+o+"])",c="(v=b["+o+"])",l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",f="descending"!==g[n]?(d=1,-1):(d=-1,1),v+="("+s+"<"+c+"||u==null)&&v!=null?"+f+":(u>v||v==null)&&u!=null?"+d+":"+l+"!==u&&v===v?"+f+":v!==v&&u===u?"+d+(n<h?":":":0");return a(Function("a","b",v+";"),e.filter(function(e){return null!=e}))},x=function(e){return"function"==typeof e},M=function(e){return x(e)?e:function(){return e}},E=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},w=function(e,t){var n,r,i,a,o,u=-1,s=e.length;if(null==t){for(;++u<s;)if(null!=(r=e[u])&&r>=r){n=i=r;break}for(a=o=u;++u<s;)null!=(r=e[u])&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}else{for(;++u<s;)if(null!=(r=t(e[u],u,e))&&r>=r){n=i=r;break}for(a=o=u;++u<s;)null!=(r=t(e[u],u,e))&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}return[a,o]},O={},N=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==O}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===O&&--n.empty),i[e]=r,this},delete:function(e){return t(e)&&(--n.size,++n.empty,i[e]=O),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,a={},o=0;for(e in i)(t=i[e])===O||r&&r(t)||(a[e]=t,++o);n.size=o,n.empty=0,n.object=i=a}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},T=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},A=function(e){return"number"==typeof e},D=function(e){e=e?_(e):e
;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+u(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},k=function(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),u=0,s=0,c=0;u<i&&s<a;++c)o[c]=e(t[u],n[s])>0?n[s++]:t[u++];for(;u<i;++u,++c)o[c]=t[u];for(;s<a;++s,++c)o[c]=n[s];return o},C=function(e,t){for(var n="";--t>=0;)n+=e;return n},P=function(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?C(i,o)+a:"center"===r?C(i,~~(o/2))+a+C(i,Math.ceil(o/2)):a+C(i,o)},R=function(e){return e[e.length-1]},L=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},I=function(e,t,n,r){var i=null!=r?r:"…",a=e+"",o=a.length,u=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-u):"center"===n?a.slice(0,Math.ceil(u/2))+i+a.slice(o-~~(u/2)):a.slice(0,u)+i},U=function(e,t,n){if(e){var r,i=0,a=e.length;if(t)for(;i<a;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=a,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=m,e.zero=h,e.one=g,e.truthy=v,e.falsy=y,e.logger=b,e.None=0,e.Warn=1,e.Info=2,e.Debug=3,e.array=_,e.compare=S,e.constant=M,e.error=o,e.extend=E,e.extentIndex=w,e.fastmap=N,e.field=f,e.inherits=T,e.isArray=s,e.isFunction=x,e.isNumber=A,e.isObject=c,e.isString=l,e.key=D,e.merge=k,e.pad=P,e.peek=R,e.repeat=C,e.splitAccessPath=u,e.stringValue=r,e.toSet=L,e.truncate=I,e.visitArray=U,Object.defineProperty(e,"__esModule",{value:!0})})},{}],129:[function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t={}),e.addEventListener("mouseover.tooltipInit",function(e,n){p(n)&&(a(),U=window.setTimeout(function(){l(e,n,t)},t.delay||I))}),e.addEventListener("mousemove.tooltipUpdate",function(e,n){p(n)&&j&&f(e,n,t)}),e.addEventListener("mouseout.tooltipRemove",function(e,n){p(n)&&(a(),j&&d(e,n,t))}),{destroy:function(){e.removeEventListener("mouseover.tooltipInit"),e.removeEventListener("mousemove.tooltipUpdate"),e.removeEventListener("mouseout.tooltipRemove"),a()}}}function i(e,t,n){return void 0===n&&(n={}),n=o(n,t),e.addEventListener("mouseover",function(e,t){p(t)&&(a(),U=window.setTimeout(function(){l(e,t,n)},n.delay||I))}),e.addEventListener("mousemove",function(e,t){p(t)&&j&&f(e,t,n)}),e.addEventListener("mouseout",function(e,t){p(t)&&(a(),j&&d(e,t,n))}),{destroy:function(){e.removeEventListener("mouseover.tooltipInit"),e.removeEventListener("mousemove.tooltipUpdate"),e.removeEventListener("mouseout.tooltipRemove"),a()}}}function a(){window.clearTimeout(U),U=void 0}function o(e,t){var n=[];return!1!==e.showAllFields?L.spec.fieldDefs(t).forEach(function(r){var i=u(e.fields,r),a=c(i,r,t);n.push(a)}):e.fields&&e.fields.forEach(function(e){var r=s(L.spec.fieldDefs(t),e),i=c(e,r,t);n.push(i)}),e.fields=n,e}function u(e,t){if(t&&e&&!(e.length<=0))if(t.aggregate){for(var n=0;n<e.length;n++){var r=e[n];if(r.field===t.field&&r.aggregate===t.aggregate)return r}for(var n=0;n<e.length;n++){var r=e[n];if(r.field===t.field&&!r.aggregate)return r}}else for(var n=0;n<e.length;n++){var r=e[n];if(r.field===t.field)return r}}function s(e,t){if(t&&t.field&&e)for(var n=0;n<e.length;n++){var r=e[n];if(r.field===t.field){if(!r.aggregate)return r;if(r.aggregate===t.aggregate||!t.aggregate)return r}}}function c(e,t,n){var r=L.util.extend({},n.config);if(!e&&!t)return void console.error("[Tooltip] Cannot supplement a field when field and fieldDef are both empty.");!e&&t&&(e={}),e&&!t&&(t={});var i={};if(i.field=t.field?L.fieldDef.field(t):e.field,t.type===R.TEMPORAL&&t.timeUnit){var a=t.field;i.removeOriginalTemporalField=a;for(var o=L.spec.fieldDefs(n),u=0;u<o.length;u++)if(o[u].field===a&&!o[u].timeUnit){i.removeOriginalTemporalField=void 0;break}}if(r.countTitle||(r.countTitle=L.config.defaultConfig.countTitle),i.title=e.title?e.title:L.fieldDef.title(t,r),i.formatType=e.formatType?e.formatType:F[t.type],e.format)i.format=e.format;else switch(i.formatType){case"time":i.format=t.timeUnit?L.timeUnit.formatExpression(t.timeUnit,"",!1).split("'")[1]:r.timeFormat||L.config.defaultConfig.timeFormat;break;case"number":i.format=r.numberFormat}return t.bin&&(i.field=i.field.replace("_start","_range"),i.bin=!0,i.formatType="string"),i}function l(e,t,n){var r=E(),i=m(t,n);i&&0!==i.length&&(w(r,i),N(e,n),A(n),C.select("#vis-tooltip").style("visibility","visible"),j=!0,n.onAppear&&n.onAppear(e,t))}function f(e,t,n){N(e,n),n.onMove&&n.onMove(e,t)}function d(e,t,n){C.select("#vis-tooltip").style("visibility","hidden"),j=!1,O(),D(),T(),n.onDisappear&&n.onDisappear(e,t)}function p(e){return!(!e||!e.datum)&&(!e.datum._facetID&&!!e.datum._id)}function m(e,t){var n=k.map(e.datum);return y(n,["_id","_prev","width","height","count_start","count_end","layout_start","layout_mid","layout_end","layout_path","layout_x","layout_y"]),b(n,t.fields),_(n,t.fields),S(e.mark.marktype,n),!1!==t.showAllFields?v(n,t):h(n,t)}function h(e,t){var n=[];return t.fields.forEach(function(t){var r=t.title?t.title:t.field,i=g(e,t.field);if(void 0!==i){var a=x(i,t.formatType,t.format)||M(i);n.push({title:r,value:a})}}),n}function g(e,t){var n,r=t.split("."),i=r[0];return r.shift(),e.has(i)&&(n=e.get(i),r.forEach(function(e){n[e]&&(n=n[e])})),void 0===n?void console.warn("[Tooltip] Cannot find field "+t+" in data."):n}function v(e,t){var n=[],r=k.map(t.fields,function(e){return e.field});return e.each(function(e,t){var i;if(i=r.has(t)&&r.get(t).title?r.get(t).title:t,r.has(t))var a=r.get(t).formatType,o=r.get(t).format;var u=x(e,a,o)||M(e);n.push({title:i,value:u})}),n}function y(e,t){t.forEach(function(t){e.remove(t)})}function b(e,t){t&&t.forEach(function(t){t.removeOriginalTemporalField&&y(e,[t.removeOriginalTemporalField])})}function _(e,t){if(t)return t.forEach(function(t){if(!0===t.bin){var n=t.field,r=n.replace("_range","_start"),i=n.replace("_range","_mid"),a=n.replace("_range","_end"),o=e.get(r),u=e.get(a);if(void 0!==o&&void 0!==u){var s=o+"-"+u;e.set(n,s)}var c=[];c.push(r,i,a),y(e,c)}}),e}function S(e,t){if("line"===e||"area"===e){var n=[];t.each(function(e,t){switch(P.type(t)){case"number":case"date":n.push(e)}}),y(t,n)}}function x(e,t,n){if(void 0!==e&&null!==e&&t)switch(t){case"time":return n?P.format.time(n)(e):P.format.auto.time()(e);case"number":return n?P.format.number(n)(e):P.format.auto.number()(e);case"string":default:return e}}function M(e){switch(P.type(e)){case"date":return P.format.auto.time()(e);case"number":return P.format.auto.number()(e);case"boolean":case"string":default:return e}}function E(){return C.select("#vis-tooltip").empty()?C.select("body").append("div").attr("id","vis-tooltip").attr("class","vg-tooltip"):C.select("#vis-tooltip")}function w(e,t){e.selectAll("table").remove();var n=e.append("table").selectAll(".tooltip-row").data(t);n.exit().remove();var r=n.enter().append("tr").attr("class","tooltip-row");r.append("td").attr("class","key").text(function(e){return e.title+":"}),r.append("td").attr("class","value").text(function(e){return e.value})}function O(){C.select("#vis-tooltip").selectAll(".tooltip-row").data([]).exit().remove()}function N(e,t){var n=10,r=10;t&&t.offset&&void 0!==t.offset.x&&null!==t.offset.x&&(n=t.offset.x),t&&t.offset&&void 0!==t.offset.y&&null!==t.offset.y&&(r=t.offset.y),C.select("#vis-tooltip").style("top",function(){var t=this.getBoundingClientRect().height;return e.clientY+t+r<window.innerHeight?e.clientY+r+"px":e.clientY-t-r+"px"}).style("left",function(){var t=this.getBoundingClientRect().width;return e.clientX+t+n<window.innerWidth?e.clientX+n+"px":e.clientX-t-n+"px"})}function T(){C.select("#vis-tooltip").style("top","-9999px").style("left","-9999px")}function A(e){D(),e&&"dark"===e.colorTheme?C.select("#vis-tooltip").classed("dark-theme",!0):C.select("#vis-tooltip").classed("light-theme",!0)}function D(){C.select("#vis-tooltip").classed("dark-theme light-theme",!1)}Object.defineProperty(n,"__esModule",{value:!0});var k=e("d3-collection"),C=e("d3-selection"),P=e("datalib"),R=e("vega-lite/build/src/type"),L=e("vega-lite/build/src/vl"),I=100,U=void 0,j=!1;n.vega=r,n.vegaLite=i;var F={quantitative:"number",temporal:"time",ordinal:void 0,nominal:void 0}},{"d3-collection":2,"d3-selection":3,datalib:28,"vega-lite/build/src/type":123,"vega-lite/build/src/vl":127}]},{},[129])(129)});
